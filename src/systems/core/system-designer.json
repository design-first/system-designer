{"name":"system-designer","master":true,"version":"4.7.0","description":"A Designer for Systems","schemas":{"104ad1f48518376":{"_id":"104ad1f48518376","_name":"_Channel","_inherit":["_Component"],"$editorUpdateSystem":"event","$editorUpdateSchema":"event","$editorUpdateSchemaId":"event","$editorUpdateSchemaName":"event","$editorUpdateModel":"event","$editorUpdateModelId":"event","$editorUpdateType":"event","$editorDeleteType":"event","$editorUpdateBehavior":"event","$editorDeleteBehavior":"event","$editorUpdateComponent":"event","$editorUpdateComponentId":"event","$editorDeleteComponent":"event","$appLogDebug":"event","$appLogInfo":"event","$appLogWarn":"event","$appLogError":"event","$appLoadSystem":"event","$designerSync":"event","$designerCreateBehavior":"event","$designerCreateComponent":"event","$designerCreateType":"event","$designerCreateSchema":"event","$designerCreateModel":"event","$designerDeleteSchema":"event","$designerDeleteModel":"event","$designerDeleteType":"event","$designerDeleteBehavior":"event","$designerDeleteComponent":"event","$designerUpdateComponent":"event","$designerUpdateModel":"event","$designerUpdateBehavior":"event","$designerSetSystem":"event","$runtimeCreateComponent":"event","$runtimeDeleteComponent":"event","$runtimeUpdateComponent":"event","send":"event"},"z1e592183e81ce64":{"_id":"z1e592183e81ce64","_name":"Router","_inherit":["_Component"],"start":"method","update":"method"},"t19b6b11ff31158d":{"_id":"t19b6b11ff31158d","_inherit":["_Component"],"_name":"ToolBarItem","html":"link","position":"property","type":"property","render":"method","click":"event","platform":"property"},"p1f6f51d9f111925":{"_name":"MenuAction","html":"link","position":"property","type":"property","hide":"method","show":"method","render":"method","click":"event","_id":"p1f6f51d9f111925","_inherit":["_Component"]},"t14a79156a81862a":{"_name":"MenuHeader","html":"link","type":"property","hide":"method","show":"method","render":"method","_id":"t14a79156a81862a","_inherit":["_Component"]},"l1d113198721599d":{"_name":"MenuItem","html":"link","position":"property","type":"property","name":"property","platform":"property","render":"method","click":"event","_id":"l1d113198721599d","_inherit":["_Component"]},"v194541e0431ce95":{"_name":"Spaces","designer":"property","items":"collection","systems":"collection","components":"collection","render":"method","clear":"method","_id":"v194541e0431ce95","_inherit":["_Component"]},"f1092816b571e03c":{"_name":"Workspace","create":"method","load":"method","clear":"method","render":"method","_id":"f1092816b571e03c","_inherit":["_Component"]},"o1ead8184af1a83e":{"_id":"o1ead8184af1a83e","_name":"Designer","_inherit":["_Component"],"version":"property","runWindow":"property","debugWindow":"property","linkModel":"method","save":"method","saveCordova":"method","saveAs":"method","welcome":"method","open":"method","render":"event","isCordova":"method","isElectron":"method","updateCordovaContext":"method","messages":"property","runMessages":"method","installExtensions":"method","isMac":"method","addShorcuts":"method"},"y1efb3178341398a":{"_name":"State","_inherit":["_Component"],"type":"property","component":"property","lastPage":"property","messages":"property","menu":"property","previousMenu":"property","space":"property","logs":"collection","navigation":"property","_id":"y1efb3178341398a"}},"models":{"135c71078810af2":{"_id":"135c71078810af2","_name":"_Channel","$editorUpdateSchemaName":{"params":[{"name":"name","type":"string"},{"name":"id","type":"string"}]},"$designerSync":{},"$appLoadSystem":{"params":[{"name":"system","type":"object"}]},"$designerCreateBehavior":{"params":[{"name":"behavior","type":"object"}]},"$editorUpdateBehavior":{"params":[{"name":"id","type":"string"},{"name":"behavior","type":"object"}]},"$designerUpdateBehavior":{"params":[{"name":"id","type":"string"},{"name":"behavior","type":"object"}]},"$editorDeleteBehavior":{"params":[{"name":"id","type":"string"}]},"$designerDeleteBehavior":{"params":[{"name":"id","type":"string"}]},"$designerCreateComponent":{"params":[{"name":"collection","type":"string"},{"name":"component","type":"object"}]},"$editorUpdateComponent":{"params":[{"name":"id","type":"string"},{"name":"collection","type":"string"},{"name":"component","type":"object"}]},"$editorUpdateComponentId":{"params":[{"name":"oldId","type":"string"},{"name":"newId","type":"string"},{"name":"collection","type":"string"}]},"$designerUpdateComponent":{"params":[{"name":"id","type":"string"},{"name":"collection","type":"string"},{"name":"component","type":"object"}]},"$editorDeleteComponent":{"params":[{"name":"id","type":"string"},{"name":"collection","type":"string"}]},"$designerDeleteComponent":{"params":[{"name":"id","type":"string"},{"name":"collection","type":"string"}]},"$designerCreateType":{"params":[{"name":"id","type":"string"},{"name":"type","type":"object"}]},"$editorUpdateType":{"params":[{"name":"id","type":"string"},{"name":"type","type":"object"}]},"$editorDeleteType":{"params":[{"name":"id","type":"string"}]},"$designerCreateSchema":{"params":[{"name":"id","type":"string"},{"name":"schema","type":"object"}]},"$editorUpdateSchema":{"params":[{"name":"id","type":"string"},{"name":"schema","type":"object"}]},"$editorUpdateSchemaId":{"params":[{"name":"oldId","type":"string"},{"name":"newId","type":"string"}]},"$designerDeleteSchema":{"params":[{"name":"id","type":"string"}]},"$designerCreateModel":{"params":[{"name":"id","type":"string"},{"name":"model","type":"object"}]},"$editorUpdateModel":{"params":[{"name":"id","type":"string"},{"name":"model","type":"object"}]},"$designerUpdateModel":{"params":[{"name":"id","type":"string"},{"name":"model","type":"object"}]},"$editorUpdateModelId":{"params":[{"name":"oldId","type":"string"},{"name":"newId","type":"string"}]},"$designerDeleteModel":{"params":[{"name":"id","type":"string"}]},"$designerDeleteType":{"params":[{"name":"id","type":"string"}]},"$editorUpdateSystem":{"params":[{"name":"id","type":"string"},{"name":"system","type":"object"}]},"$appLogDebug":{"params":[{"name":"message","type":"string"}]},"$appLogInfo":{"params":[{"name":"message","type":"string"}]},"$appLogWarn":{"params":[{"name":"message","type":"string"}]},"$appLogError":{"params":[{"name":"message","type":"string"}]},"$runtimeCreateComponent":{"params":[{"name":"collection","type":"string"},{"name":"component","type":"object"}]},"$runtimeDeleteComponent":{"params":[{"name":"id","type":"string"},{"name":"collection","type":"string"}]},"$runtimeUpdateComponent":{"params":[{"name":"id","type":"string"},{"name":"collection","type":"string"},{"name":"field","type":"string"},{"name":"value","type":"any"}]},"send":{"params":[{"name":"message","type":"message"}]},"$designerSetSystem":{"params":[{"name":"system","type":"object","mandatory":false,"default":{}}]}},"c1b00612faf188cf":{"_id":"c1b00612faf188cf","_name":"Router","start":{},"update":{}},"u1f4c7177bb1a459":{"_id":"u1f4c7177bb1a459","_name":"ToolBarItem","html":{"type":"HTML","readOnly":false,"mandatory":false,"default":""},"position":{"type":"number","readOnly":false,"mandatory":false,"default":0},"type":{"type":"editorType","readOnly":false,"mandatory":false,"default":"designer"},"render":{},"click":{},"platform":{"type":"platform","readOnly":false,"mandatory":false,"default":"all"}},"w124ac16b591df57":{"_name":"MenuAction","html":{"type":"HTML","readOnly":false,"mandatory":false,"default":""},"position":{"type":"number","readOnly":false,"mandatory":false,"default":0},"type":{"type":"editorType","readOnly":false,"mandatory":false,"default":"designer"},"hide":{},"show":{},"render":{},"_id":"w124ac16b591df57","click":{"description":"","params":[]}},"f13ebe1ad331b263":{"_name":"MenuHeader","html":{"type":"HTML","readOnly":false,"mandatory":false,"default":""},"type":{"type":"editorType","readOnly":false,"mandatory":false,"default":"designer"},"hide":{},"show":{},"render":{},"_id":"f13ebe1ad331b263"},"u1f9a01abe31b3bf":{"_id":"u1f9a01abe31b3bf","_name":"MenuItem","html":{"type":"HTML","readOnly":false,"mandatory":false,"default":""},"position":{"type":"number","readOnly":false,"mandatory":false,"default":0},"type":{"type":"editorType","readOnly":false,"mandatory":false,"default":"designer"},"name":{"type":"string","readOnly":false,"mandatory":false,"default":""},"platform":{"type":"platform","readOnly":false,"mandatory":false,"default":"all"},"render":{},"click":{}},"i15f6718c9d19b10":{"_id":"i15f6718c9d19b10","_name":"Spaces","designer":{"type":"Designer","readOnly":true,"mandatory":false,"default":{}},"items":{"type":["SpaceItem"],"readOnly":false,"mandatory":false,"default":[]},"systems":{"type":["SpaceItem"],"readOnly":false,"mandatory":false,"default":[]},"components":{"type":["SpaceItem"],"readOnly":false,"mandatory":false,"default":[]},"render":{},"clear":{}},"v1435e1809e10be7":{"_id":"v1435e1809e10be7","_name":"Workspace","create":{},"load":{},"clear":{},"render":{}},"q129be1c61b18285":{"_id":"q129be1c61b18285","_name":"Designer","version":{"type":"string","readOnly":false,"mandatory":false,"default":"4.7.0"},"runWindow":{"type":"object","readOnly":false,"mandatory":false,"default":null},"debugWindow":{"type":"object","readOnly":false,"mandatory":false,"default":null},"linkModel":{"params":[{"name":"source","type":"string","mandatory":false,"default":""},{"name":"target","type":"string","mandatory":false,"default":""}]},"save":{},"saveCordova":{},"saveAs":{"params":[{"name":"data","type":"object","mandatory":false,"default":{}},{"name":"fileName","type":"string","mandatory":false,"default":""}]},"welcome":{},"open":{"params":[{"name":"url","type":"string","mandatory":false,"default":""},{"name":"target","type":"string","mandatory":false,"default":""},{"name":"isExt","type":"boolean","mandatory":false,"default":false}]},"render":{},"isCordova":{"result":"boolean"},"isElectron":{"result":"boolean"},"updateCordovaContext":{},"messages":{"type":"array","readOnly":false,"mandatory":false,"default":[]},"runMessages":{"params":[{"name":"messages","type":"array","mandatory":true,"default":[]}]},"installExtensions":{},"isMac":{"result":"boolean"},"addShorcuts":{}},"j1311d115381b738":{"_id":"j1311d115381b738","_name":"State","type":{"type":"string","readOnly":false,"mandatory":false,"default":""},"component":{"type":"string","readOnly":false,"mandatory":false,"default":""},"lastPage":{"type":"string","readOnly":false,"mandatory":false,"default":"index.html"},"messages":{"type":"array","readOnly":false,"mandatory":false,"default":[]},"menu":{"type":"string","readOnly":false,"mandatory":false,"default":""},"previousMenu":{"type":"string","readOnly":false,"mandatory":false,"default":""},"space":{"type":"string","readOnly":false,"mandatory":false,"default":""},"logs":{"type":["Log"],"readOnly":false,"mandatory":false,"default":[]},"navigation":{"type":"navigation","readOnly":false,"mandatory":false,"default":{"menu":[],"spaces":[]}}}},"behaviors":{"z14cf91f7131c34d":{"_id":"z14cf91f7131c34d","component":"1dbc51300e11z17","state":"click","action":"function click() {\n  $('#designer-toolbar-item-search').tooltip('hide');\n  if ($('#designer-dialog').children().length) {\n    $('#' + $(\"#designer-dialog\").children()[0].id).removeClass('fade').modal('hide');\n  }\n\n  var message = this.require('message');\n  var Dialog = this.require('DialogSearch');\n  var system = this.require('factory').system();\n\n  if (system && system.name() !== 'default') {\n    var dialog = new Dialog({\n      'title': 'Search in the system',\n    });\n    dialog.show();\n  } else {\n    message.warning('There is no system.');\n  }\n}"},"a13b711adba1c7d4":{"_id":"a13b711adba1c7d4","component":"163a01b7ca1935c","state":"click","action":"function click() {\n  var debugWindow = this.require('designer').debugWindow(),\n    config = this.require('storage').get('system-designer-config'),\n    message = this.require('message');\n\n  $('#designer-toolbar-item-refresh').tooltip('hide');\n  if ($('#designer-dialog').children().length) {\n    $('#' + $(\"#designer-dialog\").children()[0].id).removeClass('fade').modal('hide');\n  }\n  \n  if (config) {\n    if (typeof config.debugType !== 'undefined' && config.debugType === 'client') {\n      if (config.urlClient) {\n        if (debugWindow && !debugWindow.closed) {\n          message.success('Searching for a remote system...');\n          this.require('channel').$designerSync();\n        } else {\n          message.success('Opening the remote system...');\n          this.require('designer').debugWindow(this.require('designer').open(config.urlClient, 'debug'));\n        }\n      } else {\n        message.warning('No url set. Please set the url in the configuration panel.');\n      }\n    }\n    if (typeof config.debugType !== 'undefined' && config.debugType === 'server') {\n      if (config.urlServer) {\n        message.success('Searching for a server...');\n        var self = this;\n        $.getJSON(config.urlServer.replace(':8888', '') + ':8888/$designerSync', function (system) {\n          var Dialog = null,\n              dialog = null,\n              message = runtime.require('message');\n          \n          if (system && system.name) {\n            Dialog = self.require('DialogImport');\n            dialog = new Dialog({\n              'title': 'A system has been found',\n              'message': 'Do you wan to import it ?',\n              'data': system\n            });\n            dialog.show();\n  \n            dialog.on('ok', function () {\n              var sys = null,\n                designer = this.require('designer'),\n                message = this.require('message');\n  \n              if (this.require('factory').system()) {\n                this.require('factory').system().destroy();\n              }\n  \n              sys = this.require('factory').create(this.data());\n  \n              // empty log\n              this.require('state').logs().forEach(function (item) {\n                this.logs().pop();\n              }.bind(this.require('state')));\n              \n              // hide log\n              $('#designer-menu-item-logs-number').hide();\n              document.querySelector('#designer-menu-item-logs-number').innerHTML = 0;\n  \n              designer.save();\n  \n              this.require('state').space(sys.name());\n              this.require('spaces').render();\n              this.require('workspace').render();\n  \n              this.require('router').update();\n  \n              this.hide();\n              designer.save();\n  \n              message.success('Importation of the system is done.');\n            });\n          } else {\n            message.warning('There is no system to import.');\n          }\n        });\n      } else {\n        message.warning('No url set. Please set the url in the configuration panel.');\n      }\n    }\n    if (typeof config.debugType === 'undefined') {\n      message.warning('No url set. Please set the url in the configuration panel.');\n    }\n  } else {\n    message.warning('No url set. Please set the url in the configuration panel.');\n  }\n}"},"e137f915b1b15f90":{"_id":"e137f915b1b15f90","component":"163a01b7ca1935e","state":"click","action":"function click() {\n  $('#designer-toolbar-item-export').tooltip('hide');\n  if ($('#designer-dialog').children().length) {\n    $('#' + $(\"#designer-dialog\").children()[0].id).removeClass('fade').modal('hide');\n  }\n  \n  var message = this.require('message');\n  var Dialog = this.require('DialogExport');\n  var system = this.require('factory').system();\n\n  if (system && system.name() !== 'default') {\n    var dialog = new Dialog({\n      'title': 'Export the current system',\n    });\n    dialog.show();\n  } else {\n    message.warning('There is no system to export.');\n  }\n}"},"p1087a100821fa03":{"_id":"p1087a100821fa03","component":"1dbc51200e116e3","state":"click","action":"function click() {\n  $('#designer-toolbar-item-config').tooltip('hide');\n  if ($('#designer-dialog').children().length) {\n    $('#' + $(\"#designer-dialog\").children()[0].id).removeClass('fade').modal('hide');\n  }\n  \n  var DialogConfig = this.require('DialogConfig');\n\n  DialogConfig = new DialogConfig({\n    'title': 'Configuration'\n  });\n  DialogConfig.show();\n  DialogConfig.on('ok', function () {\n    var message = this.require('message');\n\n    this.hide();\n    message.success('Configuration saved.');\n  });\n}"},"y1163b139241a596":{"_id":"y1163b139241a596","component":"1dbc51200e116e11","state":"click","action":"function click() {\n  $('#designer-toolbar-item-sync').tooltip('hide');\n  if ($('#designer-dialog').children().length) {\n    $('#' + $(\"#designer-dialog\").children()[0].id).removeClass('fade').modal('hide');\n  }\n  \n  var DialogSync = this.require('DialogSync');\n\n  DialogSync = new DialogSync({\n    'title': 'GitHub'\n  });\n  DialogSync.show();\n  DialogSync.on('ok', function () {\n    if ($('#designer-dialog-sync-refresh').prop('checked')) {\n      this.require('github').refresh();\n    } else {\n      this.require('github').push(\n        $('#designer-dialog-sync-comments').val(),\n        $('#designer-dialog-type-creation-hasHTML').prop('checked'),\n        false,\n        $('#designer-dialog-sync-options-log-level-select').val(),\n        $('#designer-dialog-type-creation-hasPackage').prop('checked')\n      );\n    }\n    this.hide();\n  });\n}"},"o1ec561a54015768":{"_id":"o1ec561a54015768","component":"163a01b7ca1935d","state":"click","action":"function click() {\n  $('#designer-toolbar-item-import').tooltip('hide');\n  if ($('#designer-dialog').children().length) {\n    $('#' + $(\"#designer-dialog\").children()[0].id).removeClass('fade').modal('hide');\n  }\n  \n  var DialogImportFile = this.require('DialogImportFile');\n\n  var dialogImportFile = new DialogImportFile({\n    'title': 'Import a system'\n  });\n  dialogImportFile.show();\n}"},"q178081a11712887":{"_id":"q178081a11712887","component":"13f70137b61b19b","state":"click","action":"function click() {\n  var designer = this.require('designer'),\n    message = this.require('message'),\n    debugWindow = this.require('designer').debugWindow(),\n    runWidow = this.require('designer').runWindow(),\n    system = this.require('factory').system(),\n    json = {},\n    cleanJson = '',\n    reg = null;\n\n  $('#designer-toolbar-item-publish').tooltip('hide');\n  if ($('#designer-dialog').children().length) {\n    $('#' + $(\"#designer-dialog\").children()[0].id).removeClass('fade').modal('hide');\n  }\n  \n  if (system && system.name() !== 'default') {\n\n    // force save befor running the app\n    this.require('designer').save();\n\n\n    switch(true) {\n      // case of extension\n      case system.name().indexOf('extension-') !== -1:\n        json = this.require('factory').toJSON();\n\n        cleanJson = JSON.stringify(json);\n        reg = new RegExp(json._id, 'g');\n        cleanJson = cleanJson.replace(reg, 'ext_' + json._id);\n        json = JSON.parse(cleanJson);\n        runtime.stop(json._id);\n        runtime.uninstall(json._id);\n        runtime.install(json);\n        this.require('menubar').render();\n        this.require('toolbar').render();\n        message.success('The extension has been installed.');\n        break;\n      \n      // case of remote debugging\n      case debugWindow && !debugWindow.closed:\n        this.require('channel').$designerSetSystem(this.require('factory').toJSON());\n        // TODO Refresh the page\n        message.success('Running the system in the remote page...');\n        break;\n\n      // reload the running page\n      case runWidow && !runWidow.closed:\n        runWidow.close();\n        this.require('designer').runWindow(this.require('designer').open('app/index.html#' + this.require('factory').system().id(), 'app'));\n        message.success('Running the system...');\n\n        /*if (typeof require === 'undefined') {\n            runWidow.document.location.reload();\n            message.success('Running the system...');\n        } else {\n            // TODO \n            // to reload when implemented in electron\n            message.info('<b>info</b>: to run again the system, click the widow where your system is running and go to the menu \\'View > Refresh\\â€™.');\n        }*/\n        break;\n\n      // we load for the first time the page\n      default:\n        this.require('designer').runWindow(this.require('designer').open('app/index.html#' + this.require('factory').system().id(), 'app'));\n        message.success('Running the system...');\n        break;\n    }\n  } else {\n    message.warning('There is no system to run.');\n  }\n}","useCoreAPI":true},"k1a9e11cd571d17c":{"_id":"k1a9e11cd571d17c","component":"13a291c27f16314","state":"click","action":"function click() { \n  $('#designer-toolbar-item-help').tooltip('hide');\n  if ($('#designer-dialog').children().length) {\n    $('#' + $(\"#designer-dialog\").children()[0].id).removeClass('fade').modal('hide');\n  }\n  \n  switch (this.require('state').menu()) {\n    case 'systems':\n      this.require('designer').open('https://designfirst.io/systemdesigner/documentation/docs/create-a-system.html', '_blank', true); \n      break;\n    case 'schemas':\n      this.require('designer').open('https://designfirst.io/systemdesigner/documentation/docs/create-a-schema.html', '_blank', true); \n      break;\n    case 'models':\n      this.require('designer').open('https://designfirst.io/systemdesigner/documentation/docs/edit-a-model.html', '_blank', true); \n      break;\n    case 'types':\n      this.require('designer').open('https://designfirst.io/systemdesigner/documentation/docs/create-a-type.html', '_blank', true); \n      break;\n    case 'behaviors':\n      this.require('designer').open('https://designfirst.io/systemdesigner/documentation/docs/create-a-behavior.html', '_blank', true); \n      break;\n    case 'components':\n      this.require('designer').open('https://designfirst.io/systemdesigner/documentation/docs/create-a-component.html', '_blank', true); \n      break;\n    case 'logs':\n      this.require('designer').open('https://designfirst.io/systemdesigner/documentation/docs/run-your-system.html', '_blank', true);\n      break;\n    default:\n      this.require('designer').open('https://designfirst.io/systemdesigner/documentation/docs/quick-start.html', '_blank', true); \n      break;\n  }\n}"},"o1ff8e17e1c1bcd7":{"_id":"o1ff8e17e1c1bcd7","component":"13a291c27f16310","state":"click","action":"function click() {\n  $('#designer-toolbar-item-copyright').tooltip('hide');\n  if ($('#designer-dialog').children().length) {\n    $('#' + $(\"#designer-dialog\").children()[0].id).removeClass('fade').modal('hide');\n  }\n  \n  var DialogCopyright = this.require('DialogCopyright');\n  var message = this.require('copyright.html');\n  \n  DialogCopyright = new DialogCopyright({\n    'title': 'System Designer',\n    'message': message.source().replace('{{version}}', this.require('designer').version())\n  });\n  DialogCopyright.show();\n  DialogCopyright.on('ok', function () {\n    this.hide();\n  });\n}"},"c15ea3176d5139e8":{"_id":"c15ea3176d5139e8","component":"10bcb1a0511e09f","state":"click","action":"function click() { \n  $('#designer-toolbar-item-create').tooltip('hide');\n  if ($('#designer-dialog').children().length) {\n    $('#' + $(\"#designer-dialog\").children()[0].id).removeClass('fade').modal('hide');\n  }\n  \n  var message = this.require('message'),\n      designer = this.require('designer');\n  \n  if (!this.require('factory').system() && this.require('state').menu() !== 'systems') {\n    message.warning('There is no system: create first a system to continue.');\n  } else {\n    if (this.require('factory').system() && Object.keys(this.require('factory').system().schemas()).length === 0 && this.require('state').menu() === 'components') {\n      message.warning('There is no schema: create first a schema to continue.');\n    } else {\n      this.require('workspace').create();\n    }\n  }\n}"},"l19fda1461e1d86c":{"_id":"l19fda1461e1d86c","component":"Spaces","state":"clear","action":"function clear() { \n  this.require('state').space('');\n  $('#designer-spaces-items').empty();\n}","useCoreAPI":false,"core":false},"a16e02190b216769":{"_id":"a16e02190b216769","component":"Spaces","state":"render","action":"function render() { \n  var item = null,\n      items = [],\n      components = [],\n      systemItems = [],\n      system = this.require('factory').system(),\n      SpaceItem = this.require('SpaceItem'),\n      spaceItem = null,\n      space = '',\n      id = '',\n      domItems = document.getElementById('designer-spaces-items'),\n      systemdomItems = document.getElementById('designer-spaces-system-items'),\n      componentdomItems = document.getElementById('designer-spaces-components-items'),\n      self = this,\n      name = '',\n      callback = null,\n      modelsName = [],\n      showComponents = false,\n      modelName = '',\n      componentId = '',\n      fragment = '';\n\n  function _removeActive() {\n    var length = 0,\n        i = 0,\n        item = null;\n\n    length = domItems.children.length;\n    for (i = 0; i < length; i++) {\n      item = domItems.children[i];\n      requestAnimationFrame(function () {\n        $(item).removeClass('active');\n      });\n    }\n  }\n\n  function _findModel(compId, components) {\n    var result = '',\n        modelName = '';\n\n    for (modelName in components) {\n      if (typeof components[modelName][compId] !== 'undefined') {\n        result = modelName;\n        break;\n      }\n    }\n    return result;\n  }\n\n  $('#designer-spaces-help').empty();\n\n  // update header and help\n  switch (this.require('state').menu()) {\n    case 'systems':\n      $('#designer-spaces-spaces-system').hide();\n      $('#designer-spaces-spaces-components').hide();\n      document.getElementById('designer-spaces-type').innerHTML = 'Systems';\n      // help\n      document.getElementById('designer-spaces-help').insertAdjacentHTML('beforeend', this.require('help-system.html').getHTML());\n      break;\n    case 'schemas':\n      $('#designer-spaces-spaces-system').hide();\n      $('#designer-spaces-spaces-components').hide();\n      document.getElementById('designer-spaces-type').innerHTML = 'Schemas';\n      // help\n      document.getElementById('designer-spaces-help').insertAdjacentHTML('beforeend', this.require('help-schemas.html').getHTML());\n      break;\n    case 'models':\n      $('#designer-spaces-spaces-system').hide();\n      $('#designer-spaces-spaces-components').hide();\n      document.getElementById('designer-spaces-type').innerHTML = 'Models';\n      // help\n      document.getElementById('designer-spaces-help').insertAdjacentHTML('beforeend', this.require('help-models.html').getHTML());\n      break;\n    case 'types':\n      $('#designer-spaces-spaces-system').hide();\n      $('#designer-spaces-spaces-components').hide();\n      document.getElementById('designer-spaces-type').innerHTML = 'Types';\n      // help\n      document.getElementById('designer-spaces-help').insertAdjacentHTML('beforeend', this.require('help-types.html').getHTML());\n      break;\n    case 'behaviors':\n      $('#designer-spaces-spaces-system').show();\n      $('#designer-spaces-spaces-components').show();\n      document.getElementById('designer-spaces-type').innerHTML = 'Models';\n      document.getElementById('designer-spaces-system-header').innerHTML = 'System';\n      document.getElementById('designer-spaces-components-header').innerHTML = 'Components';\n      // help\n      document.getElementById('designer-spaces-help').insertAdjacentHTML('beforeend', this.require('help-behaviors.html').getHTML());\n      break;\n    case 'components':\n      $('#designer-spaces-spaces-system').hide();\n      $('#designer-spaces-spaces-components').hide();\n      document.getElementById('designer-spaces-type').innerHTML = 'Models';\n      // help\n      document.getElementById('designer-spaces-help').insertAdjacentHTML('beforeend', this.require('help-components.html').getHTML());\n      break;\n    case 'logs':\n      $('#designer-spaces-spaces-system').hide();\n      $('#designer-spaces-spaces-components').hide();\n      document.getElementById('designer-spaces-type').innerHTML = 'Logs';\n      // help\n      document.getElementById('designer-spaces-help').insertAdjacentHTML('beforeend', this.require('help-logs.html').getHTML());\n      break;\n    default:\n      break;\n  }\n\n  // update spaces\n  // clear\n  $('#designer-spaces-items').empty();\n  $('#designer-spaces-system-items').empty();\n  $('#designer-spaces-components-items').empty();\n  if (system) {\n    switch (this.require('state').menu()) {\n      case 'systems':\n        // items                   \n        var systems = this.require('storage').get('system-designer-systems'),\n            systemIds = [],\n            length = 0,\n            i = 0;\n\n        if (systems) {\n          systemIds = systems.systems;\n        }\n        length = systemIds.length;\n\n        for (i = 0; i < length; i++) {\n          system = this.require('storage').get(systemIds[i]);\n\n          if (system.name !== 'default') {\n            spaceItem = new SpaceItem({\n                'name': system.name,\n                'uuid': system._id\n            });\n            \n            items.push(spaceItem);\n          }\n        }\n        \n        this.items(items);\n\n        // sort\n        this.items().sort(function (idA, idB) {\n          var a = runtime.require(idA),\n              b = runtime.require(idB);\n\n          var result = 0;\n          if (a.name() > b.name()) {\n            result = 1;\n          }\n          if (a.name() < b.name()) {\n            result = -1;\n          }\n          return result;\n        });\n        \n        this.require('state').navigation().spaces([]);\n        fragment = '';\n        \n        this.items().forEach(function (item) {\n          fragment = fragment + '<li id=\"designer-space-' + item.name() + '\" class=\"\"><a href=\"#' + item.uuid() + '#systems#' + item.name() + '\">' + item.name() + '</a></li>';\n          this.require('state').navigation().spaces().push('designer-space-' + item.name());\n        }.bind(this));\n        \n        if (fragment) {\n          domItems.insertAdjacentHTML('beforeend', fragment);\n        }\n\n        // events\n        callback = function () {\n          _removeActive();\n          $(this).addClass('active');\n        };\n        length = domItems.children.length;\n        for (i = 0; i < length; i++) {\n          item = domItems.children[i];\n          item.addEventListener('click', callback);\n          item.addEventListener('click', function () {\n              this.click();\n          }.bind(self.items(i)));\n        }\n\n        this.items().forEach(function (item) {\n          item.on('click', function () {\n            var designer = this.require('designer'),\n                system = this.require('storage').get(this.uuid()),\n                System = this.require('System');\n                \n            if (system) {\n              this.require('factory').create(system);\n            }\n            // empty log\n            this.require('state').logs().forEach(function (item) {\n              this.logs().pop();\n            }.bind(this.require('state')));\n            // hide log\n            $('#designer-menu-item-logs-number').hide();\n            document.querySelector('#designer-menu-item-logs-number').innerHTML = 0;\n          });\n        });\n\n        // focus\n        if (length > 0) {\n          if ($('#designer-space-' + this.require('state').space()).length) {\n            $('#designer-space-' + this.require('state').space()).addClass('active');\n          } else {\n            if (this.require('factory').system()) {\n              if ($('#designer-space-' + this.require('factory').system().name()).length) {\n                $('#designer-space-' + this.require('factory').system().name()).addClass('active');\n                this.require('state').space(this.require('factory').system().name());\n              }\n            } else {\n              item = domItems.children[0];\n              $(item).addClass('active');\n              this.require('state').space(this.items(0).name());\n            }\n          }\n        }\n\n        break;\n      case 'schemas':\n        // items    \n        for (name in system.schemas()) {\n          spaceItem = new SpaceItem({\n            'name': system.schemas()[name]._name,\n            'uuid': name\n          });\n          items.push(spaceItem);\n        }\n        \n        this.items(items);\n\n        // sort\n        this.items().sort(function (idA, idB) {\n          var a = runtime.require(idA),\n              b = runtime.require(idB);\n\n          var result = 0;\n          if (a.name() > b.name()) {\n            result = 1;\n          }\n          if (a.name() < b.name()) {\n            result = -1;\n          }\n          return result;\n        });\n\n        this.require('state').navigation().spaces([]);\n        fragment = '';\n        \n        this.items().forEach(function (item) {\n          fragment = fragment + '<li id=\"designer-space-' + item.uuid() + '\" class=\"\"><a href=\"#' + system.id() + '#schemas#' + item.uuid() + '\">' + item.name() + '</a></li>';\n          this.require('state').navigation().spaces().push('designer-space-' + item.uuid());\n        }.bind(this));\n        \n        if (fragment) {\n          domItems.insertAdjacentHTML('beforeend', fragment);\n        }\n\n        // events\n        callback = function () {\n          _removeActive();\n          $(this).addClass('active');\n        };\n        length = domItems.children.length;\n        for (i = 0; i < length; i++) {\n          item = domItems.children[i];\n          item.addEventListener('click', callback);\n          item.addEventListener('click', function () {\n            this.click();\n          }.bind(self.items(i)));\n        }\n        // focus\n        if (length > 0) {\n          if ($('#designer-space-' + this.require('state').space()).length) {\n            $('#designer-space-' + this.require('state').space()).addClass('active');\n          } else {\n            item = domItems.children[0];\n            $(item).addClass('active');\n            this.require('state').space(this.items(0).uuid());\n          }\n        } else {\n          this.require('state').space('');\n        }\n        break;\n        \n      case 'models':\n        // items    \n        for (name in system.models()) {\n          spaceItem = new SpaceItem({\n            'name': system.models()[name]._name,\n            'uuid': name\n          });\n          items.push(spaceItem);\n        }\n        \n        this.items(items);\n\n        // sort\n        this.items().sort(function (idA, idB) {\n          var a = runtime.require(idA),\n              b = runtime.require(idB);\n\n          var result = 0;\n          if (a.name() > b.name()) {\n            result = 1;\n          }\n          if (a.name() < b.name()) {\n            result = -1;\n          }\n          return result;\n        });\n\n        this.require('state').navigation().spaces([]);\n        fragment = '';\n        \n        this.items().forEach(function (item) {\n          fragment = fragment + '<li id=\"designer-space-' + item.uuid() + '\" class=\"\"><a href=\"#' + system.id() + '#models#' + item.uuid() + '\">' + item.name() + '</a></li>';\n          this.require('state').navigation().spaces().push('designer-space-' + item.uuid());\n        }.bind(this));\n\n        if (fragment) {\n          domItems.insertAdjacentHTML('beforeend', fragment);\n        }\n\n        // events\n        callback = function () {\n          _removeActive();\n          $(this).addClass('active');\n        };\n        length = domItems.children.length;\n        for (i = 0; i < length; i++) {\n          item = domItems.children[i];\n          item.addEventListener('click', callback);\n          item.addEventListener('click', function () {\n            this.click();\n          }.bind(self.items(i)));\n        }\n        // focus\n        if (length > 0) {\n          if ($('#designer-space-' + this.require('state').space()).length) {\n            $('#designer-space-' + this.require('state').space()).addClass('active');\n          } else {\n            item = domItems.children[0];\n            $(item).addClass('active');\n            this.require('state').space(this.items(0).uuid());\n          }\n        } else {\n          this.require('state').space('');\n        }\n        break;\n      case 'types':\n        // items\n        for (name in system.types()) {\n          spaceItem = new SpaceItem({\n            'name': name\n          });\n          items.push(spaceItem);\n        }\n        \n        this.items(items);\n\n        // sort\n        this.items().sort(function (idA, idB) {\n          var a = runtime.require(idA),\n              b = runtime.require(idB);\n\n          var result = 0;\n          if (a.name() > b.name()) {\n            result = 1;\n          }\n          if (a.name() < b.name()) {\n            result = -1;\n          }\n          return result;\n        });\n\n        this.require('state').navigation().spaces([]);\n        fragment = '';\n        \n        this.items().forEach(function (item) {\n          fragment = fragment + '<li id=\"designer-space-' + item.name() + '\" class=\"\"><a href=\"#' + system.id() + '#types#' + item.name() + '\">' + item.name() + '</a></li>';\n          this.require('state').navigation().spaces().push('designer-space-' + item.name());\n        }.bind(this));\n        \n        if (fragment) {\n          domItems.insertAdjacentHTML('beforeend', fragment);\n        }\n\n        // events\n        callback = function () {\n          _removeActive();\n          $(this).addClass('active');\n        };\n        length = domItems.children.length;\n        for (i = 0; i < length; i++) {\n          item = domItems.children[i];\n          item.addEventListener('click', callback);\n          item.addEventListener('click', function () {\n            this.click();\n          }.bind(self.items(i)));\n        }\n        // focus\n        if (length > 0) {\n          if ($('#designer-space-' + this.require('state').space()).length) {\n            $('#designer-space-' + this.require('state').space()).addClass('active');\n          } else {\n            item = domItems.children[0];\n            $(item).addClass('active');\n            this.require('state').space(this.items(0).name());\n          }\n        }\n        break;\n      case 'behaviors':\n        // items\n        for (name in system.models()) {\n          spaceItem = new SpaceItem({\n            'name': system.models()[name]._name,\n            'uuid': name\n          });\n          items.push(spaceItem);\n        }\n        \n        this.items(items);\n\n        // sort\n        this.items().sort(function (idA, idB) {\n          var a = runtime.require(idA),\n              b = runtime.require(idB);\n\n          var result = 0;\n          if (a.name() > b.name()) {\n            result = 1;\n          }\n          if (a.name() < b.name()) {\n            result = -1;\n          }\n          return result;\n        });\n\n        //this.items().reverse();\n\n        this.require('state').navigation().spaces([]);\n        fragment = '';\n        this.items().forEach(function (item) {\n          modelsName.push(item.name());\n          fragment = fragment + '<li id=\"designer-space-' + item.name() + '\" class=\"\"><a href=\"#' + system.id() + '#behaviors#' + item.name() + '\">' + item.name() + '</a></li>';\n          this.require('state').navigation().spaces().push('designer-space-' + item.name());\n        }.bind(this));\n\n        if (fragment) {\n          domItems.insertAdjacentHTML('beforeend', fragment);  \n        }\n        \n        // events\n        callback = function () {\n          _removeActive();\n          $(this).addClass('active');\n        };\n        length = domItems.children.length;\n        for (i = 0; i < length; i++) {\n          item = domItems.children[i];\n          item.addEventListener('click', callback);\n          item.addEventListener('click', function () {\n            this.click();\n          }.bind(self.items(i)));\n        }\n\n        // systems\n        systemItems = []\n\n        if (this.require('storage').get('system-designer-systems') && this.require('storage').get('system-designer-systems').systems.length) {\n          if (this.require('factory').system().name() !== 'default') {\n            spaceItem = new SpaceItem({\n              'name': this.require('factory').system().name(),\n              'uuid': this.require('factory').system().id()\n            });\n            systemItems.push(spaceItem);\n          }\n        }\n        \n        this.systems(systemItems);\n        fragment = '';\n        \n        this.systems().forEach(function (item) {\n          fragment = fragment  + '<li id=\"designer-space-' + item.name() + '\" class=\"\"><a href=\"#' + system.id() + '#behaviors#' + item.name() + '\">' + item.name() + '</a></li>';\n          this.require('state').navigation().spaces().unshift('designer-space-' + item.name());\n        }.bind(this));\n        \n        if (fragment) {\n          systemdomItems.insertAdjacentHTML('beforeend', fragment);\n        }\n\n        // events\n        callback = function () {\n          _removeActive();\n          $(this).addClass('active');\n        };\n        length = systemdomItems.children.length;\n        for (i = 0; i < length; i++) {\n          item = systemdomItems.children[i];\n          item.addEventListener('click', callback);\n          item.addEventListener('click', function () {\n            this.click();\n          }.bind(self.systems(i)));\n        }\n\n        space = this.require('state').space();\n        if (modelsName.indexOf(space) !== -1) {\n          showComponents = true;\n          modelName = space;\n        } else {\n          modelName = _findModel(space, this.require('factory').system().components());\n          if (modelName) {\n            showComponents = true;\n          }\n        }\n\n        if (showComponents) {\n\n          // components\n          components = [];\n\n          // components\n          for (id in system.components()[modelName]) {\n            spaceItem = new SpaceItem({\n              'name': id,\n              'uuid': id\n            });\n            components.push(spaceItem);\n          }\n\n          this.components(components);\n\n          // sort\n          this.components().sort(function (idA, idB) {\n            var a = runtime.require(idA),\n                b = runtime.require(idB);\n\n            var result = 0;\n            if (a.name() > b.name()) {\n              result = 1;\n            }\n            if (a.name() < b.name()) {\n              result = -1;\n            }\n            return result;\n          });\n\n          //this.components().reverse();\n\n          fragment = '';\n          \n          this.components().forEach(function (item) {\n            modelsName.push(item.name());\n            fragment = fragment + '<li id=\"designer-space-' + item.name().replace(/\\./g, '-') + '\" class=\"\"><a href=\"#' + system.id() + '#behaviors#' + item.name() + '\">' + item.name() + '</a></li>';\n            this.require('state').navigation().spaces().push('designer-space-' + item.name());\n          }.bind(this));\n          \n          if (fragment) {\n            componentdomItems.insertAdjacentHTML('beforeend', fragment);\n          }\n\n          // events\n          callback = function () {\n            _removeActive();\n            $(this).addClass('active');\n          };\n          length = componentdomItems.children.length;\n          for (i = 0; i < length; i++) {\n            item = componentdomItems.children[i];\n            item.addEventListener('click', callback);\n            item.addEventListener('click', function () {\n              this.click();\n            }.bind(self.components(i)));\n          }\n        }\n\n        // focus\n        if (this.items().length > 0) {\n          if ($('#designer-space-' + this.require('state').space().replace(/\\./g, '-')).length) {\n            $('#designer-space-' + this.require('state').space().replace(/\\./g, '-')).addClass('active');\n          } else {\n            item = systemdomItems.children[0];\n            $(item).addClass('active');\n            if (this.systems(0)) {\n              this.require('state').space(this.systems(0).name());\n            }\n          }\n        } else {\n          item = systemdomItems.children[0];\n          $(item).addClass('active');\n          if (this.systems(0)) {\n            this.require('state').space(this.systems(0).name());\n          }\n        }\n\n        break;\n        \n      case 'components':\n        // items\n        for (name in system.models()) {\n          spaceItem = new SpaceItem({\n            'name': system.models()[name]._name,\n            'uuid': name\n          });\n          items.push(spaceItem);\n        }\n        this.items(items);\n\n        // sort\n        this.items().sort(function (idA, idB) {\n          var a = runtime.require(idA),\n              b = runtime.require(idB);\n\n          var result = 0;\n          if (a.name() > b.name()) {\n            result = 1;\n          }\n          if (a.name() < b.name()) {\n            result = -1;\n          }\n          return result;\n        });\n\n        this.require('state').navigation().spaces([]);\n        fragment = '';\n        \n        this.items().forEach(function (item) {\n          fragment = fragment + '<li id=\"designer-space-' + item.name() + '\" class=\"\"><a href=\"#' + system.id() + '#components#' + item.name() + '\">' + item.name() + '</a></li>';\n          this.require('state').navigation().spaces().push('designer-space-' + item.name());\n        }.bind(this));\n        \n        if (fragment) {\n          domItems.insertAdjacentHTML('beforeend', fragment);\n        }\n\n        // events\n        callback = function () {\n          _removeActive();\n          $(this).addClass('active');\n        };\n        length = domItems.children.length;\n        for (i = 0; i < length; i++) {\n          item = domItems.children[i];\n          item.addEventListener('click', callback);\n          item.addEventListener('click', function () {\n            this.click();\n          }.bind(self.items(i)));\n        }\n        // focus\n        if (length > 0) {\n          if ($('#designer-space-' + this.require('state').space()).length) {\n            $('#designer-space-' + this.require('state').space()).addClass('active');\n          } else {\n            item = domItems.children[0];\n            $(item).addClass('active');\n            this.require('state').space(this.items(0).name());\n          }\n        }\n\n        break;\n      case 'logs':\n        this.require('state').navigation().spaces([]);\n        \n        fragment = '';\n\n        fragment = fragment + '<li id=\"designer-space-all\" class=\"\"><a href=\"#' + system.id() + '#logs#all\"\">All logs</a></li>';\n        this.require('state').navigation().spaces().push('designer-space-all');\n        fragment = fragment + '<li id=\"designer-space-error\" class=\"\"><a href=\"#' + system.id() + '#logs#error\"\">Error logs</a></li>';\n        this.require('state').navigation().spaces().push('designer-space-error');\n        fragment = fragment + '<li id=\"designer-space-warn\" class=\"\"><a href=\"#' + system.id() + '#logs#warn\"\">Warning logs</a></li>';\n        this.require('state').navigation().spaces().push('designer-space-warn');\n        fragment = fragment + '<li id=\"designer-space-info\" class=\"\"><a href=\"#' + system.id() + '#logs#info\"\">Info logs</a></li>';\n        this.require('state').navigation().spaces().push('designer-space-info');\n        fragment = fragment + '<li id=\"designer-space-debug\" class=\"\"><a href=\"#' + system.id() + '#logs#debug\"\">Debug logs</a></li>';\n        this.require('state').navigation().spaces().push('designer-space-debug');\n        \n         domItems.insertAdjacentHTML('beforeend', fragment);\n\n        // events\n        callback = function () {\n          _removeActive();\n          $(this).addClass('active');\n        };\n        length = domItems.children.length;\n        for (i = 0; i < length; i++) {\n          item = domItems.children[i];\n          item.addEventListener('click', callback);\n        }\n        // focus\n        if (length > 0) {\n          if ($('#designer-space-' + this.require('state').space()).length) {\n            $('#designer-space-' + this.require('state').space()).addClass('active');\n          } else {\n            item = domItems.children[0];\n            $(item).addClass('active');\n            this.require('state').space('all');\n          }\n        }\n        break;\n      default:\n        break;\n    }\n  }\n}","useCoreAPI":false,"core":false},"d1cb2d156c513e03":{"_id":"d1cb2d156c513e03","component":"Workspace","state":"init","action":"function init(conf) { \n  var that = this;\n\n  $('html')\n    .on('dragenter dragover', false)\n    .on('drop', function (e) {\n      e.stopPropagation();\n      e.preventDefault();\n      var files = e.originalEvent.dataTransfer.files;\n      var reader = new FileReader();\n      var json = '';\n      reader.onload = function (event) {\n        json += event.target.result;\n      };\n      reader.onloadend = function () {\n        try {\n          var sys = JSON.parse(json);\n          \n          if (\n            typeof sys._id !== 'undefined' &&\n            typeof sys.name !== 'undefined' &&\n            typeof sys.description !== 'undefined' &&\n            typeof sys.version !== 'undefined' &&\n            typeof sys.schemas !== 'undefined'\n            ) {\n            \n            var DialogDropFile = that.require('DialogDropFile');\n            \n            if (!that.require('factory').system()) {\n              DialogDropFile = new DialogDropFile({\n                'title': 'A system has been found',\n                'message': 'You can import the system.'\n              });\n            } else {\n              DialogDropFile = new DialogDropFile({\n                'title': 'A system has been found',\n                'message': 'You can import the system or compose it with the current system.'\n              });\n            }\n    \n            DialogDropFile.data(sys);\n            DialogDropFile.show();\n          } else {\n            that.require('message').warning('The file that you have dropped is not a valid system.');\n          }\n        } catch(e) {\n          that.require('message').warning('The file that you have dropped is not a valid system.');\n        }\n      };\n      if (files[0]) {\n        reader.readAsText(files[0], 'UTF-8');\n      }\n    });\n}","useCoreAPI":false,"core":false},"v1090710e8e1d9f9":{"_id":"v1090710e8e1d9f9","component":"Workspace","state":"create","action":"function create() {\n  var id = '',\n    Dialog = null,\n    dialog = null,\n    factory = this.require('factory'),\n    system = this.require('factory').system();\n\n  switch (this.require('state').menu()) {\n    case 'systems':\n      Dialog = this.require('DialogSystemCreation');\n      dialog = new Dialog({\n        'title': 'Create a new system',\n      });\n      dialog.show();\n      break;\n    case 'schemas':\n      if (system && Object.keys(system).length) {\n        Dialog = this.require('DialogSchemaCreation');\n        dialog = new Dialog({\n          'title': 'Create a new schema',\n        });\n        dialog.show();\n      }\n      break;\n    case 'models':\n      if (system && Object.keys(system).length) {\n        Dialog = this.require('DialogModelCreation');\n        dialog = new Dialog({\n          'title': 'Create a new model',\n        });\n        dialog.show();\n      }\n      break;\n    case 'types':\n      if (system && Object.keys(system).length) {\n        Dialog = this.require('DialogTypeCreation');\n        dialog = new Dialog({\n          'title': 'Create a new type',\n        });\n        dialog.show();\n      }\n      break;\n    case 'components':\n      if (system && Object.keys(system).length) {\n        var models = this.require('factory').system().models(),\n          component = {},\n          ModelComponent = null,\n          modelComponent = null,\n          modelName = '';\n\n        modelName = this.require('state').space();\n\n        if (typeof models[modelName] === 'undefined') {\n          \n          this.require('message-help').remove();\n\n          component = this.require('factory').addComponent(modelName);\n\n          ModelComponent = this.require('ModelComponent');\n\n          modelComponent = new ModelComponent({\n            title: component._id\n          });\n          modelComponent.model(modelName);\n          modelComponent.uuid(component._id);\n          modelComponent.document(JSON.parse(JSON.stringify(component)));\n          modelComponent.content(JSON.stringify(component));\n\n          modelComponent.render();\n\n          // little effect\n          $('#designer-component-' + component._id).hide();\n          $('#designer-component-' + component._id).fadeIn(1000);\n\n          this.require('designer').save();\n\n          this.require('channel').$designerCreateComponent(modelName, component);\n          this.require('message').success('Component created.');\n        } else {\n          this.require('message').warning('There is no schema. Create a schema before creating a component.');\n        }\n      }\n      break;\n    case 'behaviors':\n      if (system && Object.keys(system).length) {\n        Dialog = this.require('DialogBehaviorCreation');\n        dialog = new Dialog({\n          'title': 'Create a new behavior',\n        });\n        dialog.show();\n      }\n      break;\n    default:\n      break;\n  }\n}","useCoreAPI":false,"core":false},"f134d11639b1c4fe":{"_id":"f134d11639b1c4fe","component":"Workspace","state":"clear","action":"function clear() { \n  // force hide tooltip\n  $('.designer-model [data-toggle=\"tooltip\"]').tooltip('hide');\n  $('.designer-type [data-toggle=\"tooltip\"]').tooltip('hide');\n  \n  jsPlumb.ready(function () {\n    try {\n      jsPlumb.deleteEveryEndpoint();\n    } catch (e) {\n      \n    }\n  });\n  \n  $('#designer-workspace').empty();\n}","useCoreAPI":false,"core":false},"i131bd1870a18e7a":{"_id":"i131bd1870a18e7a","component":"e89c617b6b15d28","state":"start","action":"function start() { \n  var storeConfig = '';\n  \n  storeConfig = this.require('storage').get('system-designer-config');\n\n  if (!storeConfig) {\n    storeConfig = {};\n  }\n\n  // set 'language' default value\n  if (typeof storeConfig.language === 'undefined') {\n    storeConfig.language = 'en-US';\n    this.require('storage').set('system-designer-config', storeConfig);\n  } else {\n    this.require('i18n').locale(storeConfig.language);\n  }\n  \n  // set 'runtimeTracing' default value\n  if (typeof storeConfig.runtimeTracing === 'undefined') {\n    storeConfig.runtimeTracing = true;\n    this.require('storage').set('system-designer-config', storeConfig);\n  }\n  \n  this.require('designer').render();\n}","useCoreAPI":false,"core":false},"l1b9611fc10168ec":{"_id":"l1b9611fc10168ec","component":"State","state":"logs","action":"function logs(value, type) { \n  var html = '';\n  var filter = this.require('state').space();\n  var logNumber = 0;\n  var domEl = null;\n  \n  if (type === 'add') {\n    if (this.require('state').menu() === 'logs') {\n      switch (value.type()) {\n        case 'debug':\n          if (filter === 'all' || filter === 'debug' || filter === '') {\n            html = '<p class=\"text-muted\">' + value.log() + '</p>';\n          }  \n          break;\n        case 'info':\n          if (filter === 'all' || filter === 'info' || filter === '') {\n            html = '<p class=\"text-info\">' + value.log() + '</p>';\n          }  \n          break;\n        case 'warn':\n          if (filter === 'all' || filter === 'warn' || filter === '') {\n            html = '<p class=\"text-warning\">' + value.log() + '</p>';\n          }\n          break;\n        case 'error':\n          if (filter === 'all' || filter === 'error' || filter === '') {\n            html = '<p class=\"text-danger\">' + value.log() + '</p>';\n          }\n          break;\n        default:\n          break;\n      }\n  \n      domEl = document.querySelector('#designer-loug-output');\n      if (domEl) {\n        domEl.insertAdjacentHTML('beforeend',\n          html\n        );\n      }\n    } else {\n      requestAnimationFrame(function() {\n        // increment log number\n        var logNumber = parseInt(document.querySelector('#designer-menu-item-logs-number').innerHTML, 10);\n        document.querySelector('#designer-menu-item-logs-number').innerHTML = logNumber + 1;\n        $('#designer-menu-item-logs-number').show();\n      });\n    }\n  }\n}","useCoreAPI":false,"core":false},"p1d00311ad51ef9a":{"_id":"p1d00311ad51ef9a","component":"Designer","state":"welcome","action":"function welcome() { \n  var Dialog = null,\n      dialog = null,\n      config = null;\n\n  config = this.require('storage').get('system-designer-config');\n  if (!config) {\n    config = {};\n  }\n\n  if (typeof config.welcomeScreen === 'undefined') {\n    Dialog = this.require('DialogWelcome');\n    dialog = new Dialog({\n      'title': 'Welcome to System Designer'\n    });\n    dialog.show();\n    dialog.on('ok', function ok() {\n      var config = this.require('storage').get('system-designer-config');\n      if (!config) {\n        config = {};\n      }\n      config.welcomeScreen = false;\n      this.require('storage').set('system-designer-config', config);\n      this.hide();\n    });\n  }\n}","useCoreAPI":false,"core":false},"o12c7d1448a1dc16":{"_id":"o12c7d1448a1dc16","component":"Designer","state":"render","action":"function render() {\n  var System = null,\n    systemId = '',\n    config = {};\n\n  // message\n  this.require('logger').on('warn', function warn(message) {\n    this.require('message').warning(message);\n  });\n  this.require('logger').on('error', function error(message) {\n    this.require('message').danger(message);\n  });\n\n  // extensions\n  this.installExtensions();\n\n  // system\n  System = this.require('System');\n  var systems = this.require('storage').get('system-designer-systems');\n\n  // case of url\n  switch (true) {\n    case window.location.href.split('#').length > 1 && window.location.href.split('#')[1].length > 0:\n      systemId = window.location.href.split('#')[1];\n      if (this.require('storage').get(systemId)) {\n        this.require('factory').create(this.require('storage').get(systemId));\n      }\n      break;\n    default:\n      if (systems && systems.systems && systems.systems.length && typeof systems.systems[0] === 'string' && systems.systems[0].length) {\n        systems.systems.sort(function (sysA, sysB) {\n          var a = this.require('storage').get(sysA),\n            b = this.require('storage').get(sysB),\n            result = 0;\n\n          if (a.name > b.name) {\n            result = 1;\n          }\n          if (a.name < b.name) {\n            result = -1;\n          }\n          return result;\n        }.bind(this));\n\n        this.require('factory').create(this.require('storage').get(systems.systems[0]));\n      }\n      break;\n  }\n\n  this.welcome();\n\n  this.require('router').start();\n\n  if (typeof document.ontouchstart === 'undefined') {\n    // resize event\n    $(window).resize(function() {\n      jsPlumb.repaintEverything();\n    });\n  } else {\n    // orientation change event\n    window.addEventListener('orientationchange', function() {\n      setTimeout(function() {\n        window.scrollTo(0, 0);\n        if (typeof jsPlumb !== 'undefined') {\n          jsPlumb.repaintEverything();\n        }\n      }, 100);\n    });\n  }\n\n  this.require('menubar').render();\n  this.require('toolbar').render();\n  this.require('spaces').render();\n\n  this.addShorcuts();\n\n  // run messages if any\n  this.runMessages(this.require('state').messages());\n  this.require('state').messages([]);\n\n  // install PWA\n  window.addEventListener('beforeinstallprompt', (e) => {\n    var config = runtime.require('storage').get('system-designer-config');\n    if (!config) {\n      config = {};\n    }\n    if (typeof config.pwaInstalled === 'undefined' && config.welcomeScreen === false) {\n      config.pwaInstalled = false;\n      this.require('storage').set('system-designer-config', config);\n\n      e.preventDefault();\n      var Dialog = runtime.require('DialogInstallPWA');\n      var dialog = new Dialog({ 'title': 'Install System Designer' });\n      dialog.deferredPrompt(e);\n      dialog.show();\n    }\n  });\n}","useCoreAPI":false,"core":false},"x196fc166ef17a85":{"_id":"x196fc166ef17a85","component":"Designer","state":"linkModel","action":"function linkModel(source, target) { \n  jsPlumb.ready(function () {\n    jsPlumb.setContainer('body');\n\n    jsPlumb.connect({\n      paintStyle: {\n        stroke: '#7F949D',\n        strokeWidth: 3\n      },\n      source: 'designer-model-panel-' + source,\n      target: 'designer-model-panel-' + target,\n      overlays: [\n        ['Arrow', {\n          location: 1\n        }]\n      ]\n    }, {\n        connector: ['Flowchart'],\n        anchor: ['Left', 'Right'],\n        endpoint: 'Blank'\n      });\n  });\n}","useCoreAPI":false,"core":false},"k13951153851cc3a":{"_id":"k13951153851cc3a","component":"Designer","state":"save","action":"function save() { \n  var systems = this.require('storage').get('system-designer-systems'),\n    system = this.require('factory').toJSON(),\n    systemId = system._id;\n\n  if (typeof systemId === 'string') {\n    // save system\n    this.require('storage').set(systemId, system);\n  \n    // save index\n    if (!systems) {\n      systems = { 'systems': [systemId] };\n    } else {\n      if (systems.systems.indexOf(systemId) === -1) {\n        systems.systems.push(systemId);\n      }\n    }\n    this.require('storage').set('system-designer-systems', systems);\n  }\n}","useCoreAPI":false,"core":false},"u1cf0e155fb1e53f":{"_id":"u1cf0e155fb1e53f","component":"Workspace","state":"render","action":"function render() { \n  var ModelSystem = null,\n      ModelSchema = null,\n      ModelClass = null,\n      modelSchema = null,\n      ModelLog = null,\n      sys = null,\n      name = '',\n      id = '',\n      schemaId = '',\n      modelclass = null,\n      modellog = null,\n      ModelType = null,\n      type = null,\n      ModelComponent = null,\n      component = null,\n      ModelBehavior = null,\n      behavior = null,\n      system = this.require('factory').system(),\n      space = this.require('state').space(),\n      menu = this.require('state').menu(),\n      systemStore = {};\n      parentId = '',\n      parentsId = [],\n      parents = null,\n      systems = null,\n      systemIds = [],\n      i = 0,\n      length = 0,\n      title = 0,\n      nbElement = 0;\n\n  function _getSchemaId(name) {\n    var result = '',\n        id = '';\n\n    for (id in system.schemas()) {\n      if (system.schemas()[id]._name === name) {\n        result = id;\n        break;\n      }\n    }\n    return result;\n  }\n\n  function _getModelId(name) {\n    var result = '',\n        id = '';\n\n    for (id in system.models()) {\n      if (system.models()[id]._name === name) {\n        result = id;\n        break;\n      }\n    }\n    return result;\n  }\n\n  if (system && system.name() !== 'default') {\n    this.clear();\n\n    window.scrollTo(0, 0);\n\n    title = 'system ' + system.name();\n    if (title !== document.title) {\n      document.title = title;\n    }\n\n    switch (this.require('state').menu()) {\n      case 'systems':\n        systems = this.require('storage').get('system-designer-systems');\n\n        if (systems) {\n          systemIds = systems.systems;\n        }\n        length = systemIds.length;\n\n        for (i = 0; i < length; i++) {\n          systemStore = this.require('storage').get(systemIds[i]);\n          if (systemStore.name === space) {\n            ModelSystem = this.require('ModelSystem');\n            sys = new ModelSystem({\n              'title': systemStore.name\n            });\n            sys.uuid(systemStore._id);\n            sys.document(JSON.parse(JSON.stringify(systemStore)));\n            sys.content(JSON.stringify(systemStore));\n            sys.render();\n          }\n        }\n\n        if (space === '' && length > 0) {\n          this.require('message').warning('System not found.');\n        }\n\n        break;\n      case 'schemas':\n        if (space) {\n          for (id in system.schemas()) {\n            if (system.schemas()[id]._id === space) {\n              ModelSchema = this.require('ModelSchema');\n\n              // create parent if any\n              parentsId = [];\n              if (system.schemas()[id]._inherit) {\n                parents = system.schemas()[id]._inherit.slice();\n                parents.reverse();\n              }\n              length = 0;\n              if (parents) {\n                length = parents.length;\n              }\n\n              for (i = 0; i < length; i++) {\n                parentId = _getSchemaId(parents[i]);\n\n                modelSchema = new ModelSchema({\n                  'title': parents[i]\n                });\n                \n                if (parents[i] !== system.schemas()[id]._name) {\n                  if (parents[i] === '_Component') {\n                    parentId = \"111df11e2b19fde\";\n  \n                    var schemaRuntime = {\n                      \"_id\": \"_Component\",\n                      \"_name\": \"_Component\",\n                      \"_core\": true,\n                      \"id\": \"property\",\n                      \"init\": \"method\",\n                      \"destroy\": \"method\",\n                      \"require\": \"method\",\n                      \"error\": \"event\"\n                    };\n  \n                    modelSchema.document(schemaRuntime);\n                    modelSchema.content(JSON.stringify(schemaRuntime));\n                    parentsId.push(parentId);\n                    modelSchema.uuid(parentId);\n                  } else {\n                    if (system.schemas()[_getSchemaId(parents[i])]) {\n                      modelSchema.document(JSON.parse(JSON.stringify(system.schemas()[_getSchemaId(parents[i])])));\n                      modelSchema.content(JSON.stringify(system.schemas()[_getSchemaId(parents[i])]));\n                      parentsId.push(_getSchemaId(parents[i]));\n                      modelSchema.uuid(_getSchemaId(parents[i]));\n                    } else {\n                      parentsId.push(parents[i]);\n                      modelSchema.uuid(parents[i]);\n                    }\n                  }\n                  modelSchema.render();\n                }\n              }\n\n              modelSchema = new ModelSchema({\n                'title': system.schemas()[id]._name\n              });\n              modelSchema.uuid(id);\n              modelSchema.document(JSON.parse(JSON.stringify(system.schemas()[id])));\n              modelSchema.content(JSON.stringify(system.schemas()[id]));\n              modelSchema.editable(true);\n              modelSchema.render();\n\n              length = parentsId.length;\n              for (i = 0; i < length; i++) {\n                this.require('designer').linkModel(id, parentsId[i]);\n              }\n            }\n          }\n          if (Object.keys(system.schemas()).length === 0) {\n            this.require('message-help').render();\n          }\n        } else {\n          if (Object.keys(system.schemas()).length === 0) {\n            this.require('message-help').render();\n          }\n        }\n        break;\n      case 'models':\n        if (space) {\n          for (id in system.models()) {\n            if (system.models()[id]._id === space) {\n              ModelClass = this.require('ModelClass');\n\n              // create parent if any\n              // parents are search from the schema\n              schemaId = _getSchemaId(system.models()[id]._name);\n              parentsId = [];\n              if (schemaId && system.schemas()[schemaId]._inherit) {\n                parents = system.schemas()[schemaId]._inherit.slice();\n                parents.reverse();\n              }\n              length = 0;\n              if (parents) {\n                length = parents.length;\n              }\n\n              for (i = 0; i < length; i++) {\n\n                parentId = _getSchemaId(parents[i]);\n\n                modelclass = new ModelClass({\n                  'title': parents[i]\n                });\n\n                if (parents[i] === '_Component') {\n                  parentId = '123751cb591de26';\n\n                  var modelRuntime = {\n                    \"_name\": \"_Component\",\n                    \"_core\": true,\n                    \"id\": {\n                      \"description\": \"get the unique ID of a component\",\n                      \"type\": \"string\",\n                      \"readOnly\": true,\n                      \"mandatory\": false,\n                      \"default\": \"\"\n                    },\n                    \"init\": {\n                      \"description\": \"action to do when the component is created\",\n                      \"params\": [{\n                        \"name\": \"document\",\n                        \"type\": \"object\"\n                      }]\n                    },\n                    \"destroy\": {\n                      \"description\": \"action to do when the component is destroyed\",\n                      \"params\": []\n                    },\n                    \"require\": {\n                      \"description\": \"require a component\",\n                      \"params\": [{\n                        \"name\": \"id\",\n                        \"type\": \"string\"\n                      }],\n                      \"result\": \"_Component\"\n                    },\n                    \"error\": {\n                      \"description\": \"action to do when an error happened\",\n                      \"params\": [{\n                        \"name\": \"e\",\n                        \"type\": \"object\"\n                      }]\n                    }\n                  };\n\n                  modelclass.document(modelRuntime);\n                  modelclass.content(JSON.stringify(modelRuntime));\n                  parentsId.push(parentId);\n                  modelclass.uuid(parentId);\n                } else {\n                  if (system.models()[_getModelId(parents[i])]) {\n                    modelclass.document(JSON.parse(JSON.stringify(system.models()[_getModelId(parents[i])])));\n                    modelclass.content(JSON.stringify(system.models()[_getModelId(parents[i])]));\n                    parentsId.push(_getModelId(parents[i]));\n                    modelclass.uuid(_getModelId(parents[i]));\n                  } else {\n                    parentsId.push(parents[i]);\n                    modelclass.uuid(parentId);\n                  }\n                }\n                modelclass.render();\n              }\n\n              modelclass = new ModelClass({\n                'title': system.models()[id]._name\n              });\n              modelclass.uuid(id);\n              modelclass.document(JSON.parse(JSON.stringify(system.models()[id])));\n              modelclass.content(JSON.stringify(system.models()[id]));\n              modelclass.editable(true);\n              modelclass.render();\n\n              length = parentsId.length;\n              for (i = 0; i < length; i++) {\n                this.require('designer').linkModel(id, parentsId[i]);\n              }\n            }\n          }\n        } else {\n          if (Object.keys(system.schemas()).length === 0) {\n            this.require('message-help').render();\n          }\n        }\n        break;\n      case 'types':\n        if (space) {\n          for (name in system.types())\n            if (system.types()[name].name === space) {\n              ModelType = this.require('ModelType');\n              type = new ModelType({\n                'title': name\n              });\n              type.uuid(name);\n              type.document(JSON.parse(JSON.stringify(system.types()[space])));\n              type.content(JSON.stringify(system.types()[space]));\n              type.render();\n            }\n            if (Object.keys(system.types()).length === 0) {\n              this.require('message-help').render();\n            }\n        } else {\n          if (Object.keys(system.types()).length === 0) {\n            this.require('message-help').render();\n          }\n        }\n        break;\n      case 'components':\n        var nbComponents = 0;\n        if (space) {\n          if (this.require('state').component()) {\n            name = this.require('state').component();\n            if (system.components()[space] && system.components()[space][name]) {\n              ModelComponent = this.require('ModelComponent');\n              component = new ModelComponent({\n                'title': name\n              });\n              component.uuid(name);\n              component.model(space);\n              component.document(JSON.parse(JSON.stringify(system.components()[space][name])));\n              component.content(JSON.stringify(system.components()[space][name]));\n              component.render();\n            } else {\n              this.require('message-help').render();\n            }\n          } else {\n            for (name in system.components()[space]) {\n              ModelComponent = this.require('ModelComponent');\n              component = new ModelComponent({\n                'title': name\n              });\n              component.uuid(name);\n              component.model(space);\n              component.document(JSON.parse(JSON.stringify(system.components()[space][name])));\n              component.content(JSON.stringify(system.components()[space][name]));\n              component.render();\n              nbComponents = nbComponents + 1;\n              \n              if (nbComponents === 50) {\n                this.require('message').warning('For performance reason you will only see the first 50 components.');\n                break;\n              }\n            }\n            \n            if (system.components()) {\n              if (system.components()[space]) {\n                if (Object.keys(system.components()[space]).length === 0) {\n                  this.require('message-help').render();\n                }\n              } else {\n                this.require('message-help').render();\n              }\n            } else {\n              this.require('message-help').render();\n            }\n          }\n        } else {\n          if (Object.keys(system.components()).length === 0) {\n            this.require('message-help').render();\n          }\n        }\n        break;\n      case 'behaviors':\n        if (space) {\n          name = this.require('state').component();\n          var behaviorDef = {};\n          var behaviorsId = Object.keys(system.behaviors());\n          var systemName = this.require('factory').system().name();\n          var systemId = this.require('factory').system().id();\n          ModelBehavior = this.require('ModelBehavior');\n          \n          behaviorsId.forEach(function(id) {\n            behaviorDef = system.behaviors()[id];\n            if (behaviorDef.component === space) {\n                if ((name && behaviorDef.state === name) || name === '') {\n                  behavior = new ModelBehavior({\n                    'uuid': system.behaviors()[id]._id\n                  });\n                  behavior.title(behaviorDef.state);\n                  behavior.document(behaviorDef);\n                  behavior.content(JSON.parse(JSON.stringify(behaviorDef.action)));\n                  behavior.render();\n                  \n                  nbElement = nbElement + 1;\n                }\n            }\n\n            // system\n            if (space === systemName) {\n              if (behaviorDef.component === systemId) {\n                behavior = new ModelBehavior({\n                  'uuid': behaviorDef._id\n                });\n                behavior.title(behaviorDef.state);\n                behavior.document(behaviorDef);\n                behavior.content(JSON.parse(JSON.stringify(behaviorDef.action)));\n                behavior.render();\n                \n                nbElement = nbElement + 1;\n              }\n            }\n          }.bind(this));\n          \n          if (nbElement === 0) {\n            this.require('message-help').render();\n          } else {\n            Prism.highlightAll();\n          }\n        } else {\n          if (Object.keys(system.behaviors()).length === 0) {\n            this.require('message-help').render();\n          }\n        }\n        break;\n      case 'logs':\n        document.querySelector('#designer-menu-item-logs-number').innerHTML = 0;\n        $('#designer-menu-item-logs-number').hide();\n        \n        ModelLog = this.require('ModelLog');\n\n        modelLog = new ModelLog();\n        modelLog.render();\n\n        break;\n      default:\n        break;\n    }\n  } else {\n\n    document.title = '';\n    document.title = 'System Designer';\n    \n    this.require('message-help').render();\n    \n    if (system && system.name() === 'default') {\n      this.require('message').warning('System not found: the system has been deleted.');\n    } else {\n      systems = this.require('storage').get('system-designer-systems');\n      if (systems && systems.systems && systems.systems.length) {\n        this.require('message').warning('System not found: click on the Systems tab to reload your context.');\n      }\n    }\n  }\n}","useCoreAPI":false,"core":false},"s1876e1b64c1251e":{"_id":"s1876e1b64c1251e","component":"Router","state":"update","action":"function update() { \n  var menubar = [],\n      i = 0,\n      length = 0,\n      collection = '',\n      href = '',\n      context = '',\n      space = '',\n      schemaName = '',\n      schemaId = '',\n      modelName = '',\n      modelId = '';\n  \n  function _getModelId(name, models) {\n    var result = '',\n        id = '';\n\n    for (id in models) {\n      if (models[id]._name === name) {\n        result = id;\n        break;\n      }\n    }\n    return result;\n  }\n\n  function _getSchemaId(name, schemas) {\n    var result = '',\n        id = '';\n\n    for (id in schemas) {\n      if (schemas[id]._name === name) {\n        result = id;\n        break;\n      }\n    }\n    return result;\n  }\n\n  function _getModelName(id, models) {\n    var result = '',\n        modelId = '';\n\n    for (modelId in models) {\n      if (modelId === id) {\n        result = models[id]._name;\n        break;\n      }\n    }\n    return result;\n  }\n\n  function _getSchemaName(id, schemas) {\n    var result = '',\n        schemaId = '';\n\n    for (schemaId in schemas) {\n      if (schemaId === id) {\n        result = schemas[id]._name;\n        break;\n      }\n    }\n    return result;\n  }\n\n  function _getCollection(href) {\n    var result = '';\n\n    if (href.split('#').length === 2) {\n      result = href.split('#')[1];\n    }\n    if (href.split('#').length > 2) {\n      result = href.split('#')[2];\n    }\n\n    result = result.split('#')[0];\n    result = result.trim();\n\n    return result;\n  }\n\n  context = this.require('state').menu();\n  space = this.require('state').space();\n\n  switch (context) {\n    case 'schemas':\n      if (this.require('factory').system()) {\n        if (space) {\n          schemaName = _getSchemaName(space, this.require('factory').system().schemas());\n          modelId = _getModelId(schemaName, this.require('factory').system().models());\n        }\n\n        menubar = $('#designer-menubar-items > li > a');\n        length = menubar.length;\n        for (i = 0; i < length; i++) {\n          href = menubar[i].href;\n          collection = _getCollection(href);\n          menubar[i].href = '#' + this.require('factory').system().id() + '#' + collection;\n\n          if (collection === 'models' && modelId) {\n            menubar[i].href = menubar[i].href + '#' + modelId;\n          }\n          if (collection === 'components' && schemaName) {\n            menubar[i].href = menubar[i].href + '#' + schemaName;\n          }\n          if (collection === 'behaviors' && schemaName) {\n            menubar[i].href = menubar[i].href + '#' + schemaName;\n          }\n        }\n      } else {\n        menubar = $('#designer-menubar-items > li > a');\n        length = menubar.length;\n        for (i = 0; i < length; i++) {\n          href = menubar[i].href;\n          collection = _getCollection(href);\n          menubar[i].href = '##' + collection;\n        }\n      }\n      break;\n    case 'models':\n      if (this.require('factory').system()) {\n        if (space) {\n          modelName = _getModelName(space, this.require('factory').system().models());\n          schemaId = _getSchemaId(modelName, this.require('factory').system().schemas());\n        }\n\n        menubar = $('#designer-menubar-items > li > a');\n        length = menubar.length;\n        for (i = 0; i < length; i++) {\n          href = menubar[i].href;\n          collection = _getCollection(href);\n          menubar[i].href = '#' + this.require('factory').system().id() + '#' + collection;\n\n          if (collection === 'schemas' && schemaId) {\n            menubar[i].href = menubar[i].href + '#' + schemaId;\n          }\n          if (collection === 'components' && modelName) {\n            menubar[i].href = menubar[i].href + '#' + modelName;\n          }\n          if (collection === 'behaviors' && modelName) {\n            menubar[i].href = menubar[i].href + '#' + modelName;\n          }\n        }\n      } else {\n        menubar = $('#designer-menubar-items > li > a');\n        length = menubar.length;\n        for (i = 0; i < length; i++) {\n          href = menubar[i].href;\n          collection = _getCollection(href);\n          menubar[i].href = '##' + collection;\n        }\n      }\n      break;\n    case 'behaviors':\n      if (this.require('factory').system()) {\n        if (space) {\n          modelId = _getModelId(space, this.require('factory').system().models());\n          schemaId = _getSchemaId(space, this.require('factory').system().schemas());\n          schemaName = _getSchemaName(schemaId, this.require('factory').system().schemas());\n        }\n\n        menubar = $('#designer-menubar-items > li > a');\n        length = menubar.length;\n        for (i = 0; i < length; i++) {\n          href = menubar[i].href;\n          collection = _getCollection(href);\n          menubar[i].href = '#' + this.require('factory').system().id() + '#' + collection;\n\n          if (collection === 'schemas' && schemaId) {\n            menubar[i].href = menubar[i].href + '#' + schemaId;\n          }\n          if (collection === 'models' && modelId) {\n            menubar[i].href = menubar[i].href + '#' + modelId;\n          }\n          if (collection === 'components' && modelId) {\n            menubar[i].href = menubar[i].href + '#' + schemaName;\n          }\n        }\n      } else {\n        menubar = $('#designer-menubar-items > li > a');\n        length = menubar.length;\n        for (i = 0; i < length; i++) {\n          href = menubar[i].href;\n          collection = _getCollection(href);\n          menubar[i].href = '##' + collection;\n        }\n      }\n      break;\n    case 'components':\n      if (this.require('factory').system()) {\n        if (space) {\n          modelId = _getModelId(space, this.require('factory').system().models());\n          schemaId = _getSchemaId(space, this.require('factory').system().schemas());\n          schemaName = _getSchemaName(schemaId, this.require('factory').system().schemas());\n        }\n\n        menubar = $('#designer-menubar-items > li > a');\n        length = menubar.length;\n        for (i = 0; i < length; i++) {\n          href = menubar[i].href;\n          collection = _getCollection(href);\n          menubar[i].href = '#' + this.require('factory').system().id() + '#' + collection;\n\n          if (collection === 'schemas' && schemaId) {\n            menubar[i].href = menubar[i].href + '#' + schemaId;\n          }\n          if (collection === 'models' && modelId) {\n            menubar[i].href = menubar[i].href + '#' + modelId;\n          }\n          if (collection === 'behaviors' && modelId) {\n            menubar[i].href = menubar[i].href + '#' + schemaName;\n          }\n        }\n      } else {\n        menubar = $('#designer-menubar-items > li > a');\n        length = menubar.length;\n        for (i = 0; i < length; i++) {\n          href = menubar[i].href;\n          collection = _getCollection(href);\n          menubar[i].href = '##' + collection;\n        }\n      }\n      break;\n    default:\n      if (this.require('factory').system()) {\n        menubar = $('#designer-menubar-items > li > a');\n        length = menubar.length;\n        for (i = 0; i < length; i++) {\n          href = menubar[i].href;\n          collection = _getCollection(href);\n          menubar[i].href = '#' + this.require('factory').system().id() + '#' + collection;\n        }\n      } else {\n        menubar = $('#designer-menubar-items > li > a');\n        length = menubar.length;\n        for (i = 0; i < length; i++) {\n          href = menubar[i].href;\n          collection = _getCollection(href);\n          menubar[i].href = '##' + collection;\n        }\n      }\n      break;\n  }\n}","useCoreAPI":false,"core":false},"a1e92e1b7d6162ab":{"_id":"a1e92e1b7d6162ab","component":"Router","state":"start","action":"function start() { \n  var that = this;\n  \n  window.onhashchange = function (e) {\n    var arr = window.location.href.split('#'),\n      system = '',\n      collection = 'systems',\n      component = '',\n      i = 0,\n      length = 0,\n      item = null,\n      domItems = null,\n      System = that.require('System'),\n      systems = that.require('storage').get('system-designer-systems');\n\n    if (arr.length > 1) {\n      system = arr[1];\n      system = system.split('?')[0];\n    }\n\n    if (arr.length > 2) {\n      collection = arr[2];\n      collection = collection.split('?')[0];\n    }\n\n    if (arr.length > 3) {\n      component = arr[3];\n      component = component.split('?')[0];\n    }\n\n    if (arr.length > 4) {\n      that.require('state').component(arr[4].split('?')[0]);\n    } else {\n      that.require('state').component('');\n    }\n    \n    if (arr.length > 1 && system) {\n      that.require('factory').create(that.require('storage').get(system));\n    } else {\n      if (systems && systems.systems && systems.systems.length) {\n        that.require('factory').create(that.require('storage').get(systems.systems[0]));\n      }\n    }\n    \n    that.require('state').space(decodeURIComponent(component));\n    that.require('state').menu(decodeURIComponent(collection));\n\n    // focus\n    domItems = document.getElementById('designer-menubar-items');\n    length = that.require('menubar').items().length;\n    for (i = 0; i < length; i++) {\n      item = domItems.children[i];\n      $(item).removeClass('active');\n    }\n    for (i = 0; i < length; i++) {\n      if (that.require('menubar').items(i).name() === collection) {\n        item = domItems.children[i];\n        $(item).addClass('active');\n      }\n    }\n\n    that.update();\n  };\t\n}","useCoreAPI":false,"core":false},"v10ccc18f431a78e":{"_id":"v10ccc18f431a78e","component":"State","state":"menu","action":"function menu(value) { \n  jsPlumb.ready(function () {\n    try {\n      jsPlumb.deleteEveryEndpoint();\n    } catch (e) {\n    }\n  });\n\n  this.require('spaces').render();\n  this.require('workspace').clear();\n  this.require('workspace').render();\n}","useCoreAPI":false,"core":false},"n17df1112301e0cf":{"_id":"n17df1112301e0cf","component":"State","state":"space","action":"function space(value) { \n  if (this.menu() === 'systems') {\n    this.require('router').update();\n  }\n}","useCoreAPI":false,"core":false},"j1fc1a152e61a7b9":{"_id":"j1fc1a152e61a7b9","component":"_Channel","state":"send","action":"function send(message) { \n  if (message.event.indexOf('$system') !== 0) {\n    var config = this.require('storage').get('system-designer-config');\n    // message for other windows\n    this.require('storage').set('system-designer-message', message);\n\n    // message for client debug\n    if (this.require('designer').debugWindow()) {\n      this.require('designer').debugWindow().postMessage(JSON.stringify(message), '*');\n    }\n\n    // message for server debug\n    if (typeof config !== 'undefined' && typeof config.debugType !== 'undefined' && config.debugType === 'server' && config.urlServer) {\n      $.post(config.urlServer.replace(':8888', '') + ':8888/' + message.event, encodeURIComponent(JSON.stringify(message.data)));\n    }\n  }\t\n}","useCoreAPI":false,"core":false},"s11b84108ec12d82":{"_id":"s11b84108ec12d82","component":"_Channel","state":"$appLogDebug","action":"function $appLogDebug(message) { \n  var log = '',\n      Log = null;\n\n  Log = this.require('Log');\n  log = new Log({\n    'type': 'debug',\n    'log': message.replace('runtime:', '').replace(/\\[[^\\]]+\\]/, '<strong>debug:</strong> ')\n  });\n\n  this.require('state').logs().push(log);\n}","useCoreAPI":false,"core":false},"s1274812bab1ab3d":{"_id":"s1274812bab1ab3d","component":"_Channel","state":"$appLogInfo","action":"function $appLogInfo(message) { \n  var log = '',\n      Log = null;\n\n  Log = this.require('Log');\n  log = new Log({\n    'type': 'info',\n    'log': message.replace('runtime:', '').replace(/\\[[^\\]]+\\]/, '<strong>info:</strong> ')\n  });\n\n  this.require('state').logs().push(log);\n  this.require('message').info(message.replace(/\\[[^\\]]+\\]/, '<strong>runtime:</strong> '));\t\n}","useCoreAPI":false,"core":false},"b1c5cb1ee0b195fc":{"_id":"b1c5cb1ee0b195fc","component":"_Channel","state":"$appLogWarn","action":"function $appLogWarn(message) { \n  var log = '',\n      Log = null;\n\n  Log = this.require('Log');\n  log = new Log({\n    'type': 'warn',\n    'log': message.replace('runtime:', '').replace(/\\[[^\\]]+\\]/, '<strong>warning:</strong> ')\n  });\n\n  this.require('state').logs().push(log);\n  this.require('message').warning(message.replace(/\\[[^\\]]+\\]/, '<strong>runtime:</strong> '));\t\n}","useCoreAPI":false,"core":false},"i1b8de1d60316328":{"_id":"i1b8de1d60316328","component":"_Channel","state":"$appLogError","action":"function $appLogError(message) { \n  var log = '',\n      Log = null;\n\n  Log = this.require('Log');\n  log = new Log({\n    'type': 'error',\n    'log': message.replace('runtime:', '').replace(/\\[[^\\]]+\\]/, '<strong>error:</strong> ')\n  });\n\n  this.require('state').logs().push(log);\n  this.require('message').danger(message.replace(/\\[[^\\]]+\\]/, '<strong>runtime:</strong> '));\t\n}","useCoreAPI":false,"core":false},"h1ad061990d1bcc5":{"_id":"h1ad061990d1bcc5","component":"_Channel","state":"$editorUpdateType","action":"function $editorUpdateType(id, type) { \n  this.require('factory').updateType(id, type);\n\n  this.require('designer').save();\n\n  this.require('state').space(type.name);\n  \n  this.require('spaces').render();\n  this.require('workspace').render();\t\n}","useCoreAPI":false,"core":false},"h1275e1a9791051a":{"_id":"h1275e1a9791051a","component":"_Channel","state":"$editorDeleteType","action":"function $editorDeleteType(id) { \n  var dbTypes = [],\n      type = null;\n\n  dbTypes = this.require('db').collections().ModelType.find({\n    'uuid': id\n  });\n  if (dbTypes.length) {\n    type = this.require(dbTypes[0]._id);\n    if (type) {\n      type.hide();\n      type.destroy();\n    }\n  }\n\n  this.require('factory').deleteType(id);\n\n  this.require('designer').save();\n  \n  this.require('workspace').render();\t\n}","useCoreAPI":false,"core":false},"u1b3231dd52189ee":{"_id":"u1b3231dd52189ee","component":"_Channel","state":"$editorUpdateSchemaName","action":"function $editorUpdateSchemaName(name, id) { \n  this.require('factory').updateSchemaName(name, id);\n  \n  this.require('designer').save();\t\n}","useCoreAPI":false,"core":false},"w17e86178ff1ac10":{"_id":"w17e86178ff1ac10","component":"_Channel","state":"$editorUpdateSchema","action":"function $editorUpdateSchema(id, schema) { \n  var oldModel = this.require('factory').getGeneratedModel(schema._name);\n      schemas = this.require('factory').system().schemas(),\n      models = null,\n      model = null,\n      modelId = '';\n\n  this.require('factory').syncModel(schema);\n  \n  this.require('designer').save();\n  \n  this.require('factory').updateSchema(id, schema);\n  \n  this.require('designer').save();\n\n  // sync other components\n  models = this.require('factory').system().models();\n  for (modelId in models) {\n    if (models[modelId]._name !== schema._name) {\n      model = models[modelId];\n      this.require('factory').syncComponent(model, oldModel, true);\n    }\n  }\n  \n  this.require('designer').save();\n\n  this.require('state').space(id);\n  \n  this.require('spaces').render();\n  this.require('workspace').render();\t\n}","useCoreAPI":false,"core":false},"f14bae11650167a7":{"_id":"f14bae11650167a7","component":"_Channel","state":"$editorUpdateSchemaId","action":"function $editorUpdateSchemaId(oldId, newId) { \n  this.require('factory').updateSchemaId(oldId, newId);\n\n  this.require('designer').save();\n  \n  this.require('workspace').render();\t\n}","useCoreAPI":false,"core":false},"n1cd861eb1d1d0a5":{"_id":"n1cd861eb1d1d0a5","component":"_Channel","state":"$editorUpdateModel","action":"function $editorUpdateModel(id, model) { \n  var oldModel = this.require('factory').getGeneratedModel(model._name);\n\n  this.require('factory').updateModel(id, model);\n\n  this.require('designer').save();\n\n  this.require('factory').syncBehavior(model);\n  \n  this.require('designer').save();\n  \n  this.require('factory').syncComponent(model, oldModel, true);\n\n  this.require('state').space(id);\n  \n  this.require('spaces').render();\n  this.require('workspace').render();\t\n  \n   $(function () {\n    $('[role=\"tooltip\"]').hide();\n    $('[data-toggle=\"tooltip\"]').tooltip({ 'container': 'body', delay: { 'show': 1500, 'hide': 100 }, trigger: 'hover' });\n  });\n}","useCoreAPI":false,"core":false},"n1a1a113960107dd":{"_id":"n1a1a113960107dd","component":"_Channel","state":"$editorUpdateModelId","action":"function $editorUpdateModelId(oldId, newId) { \n  this.require('factory').updateModelId(oldId, newId);\n\n  this.require('designer').save();\n  \n  this.require('workspace').render();\t\n}","useCoreAPI":false,"core":false},"m1219c18bd215028":{"_id":"m1219c18bd215028","component":"_Channel","state":"$designerUpdateBehavior","action":"function $designerUpdateBehavior(id, behavior) { \n  this.require('factory').udpdateBehavior(id, behavior);\n\n  this.require('designer').save();\n  \n  this.require('workspace').render();\t\n}","useCoreAPI":false,"core":false},"g1271811dd61f96f":{"_id":"g1271811dd61f96f","component":"_Channel","state":"$editorDeleteBehavior","action":"function $editorDeleteBehavior(id) { \n  var dbBehaviors = [],\n      behavior = null;\n\n  dbBehaviors = this.require('db').collections().ModelBehavior.find({\n    'uuid': id\n  });\n  if (dbBehaviors.length) {\n    behavior = this.require(dbBehaviors[0]._id);\n    if (behavior) {\n      behavior.hide();\n      behavior.destroy();\n    }\n  }\n\n  this.require('factory').deleteBehavior(id);\n\n  this.require('designer').save();\n  \n  this.require('workspace').render();\t\n}","useCoreAPI":false,"core":false},"m1433e1b8e71050a":{"_id":"m1433e1b8e71050a","component":"_Channel","state":"$editorUpdateComponent","action":"function $editorUpdateComponent(id, collection, component) { \n  this.require('factory').overwriteComponent(id, collection, component);\n\n  this.require('designer').save();\n\n  this.require('workspace').render();\t\n}","useCoreAPI":false,"core":false},"e1acfa1989b122ec":{"_id":"e1acfa1989b122ec","component":"_Channel","state":"$editorDeleteComponent","action":"function $editorDeleteComponent(id, collection) { \n var models = [],\n    model = null;\n\n  models = this.require('db').collections().ModelComponent.find({\n    'uuid': id\n  });\n  if (models.length) {\n    model = this.require(models[0]._id);\n    if (model) {\n      model.hide();\n      model.destroy();\n    }\n  }\n\n  this.require('factory').deleteComponent(id, collection);\n\n  this.require('designer').save();\n  this.require('workspace').render();\t\n}","useCoreAPI":false,"core":false},"x11f721f8111c41a":{"_id":"x11f721f8111c41a","component":"_Channel","state":"$editorUpdateSystem","action":"function $editorUpdateSystem(id, system) { \n  this.require('factory').updateSystem(id, system);\n  \n  this.require('designer').save();\n\n  this.require('state').space(system.name);\n  \n  this.require('spaces').render();\n  this.require('workspace').render();\t\n}","useCoreAPI":false,"core":false},"d180f31873a19ef7":{"_id":"d180f31873a19ef7","component":"_Channel","state":"$appLoadSystem","action":"function $appLoadSystem(system) { \n  var Dialog = null,\n      dialog = null,\n      message = this.require('message');\n\n  if (system.name) {\n    if (system.name !== 'designer-runtime') {\n      Dialog = this.require('DialogImport');\n      dialog = new Dialog({\n        'title': 'A system has been found',\n        'message': 'Do you want to import the system ?',\n        'data': system\n      });\n      dialog.show();\n  \n      dialog.on('ok', function () {\n        var sys = null,\n            designer = this.require('designer'),\n            message = this.require('message');\n  \n        if (this.require('factory').system()) {\n          this.require('factory').system().destroy();\n        }\n  \n        sys = this.require('factory').create(this.data());\n  \n        // empty log\n        this.require('state').logs().forEach(function (item) {\n          this.logs().pop();\n        }.bind(this.require('state')));\n        \n        // hide log\n        $('#designer-menu-item-logs-number').hide();\n        document.querySelector('#designer-menu-item-logs-number').innerHTML = 0;\n  \n        designer.save();\n  \n        this.require('state').space(sys.name());\n        \n        this.require('spaces').render();\n        this.require('workspace').render();\n  \n        this.require('router').update();\n  \n        this.hide();\n        designer.save();\n  \n        message.success('Importation of the system is done.');\n      });\n    }\n  } else {\n    message.warning('There is no system to import.');\n  }\n}","useCoreAPI":false,"core":false},"r1318213d401b598":{"_id":"r1318213d401b598","component":"_Channel","state":"$runtimeCreateComponent","action":"function $runtimeCreateComponent(collection, component) { \n  var message = '',\n    log = '',\n    Log = null,\n    storeConfig;\n    \n  storeConfig = this.require('storage').get('system-designer-config');\n    \n  if (component._id !== 'runtimeHelper' && storeConfig.runtimeTracing) {\n    message = 'the component \\'' + component._id + '\\' (' + collection + ' model) has been created';\n\n    Log = this.require('Log');\n    log = new Log({\n      'type': 'debug',\n      'log': '<strong>debug:</strong> ' + message\n    });\n  \n    this.require('state').logs().push(log);\n  }\n  \n  this.require('factory').createComponent(collection, component);\n\n  this.require('designer').save();\n\n  if (this.require('state').menu() === 'components') {\n    this.require('workspace').render();\n  }\t\n}","useCoreAPI":false,"core":false},"a125ea107d41f237":{"_id":"a125ea107d41f237","component":"_Channel","state":"$runtimeDeleteComponent","action":"function $runtimeDeleteComponent(id, collection) { \n  var message = '',\n    log = '',\n    Log = null,\n    storeConfing;\n    \n  storeConfig = this.require('storage').get('system-designer-config');\n  \n  if (storeConfig.runtimeTracing) {\n    message = 'the component \\'' + id + '\\' (' + collection + ' model) has been deleted';\n  \n    Log = this.require('Log');\n    log = new Log({\n      'type': 'debug',\n      'log': '<strong>debug:</strong> ' + message\n    });\n  \n    this.require('state').logs().push(log);\n  }\n  \n  this.require('factory').deleteComponent(id, collection);\n\n  this.require('designer').save();\n\n  if (this.require('state').menu() === 'components') {\n    this.require('workspace').render();\n  }\n}","useCoreAPI":false,"core":false},"n1636d1853518a09":{"_id":"n1636d1853518a09","component":"_Channel","state":"$runtimeUpdateComponent","action":"function $runtimeUpdateComponent(id, collection, field, value) { \n  var message = '',\n    log = '',\n    Log = null,\n    storeConfig;\n    \n  storeConfig = this.require('storage').get('system-designer-config');\n  \n  if (storeConfig.runtimeTracing) {\n    message = 'the component \\'' + id + '\\' (' + collection + ' model) has a new value for the field \\'' + field  + '\\': '  + JSON.stringify(value);\n  \n    Log = this.require('Log');\n    log = new Log({\n      'type': 'debug',\n      'log': '<strong>debug:</strong> ' + message\n    });\n  \n    this.require('state').logs().push(log);\n  }\n \n  this.require('factory').updateComponent(id, collection, field, value);\n  \n  this.require('designer').save();\n  \n  if (this.require('state').menu() === 'components') {\n    this.require('workspace').render();\n  }\n}","useCoreAPI":false,"core":false},"v165f81ca0d1bd5f":{"_id":"v165f81ca0d1bd5f","component":"_Channel","state":"$designerDeleteSchema","action":"function $designerDeleteSchema(id) { \n  var dbSchemas = [],\n      schema = null;\n\n  dbSchemas = this.require('db').collections().ModelSchema.find({\n    'uuid': id\n  });\n  if (dbSchemas.length) {\n      schema = this.require(dbSchemas[0]._id);\n      if (schema) {\n          schema.hide();\n          schema.destroy();\n      }\n  }\n\n  this.require('factory').deleteSchema(id, false);\n  \n  this.require('designer').save();\n  \n  this.require('workspace').render();\t\n}","useCoreAPI":false,"core":false},"u1a9411d65313eb8":{"_id":"u1a9411d65313eb8","component":"_Channel","state":"$editorUpdateBehavior","action":"function $editorUpdateBehavior(id, behavior) { \n    this.require('factory').updateBehavior(id, behavior);\n\n    this.require('designer').save();\n    \n    this.require('workspace').render();\n}","useCoreAPI":false,"core":false},"s192131208d1553f":{"_id":"s192131208d1553f","component":"_Channel","state":"init","action":"function init(conf) { \n  window.addEventListener('message', function message(event) {\n    var data = null,\n        config = this.require('storage').get('system-designer-config');\n\n    if (!config) {\n      config = {};\n    }\n    data = JSON.parse(event.data);\n    if (data &&\n      typeof data.event !== 'undefined' &&\n      typeof data.from !== 'undefined' &&\n      typeof data.data !== 'undefined') {\n      $db._Message.insert(data);\n    }\n  }.bind(this), false);\n\n  this.require('_Storage').on('changed', function changed(obj) {\n    if (typeof obj['system-designer-message'] !== 'undefined') {\n      if (this.require('designer').debugWindow()) {\n        this.require('designer').debugWindow().postMessage(JSON.stringify(obj['system-designer-message'].newValue), '*');\n      }\n      $db._Message.insert(obj['system-designer-message'].newValue);\n    }\n  }, true);\t\n}","useCoreAPI":true,"core":false},"i1fa311dc26116f8":{"_id":"i1fa311dc26116f8","component":"y187401decb196c4","state":"click","action":"function click() {\n  $('#designer-toolbar-item-export').tooltip('hide');\n  if ($('#designer-dialog').children().length) {\n    $('#' + $(\"#designer-dialog\").children()[0].id).removeClass('fade').modal('hide');\n  }\n  \n  var message = this.require('message');\n  var Dialog = this.require('DialogExport');\n  var system = this.require('factory').system();\n\n  if (system && system.name() !== 'default') {\n    var dialog = new Dialog({\n      'title': 'Export the current system',\n    });\n    dialog.show();\n  } else {\n    message.warning('There is no system to export.');\n  }\n}","useCoreAPI":false,"core":false},"f1ae6e164301b982":{"_id":"f1ae6e164301b982","component":"x1371910b7812e58","state":"click","action":"function click() {\n  var debugWindow = this.require('designer').debugWindow(),\n    config = this.require('storage').get('system-designer-config'),\n    message = this.require('message');\n\n  $('#designer-toolbar-item-refresh').tooltip('hide');\n  if ($('#designer-dialog').children().length) {\n    $('#' + $(\"#designer-dialog\").children()[0].id).removeClass('fade').modal('hide');\n  }\n  \n  if (config) {\n    if (typeof config.debugType !== 'undefined' && config.debugType === 'client') {\n      if (config.urlClient) {\n        if (debugWindow && !debugWindow.closed) {\n          message.success('Searching for a remote system...');\n          this.require('channel').$designerSync();\n        } else {\n          message.success('Opening the remote system...');\n          this.require('designer').debugWindow(this.require('designer').open(config.urlClient, 'debug'));\n        }\n      } else {\n        message.warning('No url set. Please set the url in the configuration panel.');\n      }\n    }\n    if (typeof config.debugType !== 'undefined' && config.debugType === 'server') {\n      if (config.urlServer) {\n        message.success('Searching for a server...');\n        var self = this;\n        $.getJSON(config.urlServer.replace(':8888', '') + ':8888/$designerSync', function (system) {\n          var Dialog = null,\n              dialog = null,\n              message = runtime.require('message');\n \n          if (system && system.name) {\n            Dialog = self.require('DialogImport');\n            dialog = new Dialog({\n              'title': 'A system has been found',\n              'message': 'Do you wan to import it ?',\n              'data': system\n            });\n            dialog.show();\n  \n            dialog.on('ok', function () {\n              var sys = null,\n                designer = this.require('designer'),\n                message = this.require('message');\n  \n              if (this.require('factory').system()) {\n                this.require('factory').system().destroy();\n              }\n             \n              sys = this.require('factory').create(this.data());\n  \n              // empty log\n              this.require('state').logs().forEach(function (item) {\n                this.logs().pop();\n              }.bind(this.require('state')));\n              \n              // hide log\n              $('#designer-menu-item-logs-number').hide();\n              document.querySelector('#designer-menu-item-logs-number').innerHTML = 0;\n  \n              designer.save();\n  \n              this.require('state').space(sys.name());\n              this.require('spaces').render();\n              this.require('workspace').render();\n  \n              this.require('router').update();\n  \n              this.hide();\n              designer.save();\n  \n              message.success('Importation of the system is done.');\n            });\n          } else {\n            message.warning('There is no system to import.');\n          }\n        });\n      } else {\n        message.warning('No url set. Please set the url in the configuration panel.');\n      }\n    }\n    if (typeof config.debugType === 'undefined') {\n      message.warning('No url set. Please set the url in the configuration panel.');\n    }\n  } else {\n    message.warning('No url set. Please set the url in the configuration panel.');\n  }\n}","useCoreAPI":false,"core":false},"q141da1eb5d1916b":{"_id":"q141da1eb5d1916b","component":"g12f9e166c71cf91","state":"click","action":"function click() {\n  $('#designer-toolbar-item-extension').tooltip('hide');\n  if ($('#designer-dialog').children().length) {\n    $('#' + $(\"#designer-dialog\").children()[0].id).removeClass('fade').modal('hide');\n  }\n  \n  var DialogExtension = this.require('DialogExtension');\n\n  DialogExtension = new DialogExtension({\n    'title': 'Manage your extensions'\n  });\n  DialogExtension.show();\n}","useCoreAPI":false,"core":false},"k1f66b12b5f1b625":{"_id":"k1f66b12b5f1b625","component":"l1f2871e69b1b85e","state":"click","action":"function click() { \n  $('#designer-toolbar-item-command').tooltip('hide');\n  if ($('#designer-dialog').children().length) {\n    $('#' + $(\"#designer-dialog\").children()[0].id).removeClass('fade').modal('hide');\n  }\n  \n  var system = this.require('factory').system();\n  \n  if (system && system.name() !== 'default') {\n      if ($('#designer-dialog-command-modal').length) {\n        $('#designer-dialog-input-command').val('');\n        $('#designer-dialog-command-result').empty();\n        $('#designer-dialog-command-result-area').hide();\n        $('#designer-dialog-command-modal').modal('show');\n    } else {\n      var Dialog = runtime.require('DialogCommand');\n      var dialog = new Dialog({'title':''});\n      dialog.show();\n    }\t\n  } else {\n    this.require('message').warning('There is no system.');\n  }\n}","useCoreAPI":false,"core":false},"y1eaaf1fe0719457":{"_id":"y1eaaf1fe0719457","component":"_Channel","state":"$editorUpdateComponentId","action":"function $editorUpdateComponentId(oldId, newId) { \n  this.require('factory').updateComponentId(oldId, newId);\n\n  this.require('designer').save();\n  \n  this.require('workspace').render();\t\t\n}","useCoreAPI":false,"core":false},"w1875419b271fb1c":{"_id":"w1875419b271fb1c","component":"Designer","state":"addShorcuts","action":"function addShorcuts() {\n  if (this.isMac()) {\n    document.body.addEventListener('keydown', function keydown(event) {\n      var message = this.require('message'),\n        key = event.which || event.keyCode,\n        command = event.metaKey ? event.metaKey : ((key === 91) ? true : false),\n        dialog = null,\n        Dialog = null,\n        position = 0;\n\n      switch (true) {\n        // Command + O\n        case key === 79 && command:\n          if (this.require('factory').system()) {\n            if ($('#designer-dialog').children().length) {\n              $('#' + $(\"#designer-dialog\").children()[0].id).removeClass('fade').modal('hide');\n            }\n            Dialog = runtime.require('DialogCommand');\n            dialog = new Dialog({ 'title': '' });\n            dialog.show();\n          } else {\n            message.warning('There is no system.');\n          }\n          event.stopPropagation();\n          event.preventDefault();\n          return false;\n          break;\n        // Command + F\n        case key === 70 && command:\n          if (this.require('factory').system()) {\n            if ($('#designer-dialog').children().length) {\n              $('#' + $(\"#designer-dialog\").children()[0].id).removeClass('fade').modal('hide');\n            }\n            Dialog = runtime.require('DialogSearch');\n            dialog = new Dialog({\n              'title': 'Search in the system',\n            });\n            dialog.show();\n          } else {\n            message.warning('There is no system.');\n          }\n          event.stopPropagation();\n          event.preventDefault();\n          return false;\n          break;\n        // Command + '+'\n        case (key === 187 || key === 43) && command:\n          if (!this.require('factory').system() && this.require('state').menu() !== 'systems') {\n            message.warning('There is no system: create first a system to continue.');\n          } else {\n            if (this.require('factory').system() && Object.keys(this.require('factory').system().schemas()).length === 0 && this.require('state').menu() === 'components') {\n              message.warning('There is no schema: create first a schema to continue.');\n            } else {\n              if ($('#designer-dialog').children().length) {\n                $('#' + $(\"#designer-dialog\").children()[0].id).removeClass('fade').modal('hide');\n              }\n              this.require('workspace').create();\n            }\n          }\n          event.stopPropagation();\n          event.preventDefault();\n          return false;\n          break;\n        // Command + I\n        case key === 73 && command:\n          if ($('#designer-dialog').children().length) {\n            $('#' + $(\"#designer-dialog\").children()[0].id).removeClass('fade').modal('hide');\n          }\n          var DialogImportFile = this.require('DialogImportFile');\n\n          DialogImportFile = new DialogImportFile({\n            'title': 'Import a system'\n          });\n          DialogImportFile.show();\n          event.stopPropagation();\n          event.preventDefault();\n          return false;\n          break;\n        // Command + E\n        case key === 69 && command && !this.isCordova():\n          if (this.require('factory').system()) {\n            if ($('#designer-dialog').children().length) {\n              $('#' + $(\"#designer-dialog\").children()[0].id).removeClass('fade').modal('hide');\n            }\n            Dialog = this.require('DialogExport');\n            dialog = new Dialog({\n              'title': 'Export the current system',\n            });\n            dialog.show();\n          } else {\n            message.warning('There is no system to export.');\n          }\n          event.stopPropagation();\n          event.preventDefault();\n          return false;\n          break;\n        // Command + ->\n        case key === 39 && command:\n          position = this.require('state').navigation().menu().indexOf('designer-menu-item-' + this.require('state').menu());\n          if (position !== -1) {\n            position = position + 1;\n            if (position === this.require('state').navigation().menu().length) {\n              position = 0;\n            }\n            document.getElementById(this.require('state').navigation().menu(position)).click();\n          }\n          event.stopPropagation();\n          event.preventDefault();\n          return false;\n          break;\n        // Command + <-\n        case key === 37 && command:\n          position = this.require('state').navigation().menu().indexOf('designer-menu-item-' + this.require('state').menu());\n          if (position !== -1) {\n            position = position - 1;\n            if (position === -1) {\n              position = this.require('state').navigation().menu().length - 1;\n            }\n            document.getElementById(this.require('state').navigation().menu(position)).click();\n          }\n          event.stopPropagation();\n          event.preventDefault();\n          return false;\n          break;\n        // Command + v\n        case key === 40 && command:\n          position = this.require('state').navigation().spaces().indexOf('designer-space-' + this.require('state').space());\n          if (position !== -1) {\n            position = position + 1;\n            if (position === this.require('state').navigation().spaces().length) {\n              position = 0;\n            }\n            $('#' + this.require('state').navigation().spaces(position)).children()[0].click();\n          }\n          event.stopPropagation();\n          event.preventDefault();\n          return false;\n          break;\n        // Command + ^\n        case key === 38 && command:\n          position = this.require('state').navigation().spaces().indexOf('designer-space-' + this.require('state').space());\n          if (position !== -1) {\n            position = position - 1;\n            if (position === -1) {\n              position = this.require('state').navigation().spaces().length - 1;\n            }\n            $('#' + this.require('state').navigation().spaces(position)).children()[0].click();\n          }\n          event.stopPropagation();\n          event.preventDefault();\n          return false;\n          break;\n        // Command + Enter\n        case key === 13 && command:\n          this.require('13f70137b61b19b').click();\n          event.stopPropagation();\n          event.preventDefault();\n          return false;\n          break;\n        // Enter  \n        case key === 13 && !command:\n          event.stopPropagation();\n          event.preventDefault();\n          return false;\n          break;\n        // Command + D\n        case key === 68 && command && !this.isCordova():\n          if (this.require('factory').system()) {\n            this.require('designer').open('diagram.html#' + this.require('factory').system().id(), 'diagram-' + this.require('factory').system().id());\n          } else {\n            this.require('designer').open('diagram.html#', 'diagram-0');\n          }\n          event.stopPropagation();\n          event.preventDefault();\n          return false;\n          break;\n        default:\n          break;\n      }\n    }.bind(this));\n  } else {\n    document.body.addEventListener('keydown', function keydown(event) {\n      var message = this.require('message'),\n        key = event.which || event.keyCode,\n        ctrl = event.ctrlKey ? event.ctrlKey : ((key === 17) ? true : false);\n      dialog = null,\n        Dialog = null;\n\n      switch (true) {\n        // Ctrl + O\n        case key === 79 && ctrl:\n          if (this.require('factory').system()) {\n            if ($('#designer-dialog').children().length) {\n              $('#' + $(\"#designer-dialog\").children()[0].id).removeClass('fade').modal('hide');\n            }\n            Dialog = runtime.require('DialogCommand');\n            dialog = new Dialog({ 'title': '' });\n            dialog.show();\n          } else {\n            message.warning('There is no system.');\n          }\n          event.stopPropagation();\n          event.preventDefault();\n          return false;\n          break;\n        // Ctrl + F\n        case key === 70 && ctrl:\n          if (this.require('factory').system()) {\n            if ($('#designer-dialog').children().length) {\n              $('#' + $(\"#designer-dialog\").children()[0].id).removeClass('fade').modal('hide');\n            }\n            Dialog = runtime.require('DialogSearch');\n            dialog = new Dialog({\n              'title': 'Search in the system',\n            });\n            dialog.show();\n          } else {\n            message.warning('There is no system.');\n          }\n          event.stopPropagation();\n          event.preventDefault();\n          return false;\n          break;\n        // Ctrl + '+' \n        case (key === 187 || key === 43) && ctrl:\n          if (!this.require('factory').system() && this.require('state').menu() !== 'systems') {\n            message.warning('There is no system: create first a system to continue.');\n          } else {\n            if (this.require('factory').system() && Object.keys(this.require('factory').system().schemas()).length === 0 && this.require('state').menu() === 'components') {\n              message.warning('There is no schema: create first a schema to continue.');\n            } else {\n              if ($('#designer-dialog').children().length) {\n                $('#' + $(\"#designer-dialog\").children()[0].id).removeClass('fade').modal('hide');\n              }\n              this.require('workspace').create();\n            }\n          }\n          event.stopPropagation();\n          event.preventDefault();\n          return false;\n          break;\n        // Ctrl + I\n        case key === 73 && ctrl:\n          if ($('#designer-dialog').children().length) {\n            $('#' + $(\"#designer-dialog\").children()[0].id).removeClass('fade').modal('hide');\n          }\n          var DialogImportFile = this.require('DialogImportFile');\n\n          DialogImportFile = new DialogImportFile({\n            'title': 'Import a system'\n          });\n          DialogImportFile.show();\n          event.stopPropagation();\n          event.preventDefault();\n          return false;\n          break;\n        // Ctrl + E\n        case key === 69 && ctrl && !this.isCordova():\n          if (this.require('factory').system()) {\n            if ($('#designer-dialog').children().length) {\n              $('#' + $(\"#designer-dialog\").children()[0].id).removeClass('fade').modal('hide');\n            }\n            Dialog = this.require('DialogExport');\n            dialog = new Dialog({\n              'title': 'Export the current system',\n            });\n            dialog.show();\n          } else {\n            message.warning('There is no system to export.');\n          }\n          event.stopPropagation();\n          event.preventDefault();\n          return false;\n          break;\n        // Ctrl + ->\n        case key === 39 && ctrl:\n          position = this.require('state').navigation().menu().indexOf('designer-menu-item-' + this.require('state').menu());\n          if (position !== -1) {\n            position = position + 1;\n            if (position === this.require('state').navigation().menu().length) {\n              position = 0;\n            }\n            document.getElementById(this.require('state').navigation().menu(position)).click();\n          }\n          event.stopPropagation();\n          event.preventDefault();\n          return false;\n          break;\n        // Ctrl + <-\n        case key === 37 && ctrl:\n          position = this.require('state').navigation().menu().indexOf('designer-menu-item-' + this.require('state').menu());\n          if (position !== -1) {\n            position = position - 1;\n            if (position === -1) {\n              position = this.require('state').navigation().menu().length - 1;\n            }\n            document.getElementById(this.require('state').navigation().menu(position)).click();\n          }\n          event.stopPropagation();\n          event.preventDefault();\n          return false;\n          break;\n        // Ctrl + v\n        case key === 40 && ctrl:\n          position = this.require('state').navigation().spaces().indexOf('designer-space-' + this.require('state').space());\n          if (position !== -1) {\n            position = position + 1;\n            if (position === this.require('state').navigation().spaces().length) {\n              position = 0;\n            }\n            $('#' + this.require('state').navigation().spaces(position)).children()[0].click();\n          }\n          event.stopPropagation();\n          event.preventDefault();\n          return false;\n          break;\n        // Ctrl + ^\n        case key === 38 && ctrl:\n          position = this.require('state').navigation().spaces().indexOf('designer-space-' + this.require('state').space());\n          if (position !== -1) {\n            position = position - 1;\n            if (position === -1) {\n              position = this.require('state').navigation().spaces().length - 1;\n            }\n            $('#' + this.require('state').navigation().spaces(position)).children()[0].click();\n          }\n          event.stopPropagation();\n          event.preventDefault();\n          return false;\n          break;\n        // Ctrl + Enter\n        case key === 13 && ctrl:\n          this.require('13f70137b61b19b').click();\n          event.stopPropagation();\n          event.preventDefault();\n          return false;\n          break;\n        // Enter  \n        case key === 13 && !ctrl:\n          event.stopPropagation();\n          event.preventDefault();\n          return false;\n          break;\n        // Ctrl + D\n        case key === 68 && ctrl && !this.isCordova():\n          if (this.require('factory').system()) {\n            this.require('designer').open('diagram.html#' + this.require('factory').system().id(), 'diagram-' + this.require('factory').system().id());\n          } else {\n            this.require('designer').open('diagram.html#', 'diagram-0');\n          }\n          event.stopPropagation();\n          event.preventDefault();\n          return false;\n          break;\n        default:\n          break;\n      }\n    }.bind(this));\n  }\n\n}","useCoreAPI":false,"core":false},"q1e05f1c28c13d04":{"_id":"q1e05f1c28c13d04","component":"Designer","state":"runMessages","action":"function runMessages(messages) { \n  messages.forEach(function (message) {\n    if (message && message.event && message.event.indexOf('$system') === -1) {\n      $db._Message.insert(message);\n    }\n  });\t\n}","useCoreAPI":true,"core":false},"c107c51c3091756f":{"_id":"c107c51c3091756f","component":"o195831c8251b34e","state":"click","action":"function click() { \n  $('#designer-toolbar-item-diagram').tooltip('hide');\n  if ($('#designer-dialog').children().length) {\n    $('#' + $(\"#designer-dialog\").children()[0].id).removeClass('fade').modal('hide');\n  }\n  \n  var system = this.require('factory').system();\n  \n  if (system && system.name() !== 'default') {\n    this.require('designer').open('diagram.html#' + system.id(), 'diagram-' + this.require('factory').system().id());\n  } else {\n    this.require('designer').open('diagram.html#', 'diagram-0');\n  }\n}","useCoreAPI":false,"core":false},"v173801bd85122c0":{"_id":"v173801bd85122c0","component":"t1bcd213629187e0","state":"click","action":"function click() { \n  $('#designer-toolbar-item-diagram').tooltip('hide');\n  if ($('#designer-dialog').children().length) {\n    $('#' + $(\"#designer-dialog\").children()[0].id).removeClass('fade').modal('hide');\n  }\n  \n  var system = this.require('factory').system();\n  \n  if (system && system.name() !== 'default') {\n    this.require('designer').open('diagram.html#' + system.id(), 'diagram-' + this.require('factory').system().id());\n  } else {\n    this.require('designer').open('diagram.html#', 'diagram-0');\n  }\t\n}","useCoreAPI":false,"core":false},"d1128a15dc117e6f":{"_id":"d1128a15dc117e6f","component":"j1b4981736918b41","state":"click","action":"function click() { \n  window.history.back();\t\n}","useCoreAPI":false,"core":false},"t114671df7c16805":{"_id":"t114671df7c16805","component":"u18d911723019b96","state":"click","action":"function click() { \n  window.history.forward();\n}","useCoreAPI":false,"core":false}},"types":{},"components":{"Router":{"router":{"_id":"router"}},"ToolBarItem":{"1dbc51300e11z17":{"_id":"1dbc51300e11z17","html":"toolbar-item-search.html","position":35,"type":"designer","platform":"all"},"163a01b7ca1935c":{"_id":"163a01b7ca1935c","html":"toolbar-item-refresh.html","position":40,"type":"designer","platform":"web"},"163a01b7ca1935e":{"_id":"163a01b7ca1935e","html":"toolbar-item-export.html","position":50,"type":"designer","platform":"web"},"10bcb1a0511e09f":{"_id":"10bcb1a0511e09f","html":"toolbar-item-create.html","position":20,"type":"designer","platform":"all"},"13a291c27f16310":{"_id":"13a291c27f16310","html":"toolbar-item-copyright.html","position":90,"type":"designer","platform":"all"},"13a291c27f16314":{"_id":"13a291c27f16314","html":"toolbar-item-help.html","position":80,"type":"designer","platform":"all"},"13f70137b61b19b":{"_id":"13f70137b61b19b","html":"toolbar-item-publish.html","position":30,"type":"designer","platform":"all"},"163a01b7ca1935d":{"_id":"163a01b7ca1935d","html":"toolbar-item-import.html","position":45,"type":"designer","platform":"all"},"1dbc51200e116e11":{"_id":"1dbc51200e116e11","html":"toolbar-item-sync.html","position":65,"type":"designer","platform":"all"},"1dbc51200e116e3":{"_id":"1dbc51200e116e3","html":"toolbar-item-config.html","position":70,"type":"designer","platform":"all"},"y187401decb196c4":{"_id":"y187401decb196c4","html":"toolbar-item-export.html","position":50,"type":"designer","platform":"electron"},"x1371910b7812e58":{"_id":"x1371910b7812e58","html":"toolbar-item-refresh.html","position":40,"type":"designer","platform":"electron"},"g12f9e166c71cf91":{"_id":"g12f9e166c71cf91","html":"toolbar-item-extension.html","platform":"all","position":67,"type":"designer"},"l1f2871e69b1b85e":{"_id":"l1f2871e69b1b85e","html":"toolbar-item-command.html","platform":"all","position":37,"type":"designer"},"o195831c8251b34e":{"_id":"o195831c8251b34e","html":"toolbar-item-diagram.html","platform":"web","position":38,"type":"designer"},"t1bcd213629187e0":{"_id":"t1bcd213629187e0","html":"toolbar-item-diagram.html","platform":"electron","position":38,"type":"designer"}},"Designer":{},"MenuItem":{"14f481302c106e6":{"_id":"14f481302c106e6","name":"models","html":"menu-item-models.html","position":20,"type":"designer","platform":"all"},"14f481302c106e7":{"_id":"14f481302c106e7","name":"logs","html":"menu-item-logs.html","position":60,"type":"designer","platform":"all"},"154dd1323f1ffg0a":{"_id":"154dd1323f1ffg0a","name":"systems","html":"menu-item-system.html","position":10,"type":"designer","platform":"all"},"154dd1323f1ffg1a":{"_id":"154dd1323f1ffg1a","name":"schemas","html":"menu-item-schemas.html","position":10,"type":"designer","platform":"all"},"19ec81ce751e196":{"_id":"19ec81ce751e196","name":"components","html":"menu-item-components.html","position":50,"type":"designer","platform":"all"},"1eb9d188b11824c":{"_id":"1eb9d188b11824c","name":"behaviors","html":"menu-item-behaviors.html","position":40,"type":"designer","platform":"all"},"1fd911618e18ea9":{"_id":"1fd911618e18ea9","name":"types","html":"menu-item-types.html","position":30,"type":"designer","platform":"all"}},"MenuAction":{"j1b4981736918b41":{"_id":"j1b4981736918b41","html":"menu-action-back.html","position":10,"type":"designer"},"u18d911723019b96":{"_id":"u18d911723019b96","html":"menu-action-forward.html","position":20,"type":"designer"}},"MenuHeader":{"1fb101b99813a12":{"_id":"1fb101b99813a12","html":"menu-header.html","type":"designer"}},"Workspace":{},"State":{}},"_id":"e89c617b6b15d28"}