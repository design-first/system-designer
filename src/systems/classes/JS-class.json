{
  "name": "JS-class",
  "master": false,
  "version": "1.0.0",
  "description": "",
  "schemas": {
    "w10edc1dd24108d1": {
      "_name": "JS",
      "source": "property",
      "_id": "w10edc1dd24108d1",
      "_inherit": ["_Component"]
    }
  },
  "models": {
    "o180bb1fb96134b7": {
      "_name": "JS",
      "source": {
        "type": "javascript",
        "readOnly": true,
        "mandatory": true,
        "default": ""
      },
      "_id": "o180bb1fb96134b7"
    }
  },
  "behaviors": {},
  "types": {},
  "components": {
    "JS": {
      "app-github.js": {
        "_id": "app-github.js",
        "source": "/* \n * {{name}}\n * \n * @description {{description}}\n * \n * @module {{name}}\n * @version {{version}}\n * @requires system-runtime\n * \n */\n\n// install System Runtime\nlet runtime = require('system-runtime');\n\n// set the level of log\nruntime.require('logger').level('{{logLevel}}');\n\n// install and start the system\nruntime.install({{system}});"
      },
      "app.js": {
        "_id": "app.js",
        "source": "/* \n * {{name}}\n * \n * @description {{description}}\n * \n * @module {{name}}\n * @version {{version}}\n * @requires system-runtime\n * \n */\n\n// install System Runtime\nlet runtime = require('system-runtime');\n\n// uncomment this line to debug your system\n// runtime.install('node_modules/system-runtime/extensions/mode-admin-server.json');\n\n// set the level of log\nruntime.require('logger').level('{{logLevel}}');\n\n// install and start the system\nruntime.install({{system}});"
      },
      "javascript-export.js": {
        "_id": "javascript-export.js",
        "source": "/* \n * {{name}}\n * \n * @description {{description}}\n * \n * @system {{name}}\n * @version {{version}}\n * @requires system-runtime\n * \n */\n\n// uncomment this line if running this script on node.js\n// let runtime = require('system-runtime');\n\n// uncomment this line if running this script on node.js \n// and wanting to debug your system\n// runtime.install('node_modules/system-runtime/extensions/mode-admin-server.json');\n\nruntime.require('logger').level('{{logLevel}}');\n"
      },
      "system-runtime.min.js": {
        "_id": "system-runtime.min.js",
        "source": "/*\n * System Runtime\n * \n * https://designfirst.io/systemruntime/\n * \n * Copyright 2017 Erwan Carriou\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n!function(e){if(\"object\"==typeof exports&&\"undefined\"!=typeof module)module.exports=e();else if(\"function\"==typeof define&&define.amd)define([],e);else{(\"undefined\"!=typeof window?window:\"undefined\"!=typeof global?global:\"undefined\"!=typeof self?self:this).runtime=e()}}(function(){return function e(n,t,r){function o(i,s){if(!t[i]){if(!n[i]){var d=\"function\"==typeof require&&require;if(!s&&d)return d(i,!0);if(a)return a(i,!0);var c=new Error(\"Cannot find module '\"+i+\"'\");throw c.code=\"MODULE_NOT_FOUND\",c}var l=t[i]={exports:{}};n[i][0].call(l.exports,function(e){var t=n[i][1][e];return o(t||e)},l,l.exports,e,n,t,r)}return t[i].exports}for(var a=\"function\"==typeof require&&require,i=0;i<r.length;i++)o(r[i]);return o}({1:[function(e,n,t){\"use strict\";var r={_id:\"e89c617b6b15d24\",name:\"system-runtime\",description:\"System Runtime\",version:\"2.0.0-alpha.5\",behaviors:{\"12e491859c13918\":{_id:\"12e491859c13918\",component:\"_Channel\",state:\"$systemStarted\",action:\"function $systemStarted(id) { \\n  var systems = null;\\n    \\n  if (id !== 'e89c617b6b15d24') {\\n    if (typeof document !== 'undefined') {\\n      systems = document.querySelectorAll('link[rel=system]');\\n         \\n      if ($state.get('runtime') && $state.get('runtime').state === 'ready') {    \\n      } else {\\n        if (systems.length + 1 === $db._System.count()) {\\n          $component.get('runtime').ready();\\n        }\\n      }\\n    }\\n  }\\n}\",useCoreAPI:!0,core:!0},\"1e9021bd4e1bc6e\":{_id:\"1e9021bd4e1bc6e\",component:\"_Channel\",state:\"$systemInstalled\",action:\"function $systemInstalled(id) {\\n  var systems = null,\\n    dependencies = [],\\n    master = [],\\n    canStart = true;\\n\\n  if (id !== 'e89c617b6b15d24') {\\n    // if all systems are installed\\n    systems = $db._System.find({});\\n\\n    systems.forEach(function (system) {\\n      var sys = this.require(system._id);\\n      if (sys.state() === 'none') {\\n        canStart = false;\\n      }\\n    }.bind(this));\\n\\n    // start all the systems\\n    if (canStart) {\\n      dependencies = $db._System.find({\\n        'master': false\\n      });\\n\\n      dependencies.forEach(function (dep) {\\n        var system = this.require(dep._id);\\n        channel = this.require('channel');\\n\\n        if (system.state() === 'resolved') {\\n          system.state('starting');\\n          system.start();\\n          channel.$systemStarted(dep._id);\\n          system.state('active');\\n        }\\n      }.bind(this));\\n\\n      master = $db._System.find({\\n        'master': true\\n      });\\n\\n      master.forEach(function (dep) {\\n        var system = this.require(dep._id);\\n        channel = this.require('channel');\\n\\n        if (system.state() === 'resolved') {\\n          system.state('starting');\\n          system.start();\\n          channel.$systemStarted(dep._id);\\n          system.state('active');\\n        }\\n      }.bind(this));\\n    }\\n  }\\n}\",useCoreAPI:!0,core:!0},\"155141e40312cd8\":{_id:\"155141e40312cd8\",component:\"_ClassInfo\",state:\"collection\",action:\"function collection(name) {\\n  var result = {};\\n  if (this.schema()[name] === 'collection') {\\n    result = this.model()[name];\\n  }\\n\\n  return result;\\n}\",core:!0},\"1f6941a0c012c1f\":{_id:\"1f6941a0c012c1f\",component:\"_ClassInfo\",state:\"collections\",action:\"function collections(name) {\\n  var keys = Object.keys(this.schema()),\\n    item = '',\\n    result = [],\\n    i = 0,\\n    length = keys.length;\\n\\n  for (i = 0; i < length; i++) {\\n    item = keys[i];\\n    if (this.schema()[item] === 'collection') {\\n      result.push(item);\\n    }\\n  }\\n\\n  return result;\\n}\",core:!0},\"1ef711b4171c849\":{_id:\"1ef711b4171c849\",component:\"_ClassInfo\",state:\"event\",action:\"function event(name) {\\n  var result = {};\\n\\n  if (this.schema()[name] === 'event') {\\n    result = this.model()[name];\\n  }\\n\\n  return result;\\n}\",core:!0},\"1bae51b6ed1d25c\":{_id:\"1bae51b6ed1d25c\",component:\"_ClassInfo\",state:\"events\",action:\"function events(name) {\\n  var keys = Object.keys(this.schema()),\\n    item = '',\\n    result = [],\\n    i = 0,\\n    length = keys.length;\\n\\n  for (i = 0; i < length; i++) {\\n    item = keys[i];\\n    if (this.schema()[item] === 'event') {\\n      result.push(item);\\n    }\\n  }\\n  return result;\\n}\",core:!0},\"19ac2125221528b\":{_id:\"19ac2125221528b\",component:\"_ClassInfo\",state:\"link\",action:\"function link(name) {\\n  var result = {};\\n\\n  if (this.schema()[name] === 'link') {\\n    result = this.model()[name];\\n  }\\n  return result;\\n}\",core:!0},\"17ed21dfc01b8e8\":{_id:\"17ed21dfc01b8e8\",component:\"_ClassInfo\",state:\"links\",action:\"function links(name) {\\n  var keys = Object.keys(this.schema()),\\n    item = '',\\n    result = [],\\n    i = 0,\\n    length = keys.length;\\n\\n  for (i = 0; i < length; i++) {\\n    item = keys[i];\\n    if (this.schema()[item] === 'link') {\\n      result.push(item);\\n    }\\n  } return result;\\n}\",core:!0},\"11ce318a561ac61\":{_id:\"11ce318a561ac61\",component:\"_ClassInfo\",state:\"method\",action:\"function method(name) {\\n  var result = {};\\n  if (this.schema()[name] === 'method') {\\n    result = this.model()[name];\\n  }\\n  \\n  return result;\\n}\",core:!0},\"12ff2190a018046\":{_id:\"12ff2190a018046\",component:\"_ClassInfo\",state:\"methods\",action:\"function methods(name) {\\n  var keys = Object.keys(this.schema()),\\n    item = '',\\n    result = [],\\n    i = 0,\\n    length = keys.length;\\n\\n  for (i = 0; i < length; i++) {\\n    item = keys[i];\\n    if (this.schema()[item] === 'method') {\\n      result.push(item);\\n    }\\n  }\\n\\n  return result;\\n}\",core:!0},\"1028d1681e1fd58\":{_id:\"1028d1681e1fd58\",component:\"_ClassInfo\",state:\"properties\",action:\"function properties(name) {\\n  var keys = Object.keys(this.schema()),\\n    item = '',\\n    result = [],\\n    i = 0,\\n    length = keys.length;\\n\\n  for (i = 0; i < length; i++) {\\n    item = keys[i];\\n    if (this.schema()[item] === 'property') {\\n      result.push(item);\\n    }\\n  } return result;\\n}\",core:!0},\"18eeb10c5319368\":{_id:\"18eeb10c5319368\",component:\"_ClassInfo\",state:\"property\",action:\"function property(name) {\\n  var result = {};\\n\\n  if (this.schema()[name] === 'property') {\\n    result = this.model()[name];\\n  }\\n  return result;\\n}\",core:!0},\"1ba721201114b6b\":{_id:\"1ba721201114b6b\",component:\"_Component\",state:\"destroy\",action:\"function destroy() {\\n  $component.destroy(this.id());\\n}\",core:!0,useCoreAPI:!0},\"15486186f41a48c\":{_id:\"15486186f41a48c\",component:\"_Component\",state:\"off\",action:'function off(state, behaviorId) {\\n  var args = [],\\n    i = 0,\\n    length = arguments.length;\\n\\n  for (i = 0; i < length - 7; i++) {\\n    args.push(arguments[i]);\\n  }\\n\\n  if ($workflow.checkParams({\\n    \"component\": this,\\n    \"methodName\": \"off\",\\n    \"args\": args\\n  })) {\\n\\n    if (state || behaviorId) {\\n      if ($metamodel.isValidState(state, this.constructor.name)) {\\n        $behavior.remove({\\n          \"behaviorId\": behaviorId,\\n          \"componentId\": this.id(),\\n          \"state\": state\\n        });\\n      } else {\\n        this.require(\\'logger\\').warn(\"invoke \\\\\\'off\\\\\\' method of component \\'\" + this.id() + \"\\' with an invalid state \\'\" + state + \"\\'\");\\n      }\\n    } else {\\n      $behavior.remove({\\n        \"componentId\": this.id()\\n      });\\n    }\\n  }\\n}',core:!0,useCoreAPI:!0},\"1da0a17878104c3\":{_id:\"1da0a17878104c3\",component:\"_Component\",state:\"require\",action:\"function require(id) {\\n  return $component.get(id);\\n}\",core:!0,useCoreAPI:!0},\"1a5111d17a1800c\":{_id:\"1a5111d17a1800c\",component:\"_Database\",state:\"collections\",action:\"function collections() {\\n  var result = {},\\n    collectionName = '';\\n\\n  for (collectionName in $db.store) {\\n    if ($db.store.hasOwnProperty(collectionName) && collectionName.indexOf('_') !== 0) {\\n      result[collectionName] = $db[collectionName];\\n    }\\n  }\\n  return result;\\n}\",core:!0,useCoreAPI:!0},\"1d993108fa18ef2\":{_id:\"1d993108fa18ef2\",component:\"_Logger\",state:\"debug\",action:\"function debug(message) {\\n  if (this.level() === 'debug') {\\n    console.log('runtime: ' + message);\\n  }\\n}\",core:!0},\"1a37a188e11fe73\":{_id:\"1a37a188e11fe73\",component:\"_Logger\",state:\"error\",action:\"function error(message) {\\n  console.error('runtime: ' + message);\\n}\",core:!0},\"1edd21e12a16534\":{_id:\"1edd21e12a16534\",component:\"_Logger\",state:\"info\",action:\"function info(message) {\\n  if (this.level() === 'info' || this.level() === 'debug') {\\n    console.info('runtime: ' + message);\\n  }\\n}\",core:!0},\"141f2143d3122a4\":{_id:\"141f2143d3122a4\",component:\"_Logger\",state:\"level\",action:\"function level(val) {\\n  $log.level(val);\\n}\",core:!0,useCoreAPI:!0},\"192401bab21304e\":{_id:\"192401bab21304e\",component:\"_Logger\",state:\"warn\",action:\"function warn(message) {\\n  if (this.level() === 'info' || this.level() === 'warn' || this.level() === 'debug') {\\n    console.warn('runtime: ' + message);\\n  }\\n}\",core:!0},\"11fc715e2f1a31e\":{_id:\"11fc715e2f1a31e\",component:\"_Metamodel\",state:\"create\",action:\"function create() {\\n  $metamodel.create();\\n}\",core:!0,useCoreAPI:!0},\"1232f1f107142cf\":{_id:\"1232f1f107142cf\",component:\"_Metamodel\",state:\"model\",action:\"function model(model) {\\n  return $metamodel.model(model);\\n}\",core:!0,useCoreAPI:!0},\"1365412f69153d2\":{_id:\"1365412f69153d2\",component:\"_Metamodel\",state:\"schema\",action:\"function schema(schema) {\\n  return $metamodel.schema(schema);\\n}\",core:!0,useCoreAPI:!0},\"194db147fe161a2\":{_id:\"194db147fe161a2\",component:\"_Metamodel\",state:\"type\",action:\"function type(type) {\\n  return $metamodel.type(type);\\n}\",core:!0,useCoreAPI:!0},\"1ef951f1411b895\":{_id:\"1ef951f1411b895\",component:\"_OSGi\",state:\"install\",action:\"function install(url, async) {\\n  var importedSystem = null,\\n    system = {},\\n    systemId = '',\\n    callbackLoad = null,\\n    xhr = null,\\n    result = '',\\n    channel = $component.get('channel');\\n\\n  if (typeof url === 'object') {\\n    importedSystem = url;\\n  } else {\\n    if (url.indexOf('{') === 0) {\\n      importedSystem = JSON.parse(url);\\n    }\\n  }\\n\\n  if (importedSystem) {\\n    systemId = $db.importSystem(importedSystem);\\n    if (systemId) {\\n      system = this.require(systemId);\\n\\n      if (typeof url === 'string') {\\n        system.location(url);\\n      }\\n      system.state('installed');\\n      channel.$systemInstalled(systemId);\\n      system.state('resolved');\\n      channel.$systemResolved(systemId);\\n\\n      result = systemId;\\n    }\\n  } else {\\n    if (typeof global !== 'undefined' && typeof window === 'undefined') {\\n      if (url.indexOf('.json') !== -1) {\\n        system = global.require(global.process.env.PWD + '/' + url);\\n      } else {\\n        system = global.require(url);\\n      }\\n      systemId = $db.importSystem(system);\\n      system = this.require(systemId);\\n\\n      if (typeof url === 'string') {\\n        system.location(url);\\n      }\\n      system.state('installed');\\n      channel.$systemInstalled(systemId);\\n      system.state('resolved');\\n      channel.$systemResolved(systemId);\\n\\n      result = systemId;\\n    } else {\\n      xhr = new XMLHttpRequest();\\n      callbackLoad = function callbackLoad(system, url) {\\n        var sysId = $db.importSystem(system),\\n          sys = $component.get(sysId),\\n          channel = $component.get('channel');\\n\\n        if (typeof url === 'string') {\\n          sys.location(url);\\n        }\\n        sys.state('installed');\\n        channel.$systemInstalled(sysId);\\n        sys.state('resolved');\\n        channel.$systemResolved(sysId);\\n\\n        result = sysId;\\n      };\\n\\n      if (async) {\\n        xhr.open('GET', url, true);\\n        xhr.onreadystatechange = function () {\\n          if (xhr.readyState === 4) {\\n            if (xhr.status === 200) {\\n              callbackLoad(JSON.parse(xhr.response), url);\\n            }\\n          }\\n        };\\n        xhr.send(null);\\n      } else {\\n        xhr.open('GET', url, false);\\n        xhr.send(null);\\n        if (xhr.status === 200) {\\n          callbackLoad(JSON.parse(xhr.response), url);\\n        }\\n      }\\n    }\\n  }\\n  return result;\\n}\",useCoreAPI:!0,core:!0},\"14c1517b711cb78\":{_id:\"14c1517b711cb78\",component:\"_OSGi\",state:\"uninstall\",action:\"function uninstall(id) {\\n  var search = {},\\n    system = null,\\n    behaviorId = '',\\n    collection = '',\\n    componentId = '',\\n    length = 0,\\n    i = 0,\\n    coreComponents = ['admin', 'channel', 'db', 'logger', 'metamodel', 'runtime'];\\n\\n  search = $db._System.find({\\n    '_id': id\\n  });\\n\\n  if (search.length) {\\n    system = search[0];\\n    // remove behaviors\\n    if (system.behaviors) {\\n      for (behaviorId in system.behaviors) {\\n        $db._Behavior.remove({\\n          '_id': system.behaviors[behaviorId]._id\\n        });\\n      }\\n    }\\n    // remove components\\n    if (system.components) {\\n      for (collection in system.components) {\\n        for (componentId in system.components[collection]) {\\n          if (coreComponents.indexOf(componentId) === -1) {\\n            $db[collection].remove({\\n              '_id': componentId\\n            });\\n          }\\n        }\\n      }\\n    }\\n  }\\n\\n  this.require(id).state('uninstalled');\\n  channel.$systemUninstalled(id);\\n}\",useCoreAPI:!0,core:!0},\"105f219c6813643\":{_id:\"105f219c6813643\",component:\"_OSGi\",state:\"start\",action:\"function start(id) {\\n  var system = this.require(id),\\n    channel = this.require('channel');\\n\\n  if (system.state() === 'resolved' || system.state() === 'installed') {\\n    system.state('starting');\\n    if (system.start) {\\n      system.start();\\n    }\\n    channel.$systemStarted(id);\\n    system.state('active');\\n  }\\n}\",useCoreAPI:!1,core:!0},\"1a81a1f00d17269\":{_id:\"1a81a1f00d17269\",component:\"_OSGi\",state:\"stop\",action:\"function stop(id) {\\n  var system = this.require(id),\\n    channel = this.require('channel');\\n\\n  if (system.state() === 'active') {\\n    system.state('stopping');\\n    if (system.stop) {\\n      system.stop();\\n    }\\n    channel.$systemStopped(id);\\n    system.state('resolved');\\n    channel.$systemResolved(id);\\n  }\\n}\",useCoreAPI:!1,core:!0},\"116851b602128d1\":{_id:\"116851b602128d1\",component:\"_OSGi\",state:\"status\",action:\"function status() {\\n  var result = {},\\n    system = null,\\n    length = 0,\\n    i = 0;\\n\\n  systems = $db._System.find({});\\n\\n  length = systems.length;\\n  for (i = 0; i < length; i++) {\\n    system = systems[i];\\n    result[system.name] = {\\n      'id': system._id,\\n      'state': system.state,\\n      'name': system.name,\\n      'version': system.version,\\n      'location': system.location,\\n      'master': system.master\\n    };\\n  }\\n\\n  return result;\\n}\",useCoreAPI:!0,core:!0},\"19cf317d7217331\":{_id:\"19cf317d7217331\",component:\"_OSGi\",state:\"bundle\",action:\"function bundle() { \\n\\tvar result = $db.exportSystem();\\n\\treturn result;\\n}\",useCoreAPI:!0,core:!0},\"13010167f313f87\":{_id:\"13010167f313f87\",component:\"_Runtime\",state:\"system\",action:\"function system(params) {\\n  var RuntimeSystem = null,\\n    system = {},\\n    systemId = '',\\n    result = [],\\n    conf = {};\\n\\n  if (params) {\\n    if (typeof params === 'string') {\\n      conf.master = true;\\n      conf.name = params;\\n    } else {\\n      conf = params;\\n      conf.master = true;\\n    }\\n    RuntimeSystem = this.require('_System');\\n    system = new RuntimeSystem(conf);\\n    system.state('active');\\n  } else {\\n    result = $db._System.find({\\n      'master': true\\n    });\\n    if (result.length) {\\n      systemId = result[0]._id;\\n      system = $component.get(systemId);\\n    }\\n  }\\n  return system;\\n}\",core:!0,useCoreAPI:!0},\"1cfa4145f614da8\":{_id:\"1cfa4145f614da8\",component:\"_Runtime\",state:\"message\",action:\"function message(msg) { \\n  $db._Message.insert(msg);\\n}\",useCoreAPI:!0,core:!0},\"1cb9d103d41dd97\":{_id:\"1cb9d103d41dd97\",component:\"e89c617b6b15d24\",state:\"start\",action:\"function start() {\\n  var systems = [],\\n    system = null,\\n    scripts = [],\\n    script = null,\\n    logLevel = 'warn',\\n    i = 0,\\n    length = 0;\\n\\n  // in a browser\\n  if (typeof document !== 'undefined') {\\n    systems = document.querySelectorAll('link[rel=system]');\\n    length = systems.length;\\n\\n    // logger\\n    scripts = document.querySelectorAll('script[log]');\\n    if (scripts.length) {\\n      logLevel = scripts[0].getAttribute('log');\\n      this.require('logger').level(logLevel);\\n    }\\n\\n    // systems\\n    for (i = 0; i < length; i++) {\\n      system = systems[i];\\n\\n      if (system.getAttribute('async') === 'false') {\\n        this.require('runtime').install(system.href, false);\\n      } else {\\n        this.require('runtime').install(system.href, true);\\n      }\\n    }\\n\\n    // ready event\\n    if (length === 0) {\\n      this.require('runtime').ready();\\n    }\\n  }\\n}\",useCoreAPI:!0,core:!0}},schemas:{\"1ac07185641fa9f\":{_name:\"_Behavior\",_inherit:[\"_Component\"],_core:!0,core:\"property\",component:\"property\",action:\"property\",state:\"property\",useCoreAPI:\"property\",_id:\"1ac07185641fa9f\"},\"104ad1f48518376\":{_id:\"104ad1f48518376\",_name:\"_Channel\",_inherit:[\"_Component\"],_core:!0,send:\"event\",$systemInstalled:\"event\",$systemResolved:\"event\",$systemStarted:\"event\",$systemStopped:\"event\",$systemUninstalled:\"event\"},\"1c00b13a1b1bc92\":{_name:\"_ClassInfo\",_inherit:[\"_Component\"],_core:!0,model:\"property\",schema:\"property\",method:\"method\",methods:\"method\",property:\"method\",properties:\"method\",link:\"method\",links:\"method\",collections:\"method\",collection:\"method\",event:\"method\",events:\"method\",_id:\"1c00b13a1b1bc92\"},\"111df11e2b19fde\":{_id:\"111df11e2b19fde\",_name:\"_Component\",_inherit:[],_core:!0,classInfo:\"property\",on:\"method\",off:\"method\",require:\"method\",destroy:\"method\",init:\"method\",error:\"event\"},\"1723516a30132ac\":{_name:\"_Database\",_inherit:[\"_Component\"],_core:!0,collections:\"method\",insert:\"event\",update:\"event\",remove:\"event\",_id:\"1723516a30132ac\"},f1a10d1067d1b23a:{_id:\"f1a10d1067d1b23a\",_name:\"_Log\",_inherit:[\"_Component\"],_core:!0,action:\"property\",collection:\"property\",id:\"property\",field:\"property\",value:\"property\",order:\"property\"},\"1268f1dddd1fea7\":{_name:\"_Logger\",_core:!0,level:\"property\",debug:\"method\",info:\"method\",warn:\"method\",error:\"method\",_id:\"1268f1dddd1fea7\"},\"14caa1c46414ee1\":{_name:\"_Message\",_inherit:[\"_Component\"],_core:!0,event:\"property\",from:\"property\",data:\"property\",_id:\"14caa1c46414ee1\"},\"193f1166eb16609\":{_name:\"_Metamodel\",_inherit:[\"_Component\"],_core:!0,schema:\"method\",model:\"method\",type:\"method\",create:\"method\",_id:\"193f1166eb16609\"},\"157931f7a31b61d\":{_id:\"157931f7a31b61d\",_name:\"_OSGi\",_inherit:[\"_Component\"],_core:!0,install:\"method\",uninstall:\"method\",start:\"method\",stop:\"method\",status:\"method\",bundle:\"method\"},\"12e211d4cd120a6\":{_id:\"12e211d4cd120a6\",_name:\"_Runtime\",_inherit:[\"_OSGi\"],_core:!0,version:\"property\",system:\"method\",message:\"method\",ready:\"event\"},\"158711d6f215e4b\":{_name:\"_State\",_inherit:[],_core:!0,_class:!1,state:\"property\",value:\"property\",_id:\"158711d6f215e4b\"},\"1cb761fa4510dca\":{_id:\"1cb761fa4510dca\",_name:\"_System\",_inherit:[\"_SystemOSGi\"],_core:!0,name:\"property\",master:\"property\",version:\"property\",description:\"property\",schemas:\"property\",models:\"property\",behaviors:\"property\",types:\"property\",components:\"property\"},\"145fe10c7514298\":{_id:\"145fe10c7514298\",_name:\"_SystemOSGi\",_inherit:[\"_Component\"],_core:!0,state:\"property\",location:\"property\",start:\"method\",stop:\"method\"}},models:{\"166971fd9d107fd\":{_name:\"_Behavior\",_core:!0,core:{type:\"boolean\",readOnly:!1,mandatory:!1,default:!1},useCoreAPI:{type:\"boolean\",readOnly:!1,mandatory:!1,default:!1},component:{type:\"string\",readOnly:!1,mandatory:!0,default:\"\"},action:{type:\"javascript\",readOnly:!1,mandatory:!0,default:\"\"},state:{type:\"string\",readOnly:!1,mandatory:!0,default:\"\"},_id:\"166971fd9d107fd\"},\"135c71078810af2\":{_id:\"135c71078810af2\",_name:\"_Channel\",_core:!0,send:{params:[{name:\"message\",type:\"message\"}]},$systemInstalled:{params:[{name:\"id\",type:\"string\",mandatory:!0,default:\"\"}]},$systemResolved:{params:[{name:\"id\",type:\"string\",mandatory:!0,default:\"\"}]},$systemUninstalled:{params:[{name:\"id\",type:\"string\",mandatory:!0,default:\"\"}]},$systemStarted:{params:[{name:\"id\",type:\"string\",mandatory:!0,default:\"\"}]},$systemStopped:{params:[{name:\"id\",type:\"string\",mandatory:!0,default:\"\"}]}},\"158321dced1014a\":{_name:\"_ClassInfo\",_core:!0,model:{type:\"object\",readOnly:!0,mandatory:!0,default:{}},property:{params:[{name:\"name\",type:\"string\"}],result:\"object\"},properties:{result:\"array\"},link:{params:[{name:\"name\",type:\"string\"}],result:\"object\"},links:{result:\"array\"},method:{params:[{name:\"name\",type:\"string\"}],result:\"object\"},methods:{result:\"array\"},collection:{params:[{name:\"name\",type:\"string\"}],result:\"object\"},collections:{result:\"array\"},event:{params:[{name:\"name\",type:\"string\"}],result:\"object\"},events:{result:\"array\"},_id:\"158321dced1014a\",schema:{type:\"object\",readOnly:!0,mandatory:!0,default:{}}},\"123751cb591de26\":{_id:\"123751cb591de26\",_name:\"_Component\",_core:!0,on:{params:[{name:\"state\",type:\"string\"},{name:\"handler\",type:\"function\"},{name:\"useCoreAPI\",type:\"boolean\",mandatory:!1,default:!1},{name:\"isCore\",type:\"boolean\",mandatory:!1,default:!1}]},off:{params:[{name:\"state\",type:\"string\",mandatory:!1},{name:\"behaviorId\",type:\"string\",mandatory:!1}]},require:{params:[{name:\"id\",type:\"string\"}]},destroy:{params:[]},classInfo:{type:\"@_ClassInfo\",readOnly:!1,mandatory:!1,default:{}},init:{params:[{name:\"conf\",type:\"object\"}]},error:{params:[{name:\"data\",type:\"errorParam\"}]}},\"18a51169d7112d4\":{_name:\"_Database\",_core:!0,collections:{result:\"object\"},insert:{params:[{name:\"event\",type:\"dbInsertEvent\"}]},update:{params:[{name:\"event\",type:\"dbUpdateEvent\"}]},remove:{params:[{name:\"event\",type:\"dbRemoveEvent\"}]},_id:\"18a51169d7112d4\"},o1e1e01e6b41cec3:{_id:\"o1e1e01e6b41cec3\",_name:\"_Log\",action:{type:\"dbAction\",readOnly:!1,mandatory:!1,default:\"insert\"},collection:{type:\"string\",readOnly:!1,mandatory:!1,default:\"\"},id:{type:\"string\",readOnly:!1,mandatory:!1,default:\"\"},field:{type:\"string\",readOnly:!1,mandatory:!1,default:\"\"},value:{type:\"any\",readOnly:!1,mandatory:!1,default:\"\"},order:{type:\"number\",readOnly:!1,mandatory:!1,default:0},_core:!0},\"16b9d1ac2216ffe\":{_id:\"16b9d1ac2216ffe\",_name:\"_Logger\",_core:!0,level:{type:\"log\",readOnly:!1,mandatory:!1,default:\"warn\"},debug:{params:[{name:\"message\",type:\"any\"}]},info:{params:[{name:\"message\",type:\"any\"}]},warn:{params:[{name:\"message\",type:\"any\"}]},error:{params:[{name:\"message\",type:\"any\"}]}},\"1d9b6139411aa91\":{_name:\"_Message\",_core:!0,event:{type:\"string\",readOnly:!1,mandatory:!0,default:\"\"},from:{type:\"string\",readOnly:!1,mandatory:!0,default:\"\"},data:{type:\"array\",readOnly:!1,mandatory:!0,default:[]},_id:\"1d9b6139411aa91\"},\"1628c13c22152e6\":{_name:\"_Metamodel\",_core:!0,schema:{params:[{name:\"schema\",type:\"object\"}],result:\"any\"},model:{params:[{name:\"model\",type:\"object\"}],result:\"any\"},type:{params:[{name:\"type\",type:\"object\"}],result:\"any\"},create:{params:[]},_id:\"1628c13c22152e6\"},\"100b91ed2211b15\":{_id:\"100b91ed2211b15\",_name:\"_OSGi\",install:{params:[{name:\"url\",type:\"any\",mandatory:!0,default:\"\"},{name:\"async\",type:\"boolean\",mandatory:!1,default:!0}],result:\"string\"},uninstall:{params:[{name:\"id\",type:\"string\",mandatory:!0,default:\"\"}]},start:{params:[{name:\"id\",type:\"string\",mandatory:!0,default:\"\"}]},stop:{params:[{name:\"id\",type:\"string\",mandatory:!0,default:\"\"}]},status:{result:\"object\"},_core:!0,bundle:{result:\"string\"}},\"14c7c105b31a160\":{_id:\"14c7c105b31a160\",_name:\"_Runtime\",_core:!0,version:{type:\"string\",readOnly:!0,mandatory:!0,default:\"0.0.0\"},system:{params:[{name:\"params\",type:\"any\",mandatory:!1}],result:\"object\"},message:{params:[{name:\"msg\",type:\"message\",mandatory:!0}]},ready:{}},\"177ac136891629f\":{_name:\"_State\",_core:!0,state:{type:\"string\",readOnly:!1,mandatory:!0,default:\"\"},value:{type:\"any\",readOnly:!1,mandatory:!1,default:null},_id:\"177ac136891629f\"},\"170521b88614387\":{_name:\"_System\",_core:!0,name:{type:\"string\",readOnly:!1,mandatory:!0,default:\"\"},master:{type:\"boolean\",readOnly:!1,mandatory:!1,default:!1},version:{type:\"string\",readOnly:!1,mandatory:!1,default:\"0.0.1\"},description:{type:\"string\",readOnly:!1,mandatory:!1,default:\"\"},schemas:{type:\"object\",readOnly:!1,mandatory:!1,default:{}},models:{type:\"object\",readOnly:!1,mandatory:!1,default:{}},behaviors:{type:\"object\",readOnly:!1,mandatory:!1,default:{}},types:{type:\"object\",readOnly:!1,mandatory:!1,default:{}},components:{type:\"object\",readOnly:!1,mandatory:!1,default:{}},_id:\"170521b88614387\"},\"1b2811b092143f5\":{_id:\"1b2811b092143f5\",_name:\"_SystemOSGi\",start:{},stop:{},_core:!0,state:{type:\"string\",readOnly:!1,mandatory:!1,default:\"none\"},location:{type:\"string\",readOnly:!1,mandatory:!1,default:\"\"}}},types:{collection:{name:\"collection\",type:\"object\",schema:{type:{type:[\"string\"],mandatory:!0},readOnly:{type:\"boolean\",mandatory:!0},mandatory:{type:\"boolean\",mandatory:!0},default:{type:\"object\",mandatory:!0},description:{type:\"string\",mandatory:!1},label:{type:\"string\",mandatory:!1}},core:!0},css:{name:\"css\",type:\"string\",core:!0},date:{name:\"date\",type:\"object\",core:!0},errorParam:{name:\"errorParam\",type:\"object\",schema:{message:{type:\"string\",mandatory:!0},error:{type:\"object\",mandatory:!0}},core:!0},event:{name:\"event\",type:\"object\",schema:{params:{type:[\"parameter\"],mandatory:!1},description:{type:\"string\",mandatory:!1}},core:!0},html:{name:\"html\",type:\"string\",core:!0},javascript:{name:\"javascript\",type:\"string\",core:!0},json:{name:\"json\",type:\"object\",core:!0},link:{name:\"link\",type:\"object\",schema:{type:{type:\"string\",mandatory:!0},readOnly:{type:\"boolean\",mandatory:!0},mandatory:{type:\"boolean\",mandatory:!0},default:{type:\"@type\",mandatory:!0},description:{type:\"string\",mandatory:!1},label:{type:\"string\",mandatory:!1}},core:!0},log:{name:\"log\",type:\"string\",value:[\"debug\",\"info\",\"warn\",\"error\"],core:!0},message:{name:\"message\",type:\"object\",schema:{event:{type:\"string\",mandatory:!0},from:{type:\"string\",mandatory:!1},data:{type:\"object\",mandatory:!0}},core:!0},method:{name:\"method\",type:\"object\",schema:{result:{type:\"string\",mandatory:!1},params:{type:[\"parameter\"],mandatory:!1},description:{type:\"string\",mandatory:!1}},core:!0},parameter:{name:\"parameter\",type:\"object\",schema:{name:{type:\"string\",mandatory:!0},type:{type:\"string\",mandatory:!0},mandatory:{type:\"boolean\",mandatory:!1},default:{type:\"@type\",mandatory:!1}},core:!0},property:{name:\"property\",type:\"object\",schema:{type:{type:\"string\",mandatory:!0},readOnly:{type:\"boolean\",mandatory:!0},mandatory:{type:\"boolean\",mandatory:!0},default:{type:\"@type\",mandatory:!0},description:{type:\"string\",mandatory:!1},label:{type:\"string\",mandatory:!1}},core:!0},osgiStates:{name:\"osgiStates\",type:\"string\",value:[\"none\",\"installed\",\"resolved\",\"starting\",\"active\",\"stopping\",\"uninstalled\"],core:!0},text:{name:\"text\",type:\"string\",core:!0},dbInsertEvent:{_id:\"148ef1e19810e6d\",core:!0,name:\"dbInsertEvent\",type:\"object\",schema:{collection:{type:\"string\",mandatory:!0,default:\"\"},document:{type:\"object\",mandatory:!0,default:{}}}},dbRemoveEvent:{_id:\"1952e1ac4213f4a\",name:\"dbRemoveEvent\",type:\"object\",core:!0,schema:{collection:{type:\"string\",mandatory:!0,default:\"\"},id:{type:\"string\",mandatory:!0,default:\"\"}}},dbUpdateEvent:{_id:\"1f5c41309711752\",core:!0,name:\"dbUpdateEvent\",type:\"object\",schema:{collection:{type:\"string\",mandatory:!0,default:\"\"},id:{type:\"string\",mandatory:!0,default:\"\"},field:{type:\"string\",mandatory:!0,default:\"\"},value:{type:\"any\",mandatory:!0,default:null}}},dbAction:{_id:\"e1950e16f2914da9\",core:!0,name:\"dbAction\",type:\"string\",value:[\"insert\",\"update\",\"remove\"]}},components:{_Channel:{channel:{_id:\"channel\"}},_Database:{db:{_id:\"db\"}},_Logger:{logger:{_id:\"logger\",level:\"warn\"}},_Metamodel:{metamodel:{_id:\"metamodel\"}},_Runtime:{runtime:{_id:\"runtime\",version:\"2.0.0-alpha.5\"}}},master:!1};t.system=r},{}],2:[function(e,n,t){\"use strict\";function r(e,n,t,r){var o=\"\",a=-1,i=\"\",s=[],d=[],c=\"\",l=\"\";return a=n.indexOf(\"{\"),l=n.substring(0,a),o=l.split(\"(\")[0].replace(\"function\",\"\").trim(),i=l.split(\"(\")[1].replace(\")\",\"\").trim(),(s=i.split(\",\")).forEach(function(e){d.push(e.trim())}),c=n.substring(a+1),c=c.substring(0,c.lastIndexOf(\"}\")).trim(),o=o||e,\"\"===s[0]&&(s=[]),r&&(s.push(\"$component\"),s.push(\"$db\"),s.push(\"$metamodel\"),s.push(\"$workflow\"),s.push(\"$behavior\"),s.push(\"$state\"),s.push(\"$log\")),\"\"!==s[0]?new Function(\"__body\",\"return function \"+o+\" (\"+s.join(\",\")+\") { return new Function('\"+s.join(\"','\")+\"', __body).apply(this, arguments) };\")(c):new Function(\"__body\",\"return function \"+o+\" () { return new Function(__body).apply(this, arguments) };\")(c)}function o(e,n,t,o,a){var i=m.generateId(),s=t.toString();return void 0===a&&(a=!1),void 0===o&&(o=!1),t=r(n,s,a,o),u[i]=t,l._Behavior.insert({_id:i,component:e,state:n,action:s,useCoreAPI:o,core:a}),i}function a(e){(e=e||{}).behaviorId=e.behaviorId||\"\",e.componentId=e.componentId||\"\",e.state=e.state||\"\",e.componentId&&(e.behaviorId?(l._Behavior.remove({_id:e.behaviorId,component:e.componentId,state:e.state}),delete u[e.behaviorId]):(e.state?l._Behavior.remove({component:e.componentId,state:e.state}):l._Behavior.remove({component:e.componentId})).forEach(function(e){delete u[e]}))}function i(e){delete u[e]}function s(e,n){var t=[],o=null;return l._Behavior.find({component:e,state:n}).forEach(function(e){void 0===(o=u[e._id])&&(o=r(e.state,e.action,e.core,e.useCoreAPI),u[e._id]=o),t.push({useCoreAPI:e.useCoreAPI,action:o})}),t}function d(){u={}}function c(e){return u[e]}var l=e(\"./db.js\"),m=e(\"./helper.js\"),u={};t.add=o,t.get=c,t.remove=a,t.getActions=s,t.clear=d,t.removeFromMemory=i},{\"./db.js\":4,\"./helper.js\":5}],3:[function(e,n,t){\"use strict\";function r(e){function n(e,n,t,r){var o=0,m=0,u=[];if(l)x.readOnlyProperty(s,d,c);else if(-1!==i.indexOf(\"@\"))if(e&&R.inheritFrom(e.constructor.name,i.replace(\"@\",\"\"))){switch(!0){case\"push\"===n:a.push(e.id());break;case\"unshift\"===n:a.unshift(e.id());break;case\"splice\"===n:for(m=(u=a.splice(t,r,e)).length,o=0;o<m;o++)M.state({component:s,state:c,data:[V[u[o]],\"remove\"]})}N.isRuntime()&&N.getRuntime().require(\"db\").update({collection:d,id:s,field:c,value:a}),M.state({component:s,state:c,data:[e,\"add\"]})}else void 0!==e.id?x.invalidPropertyName(s,d,c,e.id(),i):x.invalidPropertyName(s,d,c,e,i);else if(e&&R.isValidType(e,i)){switch(!0){case\"push\"===n:a.push(e);break;case\"unshift\"===n:a.unshift(e);break;case\"splice\"===n:a.splice(t,r,e)}N.isRuntime()&&N.getRuntime().require(\"db\").update({collection:d,id:s,field:c,value:a}),M.state({component:s,state:c,data:[e,\"add\"]})}else x.invalidPropertyName(s,d,c,e,i);return a.length}function t(e){var n,t=null;if(l)x.readOnlyProperty(s,d,c);else if(0!==a.length){switch(!0){case\"pop\"===e:t=a.pop();break;case\"shift\"===e:t=a.shift()}N.isRuntime()&&N.getRuntime().require(\"db\").update({collection:d,id:s,field:c,value:a}),n=-1!==i.indexOf(\"@\")?V[t]:t,M.state({component:s,state:c,data:[n,\"remove\"]})}return n}var o=[],a=[],i=\"\",s=\"\",d=\"\",c=\"\",l=!1;return e=e||{},i=e.type||\"\",s=e.id||\"\",c=e.propertyName||\"\",a=e.arr||[],d=e.classId||\"\",void 0!==e.readOnly&&(l=e.readOnly),a.forEach(function(e){-1!==i.indexOf(\"@\")?o.push(N.getRuntime().require(e)):o.push(e)}),o.push=function(e){return n(e,\"push\")},o.unshift=function(e){return n(e,\"unshift\")},o.concat=function(t){var o=0,i=0;if(Array.isArray(t))for(i=t.length,o=0;o<i;o++)n(t[o],\"push\");return e.arr=a,new r(e)},o.pop=function(){return t(\"pop\")},o.shift=function(){return t(\"shift\")},o.sort=function(e){return a.sort(e),N.isRuntime()&&N.getRuntime().require(\"db\").update({collection:d,id:s,field:c,value:a}),o},o.reverse=function(){return a.reverse(),N.isRuntime()&&N.getRuntime().require(\"db\").update({collection:d,id:s,field:c,value:a}),o},o.splice=function(e,t,r){var o=[],l=0,m=0,u=null;if(void 0!==r)n(r,\"splice\",e,t);else for(o=a.splice(e,t),N.isRuntime()&&N.getRuntime().require(\"db\").update({collection:d,id:s,field:c,value:a}),m=o.length,l=0;l<m;l++)u=-1!==i.indexOf(\"@\")?V[o[l]]:o[l],M.state({component:s,state:c,data:[u,\"remove\"]});return o},o.slice=function(e,n){return a.slice(e,n)},o}function o(e,n){var t=[],r=[],o=0,a=0;if(t=R.getModel(e)[n].params)for(o=t.length,a=0;a<o;a++)r.push(t[a].name);return r}function a(e){var n=null,t=null,r=[],o=0,a=0,i=[];for(n=R.getModel(e),t=R.getSchema(n[D]),o=(r=Object.keys(t)).length,a=0;a<o;a++)t[r[a]]!==F&&t[r[a]]!==T&&t[r[a]]!==E||i.push({name:r[a],type:n[r[a]].type,readOnly:n[r[a]].readOnly});return i}function i(e){var n=null,t=null,r=[],o=0,a=0,i=[];for(n=R.getModel(e),t=R.getSchema(n[D]),o=(r=Object.keys(t)).length,a=0;a<o;a++)t[r[a]]===L&&i.push(r[a]);return i}function s(e,n){var t=null,r=null,o=null,a=[];return t=R.getModel(n),r=t[e].type,(o=R.getType(r)).schema&&Object.keys(o.schema).forEach(function(e){o.schema[e].name=e,a.push(o.schema[e])}),a}function d(e){var n=null,t=null,r=[],o=0,a=0,i=[];for(n=R.getModel(e),t=R.getSchema(n[D]),o=(r=Object.keys(t)).length,a=0;a<o;a++)t[r[a]]===J&&i.push(r[a]);return i}function c(e,n,t){var r=null,o=P.store[e][n],a=t.split(\".\"),i=a.length,s=0;for(r=o,s=0;s<i;s++)r=r[a[s]];return r}function l(e,n,t,r){var o=null,a=P.store[e][n],i=t.split(\".\"),s=i.length,d=0;for(o=a,d=0;d<s-1;d++)o=o[i[d]];o[i[d]]=r}function m(e){var n=function(n){var t={};\"Object\"!==(n=n||{}).constructor.name&&(x.invalidConctructorParameters(n,e),n={}),R.isValidObject(n,R.getModel(e),!0,!0)||x.invalidParameters(e),R.prepareObject(n,R.getModel(e)),void 0===n._id&&(n._id=N.generateId()),V[n._id]=this,t=function(){return n._id},this.id=new Function(\"__body\",\"return function id () { return __body.call(this) };\")(t),R.inheritFrom(e,\"_Component\")&&(n.classInfo=e+\"Info\"),P.store[e][n._id]=n,P.createLog(\"insert\",e,n._id,\"\",n),N.isRuntime()&&N.getRuntime().require(\"db\")&&N.getRuntime().require(\"db\").insert({collection:e,document:n}),Object.freeze(this),this.init&&this.init(n)};return new Function(\"__body\",\"return function \"+e+\" (config) { __body.call(this,config) };\")(n)}function u(e,n){var t=function(){return n};e.id=new Function(\"__body\",\"return function id (prop, val) { return __body.call(this, prop, val) };\")(t)}function f(e,n,t){a(e).forEach(function(o){function a(e,n){var t=!0;return e.forEach(function(e){R.isValidType(e,n)&&R.inheritFrom(e.constructor.name,n.replace(\"@\",\"\"))&&-1!==n.indexOf(\"@\")||(t=t&&!1)}),!0}function i(e,n){var t=[];return e.forEach(function(e){if(-1!==n[0].indexOf(\"@\"))switch(!0){case\"string\"==typeof e:t.push(e);break;case void 0!==e.id:t.push(e.id());break;default:t.push(null)}else t.push(e)}),t}var s={},d=\"\",c=\"\",l=\"\";d=o.name,c=o.type,l=o.readOnly,Array.isArray(c)?(s=function(e,n){var o=[],s=null,m=null,u=null;if(void 0===n){if(void 0===e)return new r({id:this.id(),propertyName:d,readOnly:l,classId:t,type:c[0],arr:P.store[t][this.id()][d]});if(Array.isArray(e))a(e,c[0])?(o=P[t].find({_id:this.id()})).length&&(s=o[0],u=i(e,c[0]),M.state({component:this.id(),state:d,data:[e,\"reset\"]}),s[d]=u,N.isRuntime()&&N.getRuntime().require(\"db\").update({collection:t,id:this.id(),field:d,value:s[d]})):x.invalidPropertyName(this.id(),this.constructor.name,d,e,c);else if(\"number\"==typeof e){if(m=P.store[t][this.id()][d][e])return u=-1!==c[0].indexOf(\"@\")?N.getRuntime().require(m):m}else x.invalidPropertyName(this.id(),this.constructor.name,d,e,\"number\")}else if(l)x.readOnlyProperty(this.id(),this.constructor.name,d);else if(R.isValidType(n,c[0])||R.inheritFrom(n.constructor.name,c[0].replace(\"@\",\"\"))&&-1!==c[0].indexOf(\"@\")){if((o=P[t].find({_id:this.id()})).length){if(-1!==c[0].indexOf(\"@\"))switch(!0){case\"string\"==typeof n:u=n;break;case void 0!==n.id:u=n.id();break;default:u=\"\"}else u=n;(s=o[0])[d][e]=u,N.isRuntime()&&N.getRuntime().require(\"db\").update({collection:t,id:this.id(),field:d,value:s[d]}),M.state({component:this.id(),state:d,data:[n,\"add\"]})}}else x.invalidPropertyName(this.id(),this.constructor.name,d,n,c)},n.prototype[d]=new Function(\"__body\",\"return function \"+d+\" (position,value) { return __body.call(this, position, value) };\")(s)):(s=function(n){var o=[],a=null,i=null;if(void 0===n){if(a=P.store[t][this.id()]){switch(!0){case-1!==c.indexOf(\"@\"):i=k(a[d]);break;case\"date\"===c:i=new Date(a[d]);break;case\"array\"===c:i=new r({id:this.id(),propertyName:d,readOnly:l,classId:t,type:\"any\",arr:P.store[t][this.id()][d]});break;case R.isStructure(d,t):i=p(\"\",d,e,this.id());break;default:i=a[d]}return i}x.destroyedComponentCall(d,this.id())}else if(l)x.readOnlyProperty(this.id(),this.constructor.name,d);else if(R.isValidType(n,c)){if((o=P[t].find({_id:this.id()})).length){switch(a=o[0],!0){case-1!==c.indexOf(\"@\"):a[d]=null===n?n:n.id();break;case\"date\"===c:a[d]=\"string\"==typeof n?n:n.toISOString();break;default:a[d]=n}N.isRuntime()&&N.getRuntime().require(\"db\")&&N.getRuntime().require(\"db\").update({collection:t,id:this.id(),field:d,value:n}),\"_Behavior\"===t&&A.removeFromMemory(this.id()),M.state({component:this.id(),state:d,data:[n]})}}else x.invalidPropertyName(this.id(),this.constructor.name,d,n,c)},n.prototype[d]=new Function(\"__body\",\"return function \"+d+\" (value) { return __body.call(this,value) };\")(s))})}function p(e,n,t,r){var o={};return s(n,t).forEach(function(a){var i={},s=\"\",d=\"\",m=\"\";s=a.name,d=a.type,m=a.readOnly,i=function(o){var i=[],u=null,f=\"\",y=\"\";if(f=e?f+\".\"+n:n,y=f+\".\"+s,void 0===o){if(P.store[t][r]){switch(!0){case-1!==d.indexOf(\"@\"):u=k(c(t,r,y));break;case\"date\"===d:u=new Date(c(t,r,y));break;case R.isStructure(s,t):u=p(f,s,t,r);break;default:u=c(t,r,y)}return void 0===u&&void 0!==a.default&&(u=a.default),u}x.destroyedComponentCall(y,r)}else if(m)x.readOnlyProperty(r,t,y);else if(R.isValidType(o,d)){if((i=P[t].find({_id:r})).length){switch(i[0],!0){case-1!==d.indexOf(\"@\"):l(t,r,y,o.id());break;case\"date\"===d:l(t,r,y,o.toISOString());break;default:l(t,r,y,o)}N.isRuntime()&&N.getRuntime().require(\"db\")&&N.getRuntime().require(\"db\").update({collection:t,id:r,field:y,value:o}),\"_Behavior\"===t&&A.removeFromMemory(r),M.state({component:r,state:y,data:[o]})}}else x.invalidPropertyName(r,t,y,o,d)},o[s]=new Function(\"__body\",\"return function \"+s+\" (value) { return __body.call(this,value) };\")(i)}),o}function y(e,n,t){i(e).forEach(function(e){var r=o(t,e).join(\",\"),a=function(){return M.state({component:this.id(),state:e,data:arguments})};n.prototype[e]=r?new Function(\"__body\",\"return function \"+e+\" (\"+r+\") { return __body.call(this,\"+r+\") };\")(a):new Function(\"__body\",\"return function \"+e+\" () { return __body.call(this) };\")(a)})}function h(e,n,t){d(e).forEach(function(e){var r=o(t,e).join(\",\"),a=function(){var n=[],r=\"e89c617b6b15d24\",o=[],a=0,i=-1,s={};if(\"_Channel\"===t){for((n=P._System.find({master:!0})).length&&(r=n[0]._id),s.from=r,i=arguments.length,a=0;a<i;a++)o.push(arguments[a]);s.data=o,s.event=e,P._Message.insert(s),M.state({component:this.id(),state:\"send\",data:[{event:s.event,from:s.from,data:s.data}]})}else M.state({component:this.id(),state:e,data:arguments})};n.prototype[e]=r?new Function(\"__body\",\"return function \"+e+\" (\"+r+\") { return __body.call(this,\"+r+\") };\")(a):new Function(\"__body\",\"return function \"+e+\" () { return __body.call(this) };\")(a)})}function v(e,n){var t=function(e,t,r,o){var a=\"\",i=\"\";return M.checkParams({component:this,methodName:\"on\",args:arguments})&&(R.isValidState(e,n)?R.isEvent(e,n)||R.isProperty(e,n)||R.isLink(e,n)||R.isCollection(e,n)||!(P._Behavior.find({component:this.id(),state:e}).length>=1)?$.validParamNumbers(n,e,t)?(a=A.add(this.id(),e,t,r,o),(i=q.get(this.id()))&&i.state===e&&M.action(a,i.value)):x.invalidParamNumberMethodOn(this.id(),this.constructor.name,e):x.behaviorNotUnique(n,e):x.invalidStateOn(n,e)),a};e.prototype.on=new Function(\"__body\",\"return function on (state,handler,useCoreAPI,isCore) { return __body.call(this,state,handler,useCoreAPI,isCore) };\")(t)}function g(e,n){var t=function(e,t,r,o){var a=\"\",i=\"\";return M.checkParams({component:this,methodName:\"on\",args:arguments})&&(R.isValidState(e,n)?R.isEvent(e,n)||R.isProperty(e,n)||R.isLink(e,n)||R.isCollection(e,n)||!(P._Behavior.find({component:this.id(),state:e}).length>=1)?$.validParamNumbers(n,e,t)?(a=A.add(this.id(),e,t,r,o),(i=q.get(this.id()))&&i.state===e&&M.action(a,i.value)):x.invalidParamNumberMethodOn(this.id(),this.constructor.name,e):x.behaviorNotUnique(n,e):x.invalidStateOn(n,e)),a};e.on=new Function(\"__body\",\"return function on (state,handler,useCoreAPI,isCore) { return __body.call(this, state, handler, useCoreAPI,isCore) };\")(t)}function _(e,n){var t=function(e,t){M.checkParams({component:this,methodName:\"off\",args:arguments})&&(R.isValidState(e,n)?A.remove({behaviorId:t,componentId:n,state:e}):x.InvalidStateOff(n,e))};e.off=new Function(\"__body\",\"return function off (state, behaviorId) { return __body.call(this, state, behaviorId) };\")(t)}function b(e){var n=function(){var e=this.id(),n=[],t=0,r=0;for(P[e]&&(n=P[e].remove()),delete V[e],A.remove({componentId:e}),r=n.length,t=0;t<r;t++)A.remove({componentId:n[t]});M.state({component:e,state:\"destroy\"})};e.destroy=new Function(\"__body\",\"return function destroy () { return __body.call(this) };\")(n)}function w(e){var n=function(){return k(this.id()+\"Info\")};e.classInfo=new Function(\"__body\",\"return function classInfo () { return __body.call(this) };\")(n)}function O(e){var n={},t=\"\";return t=void 0===(e=e||{}).model?N.generateId():e.model,n=m(t),V[t]=n,u(n,t),f(e.model,n,t),y(e.model,n,t),h(e.model,n,t),R.inheritFrom(t,\"_Component\")&&(v(n,t),g(n,t),_(n,t),b(n),w(n)),Object.freeze(n),n}function k(e){return V[e]}function S(e){return O(e)}function j(e){var n=V[e],t=\"\";n&&(delete V[e],t=n.constructor.name,P[t].remove({_id:e}),A.remove({componentId:e}),\"_Behavior\"===t&&A.removeFromMemory(e))}function I(e){delete V[e]}function C(){V={}}var M=e(\"./workflow.js\"),P=e(\"./db.js\"),R=e(\"./metamodel.js\"),A=e(\"./behavior.js\"),N=e(\"./helper.js\"),x=e(\"./log.js\"),$=e(\"./workflow.js\"),q=e(\"./state.js\"),T=\"property\",F=\"link\",E=\"collection\",L=\"method\",J=\"event\",D=\"_name\",V={};r.prototype=new Array,t.create=S,t.get=k,t.removeFromMemory=I,t.clear=C,t.destroy=j},{\"./behavior.js\":2,\"./db.js\":4,\"./helper.js\":5,\"./log.js\":6,\"./metamodel.js\":7,\"./state.js\":9,\"./workflow.js\":10}],4:[function(e,n,t){\"use strict\";function r(){return I++}function o(){var e={},n=\"\",r=\"\",o=\"\",a=null,i=null,s=null,d=null,c=null,l=\"\",m=\"\",u=0,f=0,p=\"\";if(e.schemas={},t._Schema.count())for(l in O._Schema)(s=JSON.parse(JSON.stringify(O._Schema[l])))._core||(e.schemas[l]=s);if(e.models={},t._Model.count())for(m in O._Model)(d=JSON.parse(JSON.stringify(O._Model[m])))._core||(e.models[m]=d);if(e.types={},t._Type.count())for(o in O._Type)(a=JSON.parse(JSON.stringify(O._Type[o]))).core||(e.types[a.name]=a);e.behaviors={};for(r in O._Behavior)delete(i=JSON.parse(JSON.stringify(O._Behavior[r]))).classInfo,i.core||(e.behaviors[r]=i);for(e.components={},u=k.length,f=0;f<u;f++)if(n=k[f],t[n].count()){c=JSON.parse(JSON.stringify(O[n]));for(p in c)delete c[p].classInfo,c[p]._core&&delete c[p];Object.keys(c).length&&(e.components[n]=c)}return e}function a(e,n){var t=!0,r=!1,o=\"\",a=0,i=0;for(o in e){if(void 0===n[o]){t=!1;break}if(e[o]instanceof RegExp){if(Array.isArray(n[o])&&!Array.isArray(e[o])){for(i=n[o].length,a=0;a<i;a++)if(null!==n[o][a].toString().match(e[o])){r=!0;break}t=r}else if(null===n[o].toString().match(e[o])){t=!1;break}}else if(Array.isArray(n[o])&&!Array.isArray(e[o])){if(-1===n[o].indexOf(e[o])){t=!1;break}}else if(n[o]!==e[o]){t=!1;break}}return t}function i(e){var n=\"\",r=\"\",o=\"\",a=\"\",i=\"\",s=\"\",d=\"\",c=[];if(e){delete e.subsystem;for(a in e.types)h.type(e.types[a]);for(i in e.schemas)h.schema(e.schemas[i]);for(s in e.models)h.model(e.models[s]);h.create();for(d in e.behaviors)t._Behavior.insert(e.behaviors[d]);for(r in e.components)for(o in e.components[r])t[r].insert(e.components[r][o]);(c=t._System.find({master:!0})).length&&(c[0]._id===e._id?e.master=!0:(e.master=!0,c[0].master=!1)),t._System.insert(e),n=e._id}return n}function s(){var e=\"\",n=\"\",r=\"\",a=[],i=null,s=null,d=null,c=null,l={};if((a=t._System.find({master:!0})).length){i=(d=a[0])._id,l._id=i,l.name=d.name,l.description=d.description,l.version=d.version,l.master=!0,s=o();for(n in s)s.hasOwnProperty(n)&&(l[n]=s[n]);for(r in l.behaviors)\"main\"!==(c=l.behaviors[r]).state&&\"start\"!==c.state&&\"stop\"!==c.state||(c.component=i);e=JSON.stringify(l)}else e=\"{}\",g.masterSystemNotFound();return e}function d(e){var n={},r=[],o=\"\",a=0,i=0,s=null,d=null,c=null,l=null,m=null,u=\"\";if((r=t._System.find({master:!0})).length&&(o=r[0].name),n.name=e.name||\"sub_\"+o,n.version=e.version||\"0.0.1\",n.description=e.description||\"\",n.schemas={},e.schemas)for(i=(r=t._Schema.find(e.schema)).length,a=0;a<i;a++)(s=r[a])._core||(n.schemas[s._id]=s);if(n.models={},e.models)for(i=(r=t._Model.find(e.models)).length,a=0;a<i;a++)(c=r[a])._core||(n.models[c._id]=c);if(n.types={},e.types)for(i=(r=t._Type.find(e.types)).length,a=0;a<i;a++)(d=r[a])._core||(n.types[d._id]=d);if(n.behaviors={},e.behaviors)for(l=t._Behavior.find(e.behaviors),i=r.length,a=0;a<i;a++)(l=r[a]).core||(n.behaviors[l._id]=l);if(n.components={},e.components)for(u in e.components)if(t[u])for(n.components[u]={},i=(r=t[u].find(e.components[u])).length,a=0;a<i;a++)m=r[a],n.components[u][m._id]=m;return JSON.stringify(n)}function c(e,n,t,o,a){var i=v.generateId();n=n||\"\",t=t||\"\",o=o||\"\",a=a||\"\",Object.keys(O._Log).length>1e3&&(O._Log={}),O._Log[i]={_id:i,action:e,collection:n,id:t,field:o,value:a,order:r()}}function l(e){t[e]=new C(e)}function m(e){return i(e)}function u(e){return e?d(e):s()}function f(){var e=0,n=0,r=\"\";for(e=k.length,n=0;n<e;n++)r=k[n],t[r].remove();for(e=S.length,n=0;n<e;n++)r=S[n],t[r].remove()}function p(){var e=\"\",n=null;n=t._System.find({_id:\"e89c617b6b15d24\"})[0],t.clear(),y.clear(),h.clear(),b.clear(),_.clear(),h.init(),e=t.importSystem(n),y.get(e).start()}var y=e(\"./component.js\"),h=e(\"./metamodel.js\"),v=e(\"./helper.js\"),g=e(\"./log.js\"),_=e(\"./behavior.js\"),b=e(\"./state.js\"),w=e(\"./workflow.js\"),O={},k=[],S=[\"_Runtime\",\"_Schema\",\"_Model\",\"_GeneratedModel\",\"_Behavior\",\"_State\",\"_Type\",\"_Metamodel\",\"_Database\",\"_System\",\"_ClassInfo\",\"_Message\",\"_Channel\",\"_Logger\",\"_Log\"],j=[\"_Log\",\"_Schema\",\"_Logger\",\"_Model\",\"_GeneratedModel\",\"_State\",\"_Type\"],I=0,C=function(e){h.getSchema(e)||-1!==S.indexOf(e)?(O[e]={},this.name=e,-1===S.indexOf(e)&&k.push(e)):g.invalidCollectionName(e)};C.prototype.find=function(e){var n=[],t={},r=\"\",o={};if((e=e||null)&&Object.keys(e).length)if(Array.isArray(e))e.forEach(function(e){for(r in O[this.name])a(e,o=O[this.name][r])&&void 0===t[r]&&(n.push(o),t[r]=!0)}.bind(this));else for(r in O[this.name])a(e,o=O[this.name][r])&&n.push(o);else for(r in O[this.name])o=O[this.name][r],n.push(o);return n},C.prototype.insert=function(e){var n=[],r=null,o=[];return Array.isArray(e)?n=e:n.push(e),n.forEach(function(e){var n=null,a=[];switch(!0){case\"_Schema\"===this.name:case\"_Logger\"===this.name:case\"_Model\"===this.name:case\"_Type\"===this.name:case\"_GeneratedModel\"===this.name:case h.isValidObject(e,h.getModel(this.name)):if(void 0===e._id&&(e._id=v.generateId()),h.prepareObject(e,h.getModel(this.name)),O[this.name][e._id]=e,r=y.get(this.name),r?(n=new r(e),o.push(n.id())):(c(\"insert\",this.name,e._id,\"\",e),v.isRuntime()&&v.getRuntime().require(\"db\")&&v.getRuntime().require(\"db\").insert({collection:this.name,document:e})),\"_Message\"===this.name&&v.isRuntime())for(var i=(a=t._Channel.find({})).length,s=0;s<i;s++)v.getRuntime().require(a[s]._id),w.state({component:a[s]._id,state:e.event,data:e.data});break;default:g.invalidDocumentOnDbInsert(e,this.name)}}.bind(this)),o},C.prototype.update=function(e,n,t){var r=this.find(e),o=0,a=0,i=r.length,s=\"\",d=h.getModel(this.name),l=\"\";if(void 0===(t=t||{}).upsert&&(t.upsert=t.upsert||!1),n)for(0===i&&t.upsert&&(e._id&&(n._id=e._id),this.insert(n),o+=1),a=0;a<i;a++){void 0!==n._id&&n._id!==r[a]._id&&g.updateUuid(r[a]._id,n._id,void 0!==y.get(n._id));for(s in n)void 0!==r[a][s]&&(\"_Schema\"!==this.name&&\"_Model\"!==this.name&&\"_GeneratedModel\"!==this.name?(l=\"\",0!==s.indexOf(\"_\")?l=d[s].type:h.getMetaDef()[s]&&(l=h.getMetaDef()[s].type),l?h.isValidType(n[s],l)?(r[a][s]=n[s],o+=1,c(\"update\",this.name,r[a]._id,s,n[s]),v.isRuntime()&&v.getRuntime().require(\"db\")&&v.getRuntime().require(\"db\").update({collection:this.name,id:r[a]._id,field:s,value:n[s]}),w.state({component:r[a]._id,state:s,data:[n[s]]})):g.invalidPropertyTypeOnDbUpdate(this.name,r[a]._id,s,n[s],d[s].type):g.unknownPropertyOnDbUpdate(this.name,s,r[a]._id)):(r[a][s]=n[s],c(\"update\",this.name,r[a]._id,s,n[s]),o+=1,v.isRuntime()&&v.getRuntime().require(\"db\")&&v.getRuntime().require(\"db\").update({collection:this.name,id:r[a]._id,field:s,value:n[s]})))}return o},C.prototype.remove=function(e){var n=[],t=\"\",r=null,o={};if((e=e||null)&&Object.keys(e).length)if(Array.isArray(e))e.forEach(function(e){for(t in O[this.name])a(e,o=O[this.name][t])&&(delete O[this.name][t],c(\"remove\",this.name,t,\"\",\"\"),(r=y.get(t))&&r.destroy(),v.isRuntime()&&v.getRuntime().require(\"db\")&&v.getRuntime().require(\"db\").remove({collection:this.name,id:t}),n.push(t))}.bind(this));else for(t in O[this.name])a(e,o=O[this.name][t])&&(delete O[this.name][t],c(\"remove\",this.name,t,\"\",\"\"),(r=y.get(t))&&r.destroy(),v.isRuntime()&&v.getRuntime().require(\"db\")&&v.getRuntime().require(\"db\").remove({collection:this.name,id:t}),n.push(t));else for(t in O[this.name])delete O[this.name][t],c(\"remove\",this.name,t,\"\",\"\"),-1==j.indexOf(this.name)&&(r=y.get(t))&&r.destroy(),v.isRuntime()&&v.getRuntime().require(\"db\")&&v.getRuntime().require(\"db\").remove({collection:this.name,id:t}),n.push(t);return n},C.prototype.count=function(){var e=0,n=\"\";for(n in O[this.name])e++;return e},t.createLog=c,t.collection=l,t.store=O,t.importSystem=m,t.exportSystem=u,t.clear=f,t.init=p},{\"./behavior.js\":2,\"./component.js\":3,\"./helper.js\":5,\"./log.js\":6,\"./metamodel.js\":7,\"./state.js\":9,\"./workflow.js\":10}],5:[function(e,n,t){\"use strict\";function r(){var e=!1;return s._Runtime&&s._Runtime.find().length&&(e=!0),e}function o(){var e=\"\";return c||(e=s._Runtime.find()[0]._id,c=d.get(e)),c}function a(){function e(){return Math.floor(65536*(1+Math.random())).toString(16)}return function(){return\"abcdefghijklmnopqrstuvwxyz\".charAt(Math.floor(Math.random()*\"abcdefghijklmnopqrstuvwxyz\".length))}()+e()+e()+e()}function i(){void 0===Function.prototype.name&&void 0!==Object.defineProperty&&Object.defineProperty(Function.prototype,\"name\",{get:function(){var e=/function\\s([^(]{1,})\\(/.exec(this.toString());return e&&e.length>1?e[1].trim():\"\"},set:function(e){}})}var s=e(\"./db.js\"),d=e(\"./component.js\"),c=null;t.getRuntime=o,t.isRuntime=r,t.generateId=a,t.polyfill=i},{\"./component.js\":3,\"./db.js\":4}],6:[function(e,n,t){\"use strict\";function r(){var e=\"\",n=[],t=null;return ie.getModel(\"_Logger\")&&(n=se._Logger.find()).length?(e=n[0][ce],t=de.get(e)?ue=de.get(e):fe):t=fe,t}function o(e){me=e}function a(e,n){var t=\"\";t=n[le]?\"unknown property '\"+e+\"' for the definition of '\"+n[le]+\"'\":\"unknown property '\"+e+\"' for a model\",r().warn(t)}function i(e,n,t){r().warn(\"invalid type for property '\"+e+\"': expected type '\"+n+\"' instead of type '\"+typeof t+\"'\")}function s(e,n){r().warn(\"'\"+e+\"' is an invalid value for the type enum '\"+n+\"'\")}function d(e,n,t){r().warn(\"invalid class name for component '\"+e+\"': expected '\"+n+\"' instead of '\"+t+\"'\")}function c(e){r().warn(\"missing property '\"+e+\"'\")}function l(e){r().warn(\"schema '\"+e+\"' is missing.\")}function m(e,n){r().error(\"the property '\"+e+\"' of the model '\"+n+\"' is invalid\")}function u(e,n){r().warn(\"missing property '\"+e+\"' for the definition of '\"+n+\"'\")}function f(e,n){r().error(\"the model '\"+n+\"' has an unknown property '\"+e+\"'\")}function p(e){r().warn(\"the type '\"+e+\"' is not valid\")}function y(e,n,t,o,a){var i=\"\";\"Function\"!==n&&(i=\" (class '\"+n+\"')\"),\"string\"==typeof a?r().warn(\"invalid type for property '\"+t+\"' on component '\"+e+\"'\"+i+\": expected '\"+a.replace(\"@\",\"\")+\"' instead of '\"+typeof o+\"'\"):r().warn(\"invalid type for property type '\"+t+\"' on component '\"+i+\": expected 'string' instead of '\"+typeof a+\"'\")}function h(e,n,t){var o=\"\";\"Function\"!==n&&(o=\" (class '\"+n+\"')\"),r().warn(\"can not set read-only property '\"+t+\"' on component '\"+e+\"'\"+o)}function v(e,n){r().warn(\"invalid document '\"+JSON.stringify(e).replace(/,/g,\", \")+\"' on an insert operation on collection '\"+n+\"'\")}function g(e,n,t,o,a){r().warn(\"invalid type when trying to update the property '\"+t+\"' of document '\"+n+\"' (collection '\"+e+\"') with the value '\"+JSON.stringify(o)+\"': expected type '\"+a+\"'\")}function _(e,n,t){r().warn(\"unknown property '\"+e+\"' on an update operation on collection '\"+n+\"' with component '\"+t+\"'\")}function b(e,n){r().warn(\"try to call an unknown method '\"+n+\"' for the class '\"+e+\"'\")}function w(e){r().warn(\"invalid name for creating the collection '\"+e+\"': there is no schema '\"+e+\"' in the metamodel\")}function O(e,n,t,o,a){var i=\"\";\"Function\"!==n&&(i=\" (class '\"+n+\"')\"),a?r().warn(\"invalid type for the result of method '\"+t+\"' on component '\"+e+\"'\"+i+\": expected type '\"+o.replace(\"@\",\"\")+\"' instead of type '\"+a+\"'\"):r().warn(\"invalid type for the result of method '\"+t+\"' on component '\"+e+\"'\"+i+\": expected type '\"+o.replace(\"@\",\"\")+\"'\")}function k(e,n){r().warn(\"unkown class component '\"+e+\"' for component '\"+n+\"'\")}function S(){r().warn(\"runtime has been restarted\")}function j(e,n,t){var o=\"\";\"Function\"!==n&&(o=\" (class '\"+n+\"')\"),r().warn(\"invalid number of parameters when calling the method '\"+t+\"' on component '\"+e+\"'\"+o)}function I(e,n,t,o){var a=\"\";\"Function\"!==n&&(a=\" (class '\"+n+\"')\"),void 0!==o?r().warn(\"invalid type for the parameter '\"+o+\"' when calling the method '\"+t+\"' on component '\"+e+\"'\"+a):r().warn(\"invalid type for a parameter when calling the method '\"+t+\"' on component '\"+e+\"'\"+a)}function C(e,n){r().warn(\"try to add more than one behavior for the state '\"+n+\"' on class '\"+e+\"'\")}function M(e,n){r().warn(\"try to add a behavior with an unkwown state '\"+n+\"' on class '\"+e+\"'\")}function P(e,n){r().warn(\"try to remove a behavior from an unkwown state '\"+n+\"' on class '\"+e+\"'\")}function R(){r().warn(\"can not export the database because no system was defined\")}function A(e,n){r().warn(\"invalid type for value '\"+JSON.stringify(e)+\"': expected '\"+n+\"'\")}function N(e){r().warn(\"unknown type for value '\"+JSON.stringify(e)+\"'\")}function x(e,n){r().debug(\"can not yet validate if the component '\"+e+\"' is an instance of '\"+n+\"'\")}function $(e,n,t){r().warn(\"invalid type for the message '\"+JSON.stringify(e)+\"': expected type '\"+t+\"' for event '\"+n+\"'\")}function q(e,n,t){var o=\"\";\"Function\"!==n&&(o=\" (class '\"+n+\"')\"),r().warn(\"invalid number of parameters when adding an action on method '\"+t+\"' on component '\"+e+\"'\"+o)}function T(e,n,t){t?r().warn(\"try to update a component of id '\"+e+\"' with the new id '\"+n+\"' that is already used\"):r().warn(\"try to update a component of id '\"+e+\"' with the new id '\"+n+\"'\")}function F(e){r().warn(\"try to change the state of the destroyed component '\"+e+\"'\")}function E(e){r().warn(\"the schema '\"+e+\"' is not valid\")}function L(e){r().warn(\"the model '\"+e+\"' is not valid\")}function J(e){r().warn(\"the parameters for creating a component of class '\"+e+\"' are not compliant with the model\")}function D(e,n){r().warn(\"trying to get the property '\"+e+\"' on the destroyed component '\"+n+\"'\")}function V(e,n){r().warn(\"the constructor parameter '\"+JSON.stringify(e).replace(/,/g,\", \")+\"' for creating a component of class '\"+n+\"' is not an object\")}function B(e){r().warn(\"try get the information of an unknown model '\"+e+\"'\")}function G(e){r().warn(\"the schema '\"+e+\"' is missing\")}function U(e){e?r().error(\"a cyclic inheritance dependency with \"+e+\" schema has been found, please check the '_inherit' properties of your schemas\"):r().error(\"a cyclic inheritance dependency has been found, please check the '_inherit' properties of your schemas\")}function z(e,n,t){t!==typeof e?r().warn(\"invalid type for enumerated type '\"+n+\"': expected type '\"+t+\"' instead of type '\"+typeof e+\"'\"):r().warn(\"invalid type for enumerated type '\"+n+\"'\")}function Y(e){r().debug(\"load schema '\"+e+\"'\")}function H(e){r().debug(\"load model '\"+e+\"'\")}function W(e){r().debug(\"load type '\"+e+\"'\")}function X(e){r().debug(\"compile schema '\"+e+\"'...\")}function K(e){r().debug(\"generate model '\"+e+\"'...\")}function Q(e){r().debug(\"analyze model '\"+e+\"'...\")}function Z(e){r().debug(\"create collection '\"+e+\"'\")}function ee(e){r().debug(\"create class '\"+e+\"'\")}function ne(){r().debug(\"starting model creation...\")}function te(){r().debug(\"model creation ended\")}function re(e,n,t,o){\"Function\"!==t?r().error(\"error when trying to call the method '\"+e+\"' on component '\"+n+\"' (class '\"+t+\"'): \"+o):r().error(\"error when trying to call the method '\"+e+\"' on component '\"+n+\"': \"+o)}function oe(e,n){r().warn(\"invalid property '\"+n+\"' for schema '\"+e+\"': only 'property', 'link', 'collection', 'method' and 'event' are allowed.\")}function ae(e){r().warn(\"invalid format for a definition of a property': '\"+e+\"' is not an object\")}e(\"./helper.js\"),e(\"./workflow.js\");var ie=e(\"./metamodel.js\"),se=e(\"./db.js\"),de=e(\"./component.js\"),ce=\"_id\",le=\"_name\",me=\"warn\",ue=null,fe={currentLevel:\"warn\",level:function(e){return e&&(this.currentLevel=e),this.currentLevel},debug:function(e){\"debug\"===this.currentLevel&&console.log(\"runtime: \"+e)},info:function(e){\"info\"!==this.currentLevel&&\"debug\"!==this.currentLevel||console.info(\"runtime: \"+e)},warn:function(e){\"info\"!==this.currentLevel&&\"warn\"!==this.currentLevel&&\"debug\"!==this.currentLevel||console.warn(\"runtime: \"+e)},error:function(e){console.error(\"runtime: \"+e)}};t.level=o,t.unknownProperty=a,t.invalidPropertyType=i,t.invalidEnumValue=s,t.invalidClassName=d,t.missingProperty=c,t.missingImplementation=l,t.invalidTypeImp=m,t.missingPropertyImp=u,t.unknownPropertyImp=f,t.invalidTypeDefinition=p,t.invalidPropertyName=y,t.readOnlyProperty=h,t.invalidDocumentOnDbInsert=v,t.invalidPropertyTypeOnDbUpdate=g,t.unknownMethod=b,t.invalidCollectionName=w,t.invalidResultType=O,t.unknownComponent=k,t.workflowRestarted=S,t.invalidParamNumber=j,t.invalidParamType=I,t.behaviorNotUnique=C,t.invalidStateOn=M,t.invalidStateOff=P,t.masterSystemNotFound=R,t.invalidType=A,t.unknownType=N,t.canNotYetValidate=x,t.invalidChannelEvent=$,t.invalidParamNumberMethodOn=q,t.updateUuid=T,t.unknownPropertyOnDbUpdate=_,t.invalidUseOfComponent=F,t.invalidSchema=E,t.invalidModel=L,t.invalidParameters=J,t.destroyedComponentCall=D,t.invalidConctructorParameters=V,t.unknownModel=B,t.missingSchema=G,t.cyclicDependency=U,t.invalidEnumType=z,t.loadSchema=Y,t.loadModel=H,t.loadType=W,t.compileSchema=X,t.generateModel=K,t.checkModel=Q,t.createCollection=Z,t.createClass=ee,t.modelCreationBegin=ne,t.modelCreationEnd=te,t.actionInvokeError=re,t.invalidSchemaProperty=oe,t.invalidPropertyFormat=ae},{\"./component.js\":3,\"./db.js\":4,\"./helper.js\":5,\"./metamodel.js\":7,\"./workflow.js\":10}],7:[function(e,n,t){\"use strict\";function r(){var e=\"\",n=\"\",t=\"\",r={},o=\"\",a=null,i=null,d=null,c={},l={},m=[],u=0,f=0,p=0,y=0,h=[];for(t in pe.compiledSchemas){c={_name:(r=pe.compiledSchemas[t])._name},void 0!==r._core&&(c._core=r._core),Array.isArray(r._inherit)&&(c._inherit=r._inherit),void 0!==r._class&&(c._class=r._class),void 0!==r._description&&(c._description=r._description);for(e in r)switch(!0){case\"property\"===r[e]:c[e]={type:\"any\",readOnly:!1,mandatory:!1,default:\"\",description:e,label:e};break;case\"link\"===r[e]:c[e]={type:\"@_Component\",readOnly:!1,mandatory:!1,default:\"\",description:e,label:e};break;case\"method\"===r[e]:c[e]={params:[{name:\"param\",type:\"any\",mandatory:!1}],result:\"any\",description:e};break;case\"event\"===r[e]:c[e]={params:[{name:\"param\",type:\"any\",mandatory:!1}],description:e};break;case\"collection\"===r[e]:c[e]={type:[\"@_Component\"],readOnly:!1,mandatory:!1,default:[],description:e,label:e};break;default:0!==e.indexOf(\"_\")&&Q.invalidSchemaProperty(r._name,e)}pe.generatedModels[c._name]=c}for(o in pe.generatedModels)n=(c=pe.generatedModels[o])[te],(i=pe.models[n])&&(l=I(i,c),pe.generatedModels[n]=l);for(y=(h=s()).length,f=0;f<y;f++)if(o=h[f],c=pe.generatedModels[o]){(m=W(o)).reverse();JSON.parse(JSON.stringify(c));for(u=m.length,p=0;p<u;p++)n=m[p],(a=pe.generatedModels[n])&&(l=I(a,c),pe.generatedModels[o]=l);(i=pe.models[o])&&(l=I(i,pe.generatedModels[o]),pe.generatedModels[o]=l)}for(o in pe.generatedModels)d=pe.generatedModels[o],K._GeneratedModel.insert(d),d._core||Q.generateModel(o)}function o(){var e=[],n=[],t=null,r={},o=[],a=null,i=\"\",s=\"\",d=0,c=0;for(pe.inheritance={},pe.inheritanceTree={},pe.schemas={},pe.compiledSchemas={},pe.models={},pe.generatedModels={},pe.states={},pe.type={},c=(e=K._Schema.find({})).length,d=0;d<c;d++)i=(t=e[d])[te],s=t[oe],pe.schemas[i]=t,s&&(pe.inheritance[i]=s),t._core||Q.loadSchema(i);for(c=(o=K._Model.find({})).length,d=0;d<c;d++)i=(r=o[d])[te],pe.models[i]=r,r._core||Q.loadModel(i);for(c=(n=K._Type.find({})).length,d=0;d<c;d++)a=n[d],pe.type[a.name]=a,a.core||Q.loadType(a.name)}function a(){function e(e){var n=0,t=0,r=!0;for(t=e.length,n=0;n<t;n++)e[n].length&&(r=!1);return r}function n(e,n){var t=0,r=0,o=[];for(r=n.length,t=0;t<r;t++)0===n[t].indexOf(e)&&((o=n[t]).reverse(),o.pop(),o.reverse(),n[t]=o)}function t(e,n){var t=!0,r=0,o=0;for(o=n.length,r=0;r<o;r++)n[r].indexOf(e)>0&&(t=!1);return t}function r(e){var r=0,o=0,a=[];for(o=e.length,r=0;r<o;r++)if(t(e[r][0],e)){a.push(e[r][0]),n(e[r][0],e);break}return a}function o(n){var t=[],o=[];for(o=r(n);void 0!==o[0];)t=t.concat(o),o=r(n);return e(n)||Q.cyclicDependency(),t}function a(e){var n=[],t=0,r=0;for(Array.isArray(pe.inheritance[e])?n=pe.inheritance[e].slice():Q.missingSchema(e),r=n.length,t=0;t<r;t++)if(function(e,n){var t=!1;return Array.isArray(pe.inheritance[n])&&-1!==pe.inheritance[n].indexOf(e)&&(Q.cyclicDependency(e),t=!0),t}(e,n[t])){n=[];break}return n.length?[e].concat(o(n.map(a).concat([n]))):[e]}var i=\"\",s=[];for(i in pe.inheritance)(s=a(i).reverse()).pop(),s.length&&(pe.inheritanceTree[i]=s)}function i(e){var n={},t=pe.schemas[e],r=pe.inheritanceTree[e],o=0,a=0,i=null,s=\"\";for(r&&(o=r.length,r.reverse()),a=0;a<o;a++){i=pe.schemas[r[a]];for(s in i)0!==s.indexOf(\"_\")&&(n[s]=i[s])}for(s in t)n[s]=t[s];return n}function s(){var e=[],n={},t=\"\",r=0;for(t in pe.inheritanceTree)r=pe.inheritanceTree[t].length,void 0===n[r]&&(n[r]=[]),n[r].push(t);return Object.keys(n).sort().forEach(function(t){n[t].forEach(function(n){e.push(n)})}),e}function d(){var e=\"\";for(e in pe.schemas)pe.schemas[e]._core||Q.compileSchema(e),pe.compiledSchemas[e]=i(e)}function c(){var e=\"\",n=null,t=\"\";for(e in pe.generatedModels)(n=pe.generatedModels[e])&&((t=pe.compiledSchemas[e])?(n._core||Q.checkModel(e),m(n,t)):Q.missingImplementation(e))}function l(){var e=\"\",n=null,t=\"\",r=[],o=\"\";for(e in pe.compiledSchemas){if(r=[],n=pe.compiledSchemas[e])for(o in n)t=n[o],0!==o.indexOf(\"_\")&&-1!==ue.indexOf(t)&&r.push(o);pe.states[e]=r}}function m(e,n){var t=\"\";for(t in n)t!==ne&&t!==te&&t!==re&&t!==oe&&t!==ae&&t!==ie&&(void 0!==e[t]?u(e[t],n[t])||Q.invalidTypeImp(t,e[te]):Q.missingPropertyImp(t,e[te]));for(t in e)t!==ne&&t!==te&&t!==re&&t!==oe&&t!==ae&&t!==ie&&void 0===n[t]&&Q.unknownPropertyImp(t,e[te])}function u(e,n){return S(n,\"string\")&&-1!==fe.indexOf(n)?S(e,n):f(e,n)}function f(e,n){var t=!0,r=pe.type[n],o=0,a=0;if(S(r,\"undefined\"))t=!1;else if(S(e,\"undefined\"))t=!1;else if(\"array\"===r.type)for(o=e.length,a=0;a<o&&!1!==(t=S(r.schema,\"undefined\")?J(e[a],r.type):V(e[a],r.schema));a++);else t=S(r.schema,\"undefined\")?J(e,r.type):V(e,r.schema);return t}function p(){K.collection(\"_Logger\"),K.collection(\"_Schema\"),K.collection(\"_Model\"),K.collection(\"_GeneratedModel\"),K.collection(\"_ClassInfo\"),K.collection(\"_Behavior\"),K.collection(\"_State\"),K.collection(\"_Type\"),K.collection(\"_Message\"),K.collection(\"_Channel\"),K.collection(\"_Log\")}function y(){var e=\"\",n={};for(e in pe.generatedModels)n=pe.generatedModels[e],void 0===K[n[te]]&&!1!==n[ae]&&(K.collection(n[te]),n._core||Q.createCollection(n[te]))}function h(){var e=\"\",n={};for(e in pe.generatedModels)!1!==(n=pe.generatedModels[e])[ae]&&(Z.create({model:e}),n._core||Q.createClass(e))}function v(){var e=\"\",n={},t=\"\";for(e in pe.generatedModels)t=(n=pe.generatedModels[e])[te]+\"Info\",!1!==n[ae]&&X(n[te],\"_Component\")&&(Z.get(t)?K._ClassInfo.update({_id:t},{_id:t,schema:pe.compiledSchemas[e],model:n}):K._ClassInfo.insert({_id:t,schema:pe.compiledSchemas[e],model:n}))}function g(e){return e.replace(\"@\",\"\")}function _(e){return S(e,\"string\")&&-1===fe.indexOf(e)&&!b(e)}function b(e){return-1!==e.indexOf(\"@\")}function w(e){var n=\"\";return n=Array.isArray(e)?\"array\":typeof e,\"any\"===e&&(n=\"any\"),n}function O(e){var n=\"\";return e&&e.constructor&&(n=e.constructor.name),n}function k(e,n){return-1!==n.indexOf(e)}function S(e,n){var t=!0,r=null;switch(n){case\"array\":t=Array.isArray(e);break;case\"date\":\"string\"==typeof e?(r=new Date(e),t=!isNaN(r.getDate())):t=e instanceof Date;break;case\"any\":t=!0;break;default:t=n===typeof e}return t}function j(e,n,t){var r=!1,o=pe.generatedModels[n];return o&&o[te]&&(o=pe.compiledSchemas[o[te]]),o&&o[e]===t&&(r=!0),r}function I(e,n,t){var r=\"\",o=n;for(r in e)e.hasOwnProperty(r)&&0!==r.indexOf(\"_\")&&(o[r]=e[r]);return o}function C(e){var n=null,t=null,r=\"\",o={},a=[];return t=JSON.parse(JSON.stringify(e)),r=t[te],void 0===t[ne]&&(t[ne]=ee.generateId()),void 0===t[oe]&&(t[oe]=[\"_Component\"]),t[oe]=function(e){var n=[],t={};return e.forEach(function(e){void 0===t[e]&&(t[e]=e,n.push(e))}),n}(t[oe]),B(t,pe.metadef.schema,!1)?(a=K._Schema.find({_name:r})).length?(o=I(t,a[0]),K._Schema.update({_name:r},o),n=a[0]._id):n=K._Schema.insert(t)[0]:Q.invalidSchema(t[te]),n}function M(e){var n=null,t=null,r=\"\",o={},a=[];return n=JSON.parse(JSON.stringify(e)),r=n[te],void 0===n[ne]&&(n[ne]=ee.generateId()),B(n,pe.metadef.model,!1)?(a=K._Model.find({_name:r})).length?(o=I(n,a[0]),K._Model.update({_name:r},o),t=a[0]._id):t=K._Model.insert(n)[0]:Q.invalidModel(n[te]),t}function P(e){var n=null,t=e.name;return B(e,pe.metadef.type)?n=K._Type.insert(e)[0]:Q.invalidTypeDefinition(t),n}function R(){A(),pe.metadef={schema:{_id:{type:\"string\",mandatory:!0},_name:{type:\"string\",mandatory:!0},_inherit:{type:[\"string\"],mandatory:!1,default:[\"_Component\"]},_class:{type:\"boolean\",mandatory:!1},_core:{type:\"boolean\",mandatory:!1},_description:{type:\"string\",mandatory:!1}},model:{_id:{type:\"string\",mandatory:!0},_name:{type:\"string\",mandatory:!0},_inherit:{type:[\"string\"],mandatory:!1},_class:{type:\"boolean\",mandatory:!1},_core:{type:\"boolean\",mandatory:!1},_description:{type:\"string\",mandatory:!1}},type:{_id:{type:\"string\",mandatory:!1},name:{type:\"string\",mandatory:!0},type:{type:\"string\",mandatory:!0},schema:{type:\"object\",mandatory:!1},value:{type:[\"any\"],mandatory:!1},core:{type:\"boolean\",mandatory:!1},_description:{type:\"string\",mandatory:!1}}},p()}function A(){pe={metadef:{},inheritance:{},inheritanceTree:{},schemas:{},compiledSchemas:{},models:{},generatedModels:{},states:{},type:{}}}function N(){Q.modelCreationBegin(),o(),a(),d(),r(),c(),l(),y(),h(),v(),Q.modelCreationEnd()}function x(e,n){return j(e,n,de)}function $(e,n){return j(e,n,ce)}function q(e,n){return j(e,n,le)}function T(e,n){return j(e,n,me)}function F(e,n){return j(e,n,se)}function E(e,n){var t=!1,r=pe.generatedModels[n],o=\"\";return r[e]&&(o=pe.type[r[e].type]),o&&o.schema&&(t=!0),t}function L(e,n){var t=!1,r=pe.generatedModels[n],o={};return r&&r[te]&&(r=pe.generatedModels[r[te]]),o=pe.states[r[te]],Array.isArray(o)&&(t=-1!==o.indexOf(e)),t}function J(e,n){function t(e,n){var t=!0,r=g(n),o=e;return\"\"!==e&&null!==e&&(S(e,\"string\")&&(o=Z.get(e)),O(o)!==r&&\"{}\"!==JSON.stringify(o)&&(t=!1,Q.invalidType(e,n.replace(\"@\",\"\")))),t}var r=!0;switch(!0){case _(n):(r=f(e,n))||Q.invalidEnumType(e,n,pe.type[n].type),r&&(r=function(e,n){var t=pe.type[n],r=!0;return Array.isArray(t.value)&&-1===t.value.indexOf(e)&&(r=!1),!1===r&&Q.invalidEnumValue(e,n),r}(e,n));break;case b(n):r=t(e,n);break;default:r=function(e,n){var r=!0,o=0,a=0;switch(w(n)){case\"string\":r=S(e,n);break;case\"array\":for(a=e.length,o=0;o<a;o++)switch(!0){case _(n[0]):r=f(e[o],n[0]);break;case b(n[0]):r=t(e[o],n[0]);break;default:r=S(e[o],n[0])}}return r}(e,n)}return r}function D(e,n){var t=!0;return b(n.type)?(t=function(e,n){var t=\"\";return\"Function\"===(t=e.constructor.name)&&(t=e.name),t===n}(Z.get(e),g(n.type))&&-1!==n.value.indexOf(e))||Q.invalidEnumValue(e,n.type):(t=S(e,n.type)&&-1!==n.value.indexOf(e))||Q.invalidEnumValue(e,n.name),t}function V(e,n){var t=\"\",r=null,o=!0,a=\"\",i=\"\",s=\"\",d=0,c=0;if(S(e,\"object\")){for(t in e){if(r=e[t],S(n[t],\"undefined\"))return Q.unknownProperty(t,n),!1;switch(a=n[t].type,!0){case b(a):o=function(){var n=!0,o=[];return i=g(a),i=e[i],_(i)?pe.type[i]?pe.type[i].schema?n=V(r,pe.type[i].schema):(n=S(r,pe.type[i].type),(o=pe.type[i].value)&&(n=k(r,o))):n=!1:n=\"array\"===i?Array.isArray(r):b(i)?S(r,\"object\")||S(r,\"string\"):S(r,i),n||Q.invalidPropertyType(t,i,r),n}();break;default:o=function(){var e=!0;switch(s=w(a)){case\"string\":if(_(s))e=V(r,a);else if(!S(r,a)){Q.invalidPropertyType(t,a,r),e=!1;break}break;case\"array\":for(d=r.length,c=0;c<d;c++)if(_(a[0]))e=V(r[c],pe.type[a[0]].schema);else if(!S(r[c],a[0])){Q.invalidPropertyType(r[c],a[0],r[c]),e=!1;break}}return e}()}if(!o)break}for(t in n)if(r=n[t],!0===r.mandatory&&S(e[t],\"undefined\")&&void 0!==e[t]){Q.missingProperty(t),o=!1;break}}else o=!1,Q.invalidPropertyFormat(e);return o}function B(e,n,t,r){function o(e,n){var t=!0,r=\"\";if(r=pe.type[n])switch(!0){case!S(r.schema,\"undefined\"):t=B(e,r.schema);break;case!S(r.value,\"undefined\"):t=D(e,r);break;default:t=J(e,r.type)}else t=!1;return t}var a=\"\",i=null,s=!0,d=!0,c=\"\",l=\"\",m=\"\",u=0,f=0;S(t,\"undefined\")&&(t=!0),S(r,\"undefined\")&&(t=!1);for(a in e)if(i=e[a],S(n[a],\"undefined\")&&\"_core\"!==a){if(t)return Q.unknownProperty(a,n),!1}else switch(c=\"_core\"!==a?n[a].type:\"boolean\",\"_id\"===a&&(c=\"string\"),!0){case _(c):s=o(i,c);break;case b(c):s=function(n,t){var o=!0,i=null,s=!1;if(l=g(t),n&&n.id?(i=n,s=!0):i=Z.get(n),S(i,\"undefined\"))switch(!0){case S(n,\"object\")&&null!==n&&Object.keys(n).length>0:case S(n,\"string\")&&\"\"!==n:Q.canNotYetValidate(n,l)}else X(i.constructor.name,l)?s&&r&&(e[a]=i.id()):(o=!1,Q.invalidType(n,l));return o}(i,c);break;default:s=function(e,n){var t=!0,i=null,s=\"\";switch(m=w(n)){case\"any\":break;case\"string\":if(_(m))t=B(e,n);else if(\"array\"===n){if(\"array\"!==w(e)){Q.invalidPropertyType(a,n,e),t=!1;break}}else if(\"date\"===n){if(i=new Date(e),!(t=!isNaN(i.getDate()))){Q.invalidPropertyType(a,n,e);break}}else if(w(e)!==n&&\"any\"!==w(e)){Q.invalidPropertyType(a,n,e),t=!1;break}break;case\"array\":if(Array.isArray(e)){for(u=e.length,s=n[0],f=0;f<u;f++)if(_(s))t=o(e[f],s);else if(b(s))if(\"string\"===w(e[f]))if(Z.get(e[f])){if(!X(O(Z.get(e[f])),g(s))){Q.invalidClassName(JSON.stringify(e[f]),g(s),O(Z.get(e[f]))),t=!1;break}}else\"\"!==e[f]&&Q.canNotYetValidate(e[f],g(s));else{if(!X(O(e[f]),g(s))){Q.invalidClassName(JSON.stringify(e[f]),g(s),O(e[f])),t=!1;break}r&&(e[f]=e[f].id())}else if(w(e[f])!==s&&\"any\"!==s){Q.invalidPropertyType(e[f],s,e[f]),t=!1;break}}else t=!1,Q.invalidType(e,\"array\");break;default:t=!1,Q.unknownType(e)}return t}(i,c)}for(a in n)d=(i=n[a]).mandatory,S(e[a],\"undefined\")&&!0===d&&(Q.missingProperty(a),s=!1);return s}function G(e,n){var t=\"\",r=null,o=!0,a=\"\";for(t in n)o=(r=n[t]).mandatory,a=r.default,S(e[t],\"undefined\")&&(!1!==o||S(a,\"undefined\")||(e[t]=a))}function U(e){var n=null;return pe.compiledSchemas[e]&&(n=pe.compiledSchemas[e]),n}function z(e){var n=null;return pe.generatedModels[e]&&(n=pe.generatedModels[e]),n}function Y(e){var n=null;return pe.type[e]&&pe.type[e]&&(n=JSON.parse(JSON.stringify(pe.type[e]))),n}function H(){return pe.metadef.schema}function W(e){return pe.inheritanceTree[e]?pe.inheritanceTree[e].slice():[]}function X(e,n){function t(e,n){var r=!1,o=[],a=0;if(0!==(o=W(e)).length)if(-1!==o.indexOf(n))r=!0;else for(a=0;a<0&&!(r=t(o[a],n));a++);return r}var r=!1,o=[],a=0,i=0;if(e!==n){if(o=W(e),i=o.length,0!==o.length)if(-1!==o.indexOf(n))r=!0;else for(a=0;a<i&&!(r=t(o[a],n));a++);}else r=!0;return r}var K=e(\"./db.js\"),Q=e(\"./log.js\"),Z=e(\"./component.js\"),ee=(e(\"./workflow.js\"),e(\"./helper.js\")),ne=\"_id\",te=\"_name\",re=\"_description\",oe=\"_inherit\",ae=\"_class\",ie=\"_core\",se=\"method\",de=\"event\",ce=\"property\",le=\"link\",me=\"collection\",ue=[\"property\",\"collection\",\"link\",\"method\",\"event\"],fe=[\"boolean\",\"string\",\"number\",\"object\",\"function\",\"array\",\"date\",\"any\"],pe={metadef:{},inheritance:{},inheritanceTree:{},schemas:{},compiledSchemas:{},models:{},generatedModels:{},states:{},type:{}};t.init=R,t.clear=A,t.schema=C,t.model=M,t.type=P,t.create=N,t.getSchema=U,t.getModel=z,t.getMetaDef=H,t.getParents=W,t.inheritFrom=X,t.isValidObject=B,t.prepareObject=G,t.isValidType=J,t.isValidEnum=D,t.isValidState=L,t.isEvent=x,t.isProperty=$,t.isLink=q,t.isCollection=T,t.isMethod=F,t.isStructure=E,t.getType=Y},{\"./component.js\":3,\"./db.js\":4,\"./helper.js\":5,\"./log.js\":6,\"./workflow.js\":10}],8:[function(e,n,t){(function(t){\"use strict\";\"undefined\"==typeof window&&void 0!==t&&(t.require=e);var r=e(\"./db.js\"),o=e(\"./component.js\"),a=e(\"./metamodel.js\"),i=e(\"../build/system/system.js\"),s=\"\",d=\"\",c=null;e(\"./helper.js\").polyfill(),a.init(),s=r.importSystem(i.system),d=o.get(s),c=o.get(\"channel\"),d.state(\"installed\"),c.$systemInstalled(s),d.state(\"resolved\"),c.$systemResolved(s),d.state(\"starting\"),c.$systemStarted(s),d.start(),d.state(\"active\"),n.exports=o.get(\"runtime\")}).call(this,\"undefined\"!=typeof global?global:\"undefined\"!=typeof self?self:\"undefined\"!=typeof window?window:{})},{\"../build/system/system.js\":1,\"./component.js\":3,\"./db.js\":4,\"./helper.js\":5,\"./metamodel.js\":7}],9:[function(e,n,t){\"use strict\";function r(e,n,t){s[e]={state:n,value:t},i.store._State[e]={state:n,value:t}}function o(e){return s[e]}function a(){s={}}var i=e(\"./db.js\"),s={};t.set=r,t.get=o,t.clear=a},{\"./db.js\":4}],10:[function(e,n,t){\"use strict\";function r(e){this.message=e,this.name=\"RuntimeError\"}function o(e,n){var t=null,r=[],o=[],a=0,i=0;if(g.getModel(e)?t=g.getModel(e)[n]:k.unknownModel(e),t){if(r=t.params)for(a=r.length,i=0;i<a;i++)o.push(r[i].name)}else k.unknownMethod(e,n);return o}function a(e,n){var t=null,r=[],o=[],a=0,i=0,s=0,d=0;if(g.getModel(e)?t=g.getModel(e)[n]:k.unknownModel(e),t){if(r=t.params)for(a=r.length,i=0;i<a;i++)void 0!==r[i].mandatory&&!0!==r[i].mandatory||(s+=1),d+=1;o.push(s),o.push(d)}else k.unknownMethod(e,n);return o}function i(e,n,t){var r=null,o=[],a=[],i=0,s=0;if(r=g.getModel(e)[n]){if(o=r.params)for(i=o.length,s=0;s<i;s++)!1===o[s].mandatory&&void 0===t[s]?a.push(o[s].default):a.push(t[s])}else k.unknownMethod(e,n);return a}function s(e,n){var t=null,r=null;return g.getModel(e)?t=g.getModel(e)[n].result:k.unknownModel(e),t&&(r=t),r}function d(e,n){var t=null,r=[],o=[],a=0,i=0;if(g.getModel(e)?t=g.getModel(e)[n]:k.unknownModel(e),t){if(r=t.params)for(a=r.length,i=0;i<a;i++)o.push(r[i].type)}else k.unknownMethod(e,n);return o}function c(e){var n=(e=e||{}).component||null,t=e.methodName||\"\",r=null,o=\"\",a=\"\",i=null,d=!0;if(r=void 0!==e.methodResult?e.methodResult:void 0,a=\"Function\"===n.constructor.name?n.name:n.constructor.name,null!==(i=s(a,t)))switch(!0){case\"any\"===i:break;case\"array\"===i:Array.isArray(r)||(d=!1,k.invalidResultType(n.id(),n.constructor.name,t,i,null));break;case-1!==i.indexOf(\"@\"):r.constructor?(o=\"Function\"===r.constructor.name?r.name:r.constructor.name)!==i.replace(\"@\",\"\")&&(d=!1,k.invalidResultType(n.id(),n.constructor.name,t,i,o)):(d=!1,k.invalidResultType(n.id(),n.constructor.name,t,i,typeof r));break;default:typeof r!==i&&(d=!1,k.invalidResultType(n.id(),n.constructor.name,t,i,typeof r))}return d}function l(e,n,t){var r=b.getActions(e.id(),n),o=[],a=0,i=0,s=null;if(!r.length||t)if(\"Function\"!==e.constructor.name)r=r.concat(l(_.get(e.constructor.name),n,t));else for(a=(o=g.getParents(e.name)).length,i=0;i<a&&(s=_.get(o[i]),s?r=r.concat(l(s,n,t)):k.unknownComponent(o[i],e.name),!r.length);i++);return r.length&&r.reverse(),r}function m(e,n,o,a,s){var d=null,c=[],l=\"\",m=0,u=0;l=\"Function\"===e.constructor.name?e.name:e.constructor.name,g.isProperty(n,l)||g.isLink(n,l)||g.isCollection(n,l)||(a=i(l,n,a));try{for(u=a.length,m=0;m<u;m++)c.push(a[m]);o.useCoreAPI&&(c.push(_),c.push(S),c.push(g),c.push(t),c.push(b),c.push(w),c.push(k)),s?setTimeout(o.action.bind.apply(o.action,[e].concat(c)),0):d=o.action.apply(e,c)}catch(t){if(t instanceof r)throw t;void 0===new Function?console.error(\"runtime: can not execute new Function() instruction in the current context.\"):(e&&e.error&&e.error({message:\"error when trying to call the method '\"+n+\"' on component '\"+e.id()+\"'\",error:t}),O.getRuntime()&&O.getRuntime().error({message:\"error when trying to call the method '\"+n+\"' on component '\"+e.id()+\"'\",error:t}),k.actionInvokeError(n,e.id(),e.constructor.name,t.message))}return d}function u(e,n,t){var r=\"\",o=-1,i=\"\",s=\"\",d=[],c=0,l=[],m=!1,u=!1,f=!1,p=!1;switch(r=t.toString(),o=r.indexOf(\"{\"),i=r.substring(0,o),s=i.split(\"(\")[1].replace(\")\",\"\").trim(),\"\"===(d=s.split(\",\"))[0]&&(d=[]),c=d.length,m=g.isProperty(n,e),u=g.isLink(n,e),f=g.isCollection(n,e),!0){case f:l=[2,2];break;case m:case u:l=[1,1];break;default:l=a(e,n)}return l[0]<=c&&c<=l[1]&&(p=!0),p}function f(e){var n=(e=e||{}).component||null,t=e.methodName||\"\",r=e.args||\"\",i=[],s=[],c=[],l=\"\",m=r.length,u=0,f=null,p=!0,y=!1,h=!1,v=!1;switch(l=\"Function\"===n.constructor.name?n.name:n.constructor.name,y=g.isProperty(t,l),h=g.isLink(t,l),v=g.isCollection(t,l),i=o(l,t),!0){case v:s=r&&r[1]&&\"reset\"===r[1]?[[g.getModel(l)[t].type[0]],\"string\"]:[g.getModel(l)[t].type[0],\"string\"],c=[2,2];break;case y:case h:s=[g.getModel(l)[t].type],c=[1,1];break;default:s=d(l,t),c=a(l,t)}for(void 0===m&&(m=1),(m<c[0]||c[1]<m)&&(p=!1,k.invalidParamNumber(n.id(),n.constructor.name,t)),u=0;u<m;u++)if(void 0===(f=r[u])){if(!(u<c[0]))continue;p=!1,k.invalidParamNumber(n.id(),n.constructor.name,t)}else g.isValidType(f,s[u])||(p=!1,k.invalidParamType(n.id(),n.constructor.name,t,i[u]));return p}function p(e,n){var t=!1,r=!1,o=!1,a=!1,i=[],s=null,d=null,c=\"\",l=null;i=S._Behavior.find({_id:e}),l=b.get(e),1===i.length&&(s=i[0],(d=_.get(s.component))&&(c=\"Function\"===d.constructor.name?d.name:d.constructor.name,t=g.isEvent(s.state,c),r=g.isProperty(s.state,c),o=g.isLink(s.state,c),a=g.isCollection(s.state,c),(t||r||a||o)&&m(d,s.state,{useCoreAPI:s.useCoreAPI,action:l},n,!0)))}function y(e){(e=e||{}).component=e.component||\"\",e.state=e.state||\"\",e.data=e.data||[];var n=null,t=\"\",r=[],o=null,a=null,i=0,s=0,d=!1,u=!1,p=!1,y=!1,h=!1;if((t=w.get(e.component))&&\"destroy\"===t.state&&k.invalidUseOfComponent(e.component),(n=_.get(e.component))&&(d=\"Function\"===n.constructor.name?n.name:n.constructor.name,h=g.isEvent(e.state,d),u=g.isProperty(e.state,d),p=g.isLink(e.state,d),y=g.isCollection(e.state,d),r=l(n,e.state,h)),r.length){if(f({component:n,methodName:e.state,args:e.data}))if(h||u||p||y){for(s=r.length,i=0;i<s;i++)o=r[i],m(n,e.state,o,e.data,!0);w.set(n.id(),e.state,e.data)}else o=r[0],a=m(n,e.state,o,e.data,!1),c({component:n,methodName:e.state,methodResult:a});return a}n&&(h||u||p||y)&&w.set(n.id(),e.state,e.data)}function h(e){if(void 0===(e=e||{}).error&&(e.error=!1),e.message=e.message||\"\",t.state=function(){},e.error)throw new r(e.message?\"runtime has been stopped because \"+e.message:\"runtime has been stopped because of an unknown error\");e.message?console.error(\"runtime: runtime has been stopped because \"+e.message):console.error(\"runtime: runtime has been stopped\")}function v(){t.state=y,k.workflowRestarted()}var g=e(\"./metamodel.js\"),_=e(\"./component.js\"),b=e(\"./behavior.js\"),w=e(\"./state.js\"),O=e(\"./helper.js\"),k=e(\"./log.js\"),S=e(\"./db.js\");r.prototype=new Error,r.prototype.constructor=r,t.state=y,t.stop=h,t.restart=v,t.checkParams=f,t.validParamNumbers=u,t.action=p},{\"./behavior.js\":2,\"./component.js\":3,\"./db.js\":4,\"./helper.js\":5,\"./log.js\":6,\"./metamodel.js\":7,\"./state.js\":9}]},{},[8])(8)});"
      }
    }
  },
  "_id": "k177271eabf1db74"
}
