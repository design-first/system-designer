{
  "name": "JS-class",
  "master": false,
  "version": "1.0.0",
  "description": "",
  "schemas": {
    "w10edc1dd24108d1": {
      "_name": "JS",
      "source": "property",
      "_id": "w10edc1dd24108d1",
      "_inherit": ["_Component"]
    }
  },
  "models": {
    "o180bb1fb96134b7": {
      "_name": "JS",
      "source": {
        "type": "javascript",
        "readOnly": true,
        "mandatory": true,
        "default": ""
      },
      "_id": "o180bb1fb96134b7"
    }
  },
  "behaviors": {},
  "types": {},
  "components": {
    "JS": {
      "app-github.js": {
        "_id": "app-github.js",
        "source":
          "/* \n * {{name}}\n * \n * @description {{description}}\n * \n * @module {{name}}\n * @version {{version}}\n * @requires system-runtime\n * \n */\n\n// install System Runtime\nlet runtime = require('system-runtime');\n\n// set the level of log\nruntime.require('logger').level('{{logLevel}}');\n\n// install and start the system\nruntime.install({{system}});"
      },
      "app.js": {
        "_id": "app.js",
        "source":
          "/* \n * {{name}}\n * \n * @description {{description}}\n * \n * @module {{name}}\n * @version {{version}}\n * @requires system-runtime\n * \n */\n\n// install System Runtime\nlet runtime = require('system-runtime');\n\n// uncomment this line to debug your system\n// runtime.install('node_modules/system-runtime/extensions/mode-admin-server.json');\n\n// set the level of log\nruntime.require('logger').level('{{logLevel}}');\n\n// install and start the system\nruntime.install({{system}});"
      },
      "javascript-export.js": {
        "_id": "javascript-export.js",
        "source":
          "/* \n * {{name}}\n * \n * @description {{description}}\n * \n * @system {{name}}\n * @version {{version}}\n * @requires system-runtime\n * \n */\n\n// uncomment this line if running this script on node.js\n// let runtime = require('system-runtime');\n\n// uncomment this line if running this script on node.js \n// and wanting to debug your system\n// runtime.install('node_modules/system-runtime/extensions/mode-admin-server.json');\n\nruntime.require('logger').level('{{logLevel}}');\n"
      },
      "system-runtime.min.js": {
        "_id": "system-runtime.min.js",
        "source":
          "/*\n * System Runtime\n * \n * https://designfirst.io/systemruntime/\n * \n * Copyright 2017 Erwan Carriou\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n!function(e){if(\"object\"==typeof exports&&\"undefined\"!=typeof module)module.exports=e();else if(\"function\"==typeof define&&define.amd)define([],e);else{(\"undefined\"!=typeof window?window:\"undefined\"!=typeof global?global:\"undefined\"!=typeof self?self:this).runtime=e()}}(function(){return function e(n,t,r){function a(i,s){if(!t[i]){if(!n[i]){var d=\"function\"==typeof require&&require;if(!s&&d)return d(i,!0);if(o)return o(i,!0);var c=new Error(\"Cannot find module '\"+i+\"'\");throw c.code=\"MODULE_NOT_FOUND\",c}var l=t[i]={exports:{}};n[i][0].call(l.exports,function(e){var t=n[i][1][e];return a(t||e)},l,l.exports,e,n,t,r)}return t[i].exports}for(var o=\"function\"==typeof require&&require,i=0;i<r.length;i++)a(r[i]);return a}({1:[function(e,n,t){\"use strict\";t.system={name:\"system-runtime\",master:!1,version:\"2.1.3\",description:\"System Runtime\",schemas:{\"1ac07185641fa9f\":{_name:\"_Behavior\",_inherit:[\"_Component\"],_core:!0,core:\"property\",component:\"property\",action:\"property\",state:\"property\",useCoreAPI:\"property\",_id:\"1ac07185641fa9f\"},\"104ad1f48518376\":{_id:\"104ad1f48518376\",_name:\"_Channel\",_inherit:[\"_Component\"],_core:!0,send:\"event\",$systemInstalled:\"event\",$systemResolved:\"event\",$systemStarted:\"event\",$systemStopped:\"event\",$systemUninstalled:\"event\"},\"1c00b13a1b1bc92\":{_name:\"_ClassInfo\",_inherit:[\"_Component\"],_core:!0,model:\"property\",schema:\"property\",method:\"method\",methods:\"method\",property:\"method\",properties:\"method\",link:\"method\",links:\"method\",collections:\"method\",collection:\"method\",event:\"method\",events:\"method\",_id:\"1c00b13a1b1bc92\"},\"111df11e2b19fde\":{_id:\"111df11e2b19fde\",_name:\"_Component\",_inherit:[],_core:!0,classInfo:\"property\",on:\"method\",off:\"method\",require:\"method\",destroy:\"method\",init:\"method\",error:\"event\"},\"1723516a30132ac\":{_name:\"_Database\",_inherit:[\"_Component\"],_core:!0,collections:\"method\",insert:\"event\",update:\"event\",remove:\"event\",_id:\"1723516a30132ac\"},f1a10d1067d1b23a:{_id:\"f1a10d1067d1b23a\",_name:\"_Log\",_inherit:[\"_Component\"],_core:!0,action:\"property\",collection:\"property\",id:\"property\",field:\"property\",value:\"property\",order:\"property\"},\"1268f1dddd1fea7\":{_name:\"_Logger\",_core:!0,level:\"property\",debug:\"method\",info:\"method\",warn:\"method\",error:\"method\",_id:\"1268f1dddd1fea7\"},\"14caa1c46414ee1\":{_name:\"_Message\",_inherit:[\"_Component\"],_core:!0,event:\"property\",from:\"property\",data:\"property\",_id:\"14caa1c46414ee1\"},\"193f1166eb16609\":{_name:\"_Metamodel\",_inherit:[\"_Component\"],_core:!0,schema:\"method\",model:\"method\",type:\"method\",create:\"method\",_id:\"193f1166eb16609\"},\"157931f7a31b61d\":{_id:\"157931f7a31b61d\",_name:\"_OSGi\",_inherit:[\"_Component\"],_core:!0,install:\"method\",uninstall:\"method\",start:\"method\",stop:\"method\",status:\"method\",bundle:\"method\"},\"12e211d4cd120a6\":{_id:\"12e211d4cd120a6\",_name:\"_Runtime\",_inherit:[\"_OSGi\"],_core:!0,version:\"property\",system:\"method\",message:\"method\",ready:\"event\"},\"158711d6f215e4b\":{_name:\"_State\",_inherit:[],_core:!0,_class:!1,state:\"property\",value:\"property\",_id:\"158711d6f215e4b\"},\"1cb761fa4510dca\":{_id:\"1cb761fa4510dca\",_name:\"_System\",_inherit:[\"_SystemOSGi\"],_core:!0,name:\"property\",master:\"property\",version:\"property\",description:\"property\",schemas:\"property\",models:\"property\",behaviors:\"property\",types:\"property\",components:\"property\"},\"145fe10c7514298\":{_id:\"145fe10c7514298\",_name:\"_SystemOSGi\",_inherit:[\"_Component\"],_core:!0,state:\"property\",location:\"property\",start:\"method\",stop:\"method\"}},models:{\"166971fd9d107fd\":{_name:\"_Behavior\",_core:!0,core:{type:\"boolean\",readOnly:!1,mandatory:!1,default:!1},useCoreAPI:{type:\"boolean\",readOnly:!1,mandatory:!1,default:!1},component:{type:\"string\",readOnly:!1,mandatory:!0,default:\"\"},action:{type:\"javascript\",readOnly:!1,mandatory:!0,default:\"\"},state:{type:\"string\",readOnly:!1,mandatory:!0,default:\"\"},_id:\"166971fd9d107fd\"},\"135c71078810af2\":{_id:\"135c71078810af2\",_name:\"_Channel\",_core:!0,send:{params:[{name:\"message\",type:\"message\"}]},$systemInstalled:{params:[{name:\"id\",type:\"string\",mandatory:!0,default:\"\"}]},$systemResolved:{params:[{name:\"id\",type:\"string\",mandatory:!0,default:\"\"}]},$systemUninstalled:{params:[{name:\"id\",type:\"string\",mandatory:!0,default:\"\"}]},$systemStarted:{params:[{name:\"id\",type:\"string\",mandatory:!0,default:\"\"}]},$systemStopped:{params:[{name:\"id\",type:\"string\",mandatory:!0,default:\"\"}]}},\"158321dced1014a\":{_name:\"_ClassInfo\",_core:!0,model:{type:\"object\",readOnly:!0,mandatory:!0,default:{}},property:{params:[{name:\"name\",type:\"string\"}],result:\"object\"},properties:{result:\"array\"},link:{params:[{name:\"name\",type:\"string\"}],result:\"object\"},links:{result:\"array\"},method:{params:[{name:\"name\",type:\"string\"}],result:\"object\"},methods:{result:\"array\"},collection:{params:[{name:\"name\",type:\"string\"}],result:\"object\"},collections:{result:\"array\"},event:{params:[{name:\"name\",type:\"string\"}],result:\"object\"},events:{result:\"array\"},_id:\"158321dced1014a\",schema:{type:\"object\",readOnly:!0,mandatory:!0,default:{}}},\"123751cb591de26\":{_id:\"123751cb591de26\",_name:\"_Component\",_core:!0,on:{params:[{name:\"state\",type:\"string\"},{name:\"handler\",type:\"function\"},{name:\"useCoreAPI\",type:\"boolean\",mandatory:!1,default:!1},{name:\"isCore\",type:\"boolean\",mandatory:!1,default:!1}]},off:{params:[{name:\"state\",type:\"string\",mandatory:!1},{name:\"behaviorId\",type:\"string\",mandatory:!1}]},require:{params:[{name:\"id\",type:\"string\"}]},destroy:{params:[]},classInfo:{type:\"_ClassInfo\",readOnly:!1,mandatory:!1,default:{}},init:{params:[{name:\"conf\",type:\"object\"}]},error:{params:[{name:\"data\",type:\"errorParam\"}]}},\"18a51169d7112d4\":{_name:\"_Database\",_core:!0,collections:{result:\"object\"},insert:{params:[{name:\"event\",type:\"dbInsertEvent\"}]},update:{params:[{name:\"event\",type:\"dbUpdateEvent\"}]},remove:{params:[{name:\"event\",type:\"dbRemoveEvent\"}]},_id:\"18a51169d7112d4\"},o1e1e01e6b41cec3:{_id:\"o1e1e01e6b41cec3\",_name:\"_Log\",action:{type:\"dbAction\",readOnly:!1,mandatory:!1,default:\"insert\"},collection:{type:\"string\",readOnly:!1,mandatory:!1,default:\"\"},id:{type:\"string\",readOnly:!1,mandatory:!1,default:\"\"},field:{type:\"string\",readOnly:!1,mandatory:!1,default:\"\"},value:{type:\"any\",readOnly:!1,mandatory:!1,default:\"\"},order:{type:\"number\",readOnly:!1,mandatory:!1,default:0},_core:!0},\"16b9d1ac2216ffe\":{_id:\"16b9d1ac2216ffe\",_name:\"_Logger\",_core:!0,level:{type:\"log\",readOnly:!1,mandatory:!1,default:\"warn\"},debug:{params:[{name:\"message\",type:\"any\"}]},info:{params:[{name:\"message\",type:\"any\"}]},warn:{params:[{name:\"message\",type:\"any\"}]},error:{params:[{name:\"message\",type:\"any\"}]}},\"1d9b6139411aa91\":{_name:\"_Message\",_core:!0,event:{type:\"string\",readOnly:!1,mandatory:!0,default:\"\"},from:{type:\"string\",readOnly:!1,mandatory:!0,default:\"\"},data:{type:\"array\",readOnly:!1,mandatory:!0,default:[]},_id:\"1d9b6139411aa91\"},\"1628c13c22152e6\":{_name:\"_Metamodel\",_core:!0,schema:{params:[{name:\"schema\",type:\"object\"}],result:\"any\"},model:{params:[{name:\"model\",type:\"object\"}],result:\"any\"},type:{params:[{name:\"type\",type:\"object\"}],result:\"any\"},create:{params:[]},_id:\"1628c13c22152e6\"},\"100b91ed2211b15\":{_id:\"100b91ed2211b15\",_name:\"_OSGi\",install:{params:[{name:\"url\",type:\"any\",mandatory:!0,default:\"\"},{name:\"async\",type:\"boolean\",mandatory:!1,default:!0}],result:\"string\"},uninstall:{params:[{name:\"id\",type:\"string\",mandatory:!0,default:\"\"}]},start:{params:[{name:\"id\",type:\"string\",mandatory:!0,default:\"\"}]},stop:{params:[{name:\"id\",type:\"string\",mandatory:!0,default:\"\"}]},status:{result:\"object\"},_core:!0,bundle:{result:\"string\"}},\"14c7c105b31a160\":{_id:\"14c7c105b31a160\",_name:\"_Runtime\",_core:!0,version:{type:\"string\",readOnly:!0,mandatory:!0,default:\"0.0.0\"},system:{params:[{name:\"params\",type:\"any\",mandatory:!1}],result:\"object\"},message:{params:[{name:\"msg\",type:\"message\",mandatory:!0}]},ready:{}},\"177ac136891629f\":{_name:\"_State\",_core:!0,state:{type:\"string\",readOnly:!1,mandatory:!0,default:\"\"},value:{type:\"any\",readOnly:!1,mandatory:!1,default:null},_id:\"177ac136891629f\"},\"170521b88614387\":{_name:\"_System\",_core:!0,name:{type:\"string\",readOnly:!1,mandatory:!0,default:\"\"},master:{type:\"boolean\",readOnly:!1,mandatory:!1,default:!1},version:{type:\"string\",readOnly:!1,mandatory:!1,default:\"0.0.1\"},description:{type:\"string\",readOnly:!1,mandatory:!1,default:\"\"},schemas:{type:\"object\",readOnly:!1,mandatory:!1,default:{}},models:{type:\"object\",readOnly:!1,mandatory:!1,default:{}},behaviors:{type:\"object\",readOnly:!1,mandatory:!1,default:{}},types:{type:\"object\",readOnly:!1,mandatory:!1,default:{}},components:{type:\"object\",readOnly:!1,mandatory:!1,default:{}},_id:\"170521b88614387\"},\"1b2811b092143f5\":{_id:\"1b2811b092143f5\",_name:\"_SystemOSGi\",start:{},stop:{},_core:!0,state:{type:\"string\",readOnly:!1,mandatory:!1,default:\"none\"},location:{type:\"string\",readOnly:!1,mandatory:!1,default:\"\"}}},behaviors:{\"12e491859c13918\":{_id:\"12e491859c13918\",component:\"_Channel\",state:\"$systemStarted\",action:\"function $systemStarted(id) { \\n  var systems = null;\\n    \\n  if (id !== 'e89c617b6b15d24') {\\n    if (typeof document !== 'undefined') {\\n      systems = document.querySelectorAll('link[rel=system]');\\n         \\n      if ($state.get('runtime') && $state.get('runtime').state === 'ready') {    \\n      } else {\\n        if (systems.length + 1 === $db._System.count()) {\\n          $component.get('runtime').ready();\\n        }\\n      }\\n    }\\n  }\\n}\",useCoreAPI:!0,core:!0},\"1e9021bd4e1bc6e\":{_id:\"1e9021bd4e1bc6e\",component:\"_Channel\",state:\"$systemInstalled\",action:\"function $systemInstalled(id) {\\n  var systems = null,\\n    dependencies = [],\\n    master = [],\\n    canStart = true;\\n\\n  if (id !== 'e89c617b6b15d24') {\\n    // if all systems are installed\\n    systems = $db._System.find({});\\n\\n    systems.forEach(function (system) {\\n      var sys = this.require(system._id);\\n      if (sys && sys.state && sys.state() === 'none') {\\n        canStart = false;\\n      }\\n    }.bind(this));\\n\\n    // start all the systems\\n    if (canStart) {\\n      dependencies = $db._System.find({\\n        'master': false\\n      });\\n\\n      dependencies.forEach(function (dep) {\\n        var system = this.require(dep._id);\\n        channel = this.require('channel');\\n\\n        if (system.state() === 'resolved') {\\n          system.state('starting');\\n          system.start();\\n          channel.$systemStarted(dep._id);\\n          system.state('active');\\n        }\\n      }.bind(this));\\n\\n      master = $db._System.find({\\n        'master': true\\n      });\\n\\n      master.forEach(function (dep) {\\n        var system = this.require(dep._id);\\n        channel = this.require('channel');\\n\\n        if (system && system.state && system.state() === 'resolved') {\\n          system.state('starting');\\n          system.start();\\n          channel.$systemStarted(dep._id);\\n          system.state('active');\\n        }\\n      }.bind(this));\\n    }\\n  }\\n}\",useCoreAPI:!0,core:!0},\"155141e40312cd8\":{_id:\"155141e40312cd8\",component:\"_ClassInfo\",state:\"collection\",action:\"function collection(name) {\\n  var result = {};\\n  if (this.schema()[name] === 'collection') {\\n    result = this.model()[name];\\n  }\\n\\n  return result;\\n}\",core:!0},\"1f6941a0c012c1f\":{_id:\"1f6941a0c012c1f\",component:\"_ClassInfo\",state:\"collections\",action:\"function collections(name) {\\n  var keys = Object.keys(this.schema()),\\n    item = '',\\n    result = [],\\n    i = 0,\\n    length = keys.length;\\n\\n  for (i = 0; i < length; i++) {\\n    item = keys[i];\\n    if (this.schema()[item] === 'collection') {\\n      result.push(item);\\n    }\\n  }\\n\\n  return result;\\n}\",core:!0},\"1ef711b4171c849\":{_id:\"1ef711b4171c849\",component:\"_ClassInfo\",state:\"event\",action:\"function event(name) {\\n  var result = {};\\n\\n  if (this.schema()[name] === 'event') {\\n    result = this.model()[name];\\n  }\\n\\n  return result;\\n}\",core:!0},\"1bae51b6ed1d25c\":{_id:\"1bae51b6ed1d25c\",component:\"_ClassInfo\",state:\"events\",action:\"function events(name) {\\n  var keys = Object.keys(this.schema()),\\n    item = '',\\n    result = [],\\n    i = 0,\\n    length = keys.length;\\n\\n  for (i = 0; i < length; i++) {\\n    item = keys[i];\\n    if (this.schema()[item] === 'event') {\\n      result.push(item);\\n    }\\n  }\\n  return result;\\n}\",core:!0},\"19ac2125221528b\":{_id:\"19ac2125221528b\",component:\"_ClassInfo\",state:\"link\",action:\"function link(name) {\\n  var result = {};\\n\\n  if (this.schema()[name] === 'link') {\\n    result = this.model()[name];\\n  }\\n  return result;\\n}\",core:!0},\"17ed21dfc01b8e8\":{_id:\"17ed21dfc01b8e8\",component:\"_ClassInfo\",state:\"links\",action:\"function links(name) {\\n  var keys = Object.keys(this.schema()),\\n    item = '',\\n    result = [],\\n    i = 0,\\n    length = keys.length;\\n\\n  for (i = 0; i < length; i++) {\\n    item = keys[i];\\n    if (this.schema()[item] === 'link') {\\n      result.push(item);\\n    }\\n  } return result;\\n}\",core:!0},\"11ce318a561ac61\":{_id:\"11ce318a561ac61\",component:\"_ClassInfo\",state:\"method\",action:\"function method(name) {\\n  var result = {};\\n  if (this.schema()[name] === 'method') {\\n    result = this.model()[name];\\n  }\\n  \\n  return result;\\n}\",core:!0},\"12ff2190a018046\":{_id:\"12ff2190a018046\",component:\"_ClassInfo\",state:\"methods\",action:\"function methods(name) {\\n  var keys = Object.keys(this.schema()),\\n    item = '',\\n    result = [],\\n    i = 0,\\n    length = keys.length;\\n\\n  for (i = 0; i < length; i++) {\\n    item = keys[i];\\n    if (this.schema()[item] === 'method') {\\n      result.push(item);\\n    }\\n  }\\n\\n  return result;\\n}\",core:!0},\"1028d1681e1fd58\":{_id:\"1028d1681e1fd58\",component:\"_ClassInfo\",state:\"properties\",action:\"function properties(name) {\\n  var keys = Object.keys(this.schema()),\\n    item = '',\\n    result = [],\\n    i = 0,\\n    length = keys.length;\\n\\n  for (i = 0; i < length; i++) {\\n    item = keys[i];\\n    if (this.schema()[item] === 'property') {\\n      result.push(item);\\n    }\\n  } return result;\\n}\",core:!0},\"18eeb10c5319368\":{_id:\"18eeb10c5319368\",component:\"_ClassInfo\",state:\"property\",action:\"function property(name) {\\n  var result = {};\\n\\n  if (this.schema()[name] === 'property') {\\n    result = this.model()[name];\\n  }\\n  return result;\\n}\",core:!0},\"1ba721201114b6b\":{_id:\"1ba721201114b6b\",component:\"_Component\",state:\"destroy\",action:\"function destroy() {\\n  $component.destroy(this.id());\\n}\",core:!0,useCoreAPI:!0},\"15486186f41a48c\":{_id:\"15486186f41a48c\",component:\"_Component\",state:\"off\",action:'function off(state, behaviorId) {\\n  var args = [],\\n    i = 0,\\n    length = arguments.length;\\n\\n  for (i = 0; i < length - 7; i++) {\\n    args.push(arguments[i]);\\n  }\\n\\n  if ($workflow.checkParams({\\n    \"component\": this,\\n    \"methodName\": \"off\",\\n    \"args\": args\\n  })) {\\n\\n    if (state || behaviorId) {\\n      if ($metamodel.isValidState(state, this.constructor.name)) {\\n        $behavior.remove({\\n          \"behaviorId\": behaviorId,\\n          \"componentId\": this.id(),\\n          \"state\": state\\n        });\\n      } else {\\n        this.require(\\'logger\\').warn(\"invoke \\\\\\'off\\\\\\' method of component \\'\" + this.id() + \"\\' with an invalid state \\'\" + state + \"\\'\");\\n      }\\n    } else {\\n      $behavior.remove({\\n        \"componentId\": this.id()\\n      });\\n    }\\n  }\\n}',core:!0,useCoreAPI:!0},\"1da0a17878104c3\":{_id:\"1da0a17878104c3\",component:\"_Component\",state:\"require\",action:\"function require(id) {\\n  return $component.get(id);\\n}\",core:!0,useCoreAPI:!0},\"1a5111d17a1800c\":{_id:\"1a5111d17a1800c\",component:\"_Database\",state:\"collections\",action:\"function collections() {\\n  var result = {},\\n    collectionName = '';\\n\\n  for (collectionName in $db.store) {\\n    if ($db.store.hasOwnProperty(collectionName) && collectionName.indexOf('_') !== 0) {\\n      result[collectionName] = $db[collectionName];\\n    }\\n  }\\n  return result;\\n}\",core:!0,useCoreAPI:!0},\"1d993108fa18ef2\":{_id:\"1d993108fa18ef2\",component:\"_Logger\",state:\"debug\",action:\"function debug(message) {\\n  if (this.level() === 'debug') {\\n    console.log('runtime: ' + message);\\n  }\\n}\",core:!0},\"1a37a188e11fe73\":{_id:\"1a37a188e11fe73\",component:\"_Logger\",state:\"error\",action:\"function error(message) {\\n  console.error('runtime: ' + message);\\n}\",core:!0},\"1edd21e12a16534\":{_id:\"1edd21e12a16534\",component:\"_Logger\",state:\"info\",action:\"function info(message) {\\n  if (this.level() === 'info' || this.level() === 'debug') {\\n    console.info('runtime: ' + message);\\n  }\\n}\",core:!0},\"141f2143d3122a4\":{_id:\"141f2143d3122a4\",component:\"_Logger\",state:\"level\",action:\"function level(val) {\\n  $log.level(val);\\n}\",core:!0,useCoreAPI:!0},\"192401bab21304e\":{_id:\"192401bab21304e\",component:\"_Logger\",state:\"warn\",action:\"function warn(message) {\\n  if (this.level() === 'info' || this.level() === 'warn' || this.level() === 'debug') {\\n    console.warn('runtime: ' + message);\\n  }\\n}\",core:!0},\"11fc715e2f1a31e\":{_id:\"11fc715e2f1a31e\",component:\"_Metamodel\",state:\"create\",action:\"function create() {\\n  $metamodel.create();\\n}\",core:!0,useCoreAPI:!0},\"1232f1f107142cf\":{_id:\"1232f1f107142cf\",component:\"_Metamodel\",state:\"model\",action:\"function model(model) {\\n  return $metamodel.model(model);\\n}\",core:!0,useCoreAPI:!0},\"1365412f69153d2\":{_id:\"1365412f69153d2\",component:\"_Metamodel\",state:\"schema\",action:\"function schema(schema) {\\n  return $metamodel.schema(schema);\\n}\",core:!0,useCoreAPI:!0},\"194db147fe161a2\":{_id:\"194db147fe161a2\",component:\"_Metamodel\",state:\"type\",action:\"function type(type) {\\n  return $metamodel.type(type);\\n}\",core:!0,useCoreAPI:!0},\"1ef951f1411b895\":{_id:\"1ef951f1411b895\",component:\"_OSGi\",state:\"install\",action:\"function install(url, async) {\\n  var importedSystem = null,\\n    system = {},\\n    systemId = '',\\n    callbackLoad = null,\\n    xhr = null,\\n    result = '',\\n    channel = $component.get('channel');\\n\\n  if (typeof url === 'object') {\\n    importedSystem = url;\\n  } else {\\n    if (url.indexOf('{') === 0) {\\n      importedSystem = JSON.parse(url);\\n    }\\n  }\\n\\n  if (importedSystem) {\\n    systemId = $db.importSystem(importedSystem);\\n    if (systemId) {\\n      system = this.require(systemId);\\n\\n      if (typeof url === 'string') {\\n        system.location(url);\\n      }\\n      system.state('installed');\\n      channel.$systemInstalled(systemId);\\n      system.state('resolved');\\n      channel.$systemResolved(systemId);\\n\\n      result = systemId;\\n    }\\n  } else {\\n    if (typeof global !== 'undefined' && typeof window === 'undefined') {\\n      if (url.indexOf('.json') !== -1) {\\n        system = global.require(global.process.env.PWD + '/' + url);\\n      } else {\\n        system = global.require(url);\\n      }\\n      systemId = $db.importSystem(system);\\n      system = this.require(systemId);\\n\\n      if (typeof url === 'string') {\\n        system.location(url);\\n      }\\n      system.state('installed');\\n      channel.$systemInstalled(systemId);\\n      system.state('resolved');\\n      channel.$systemResolved(systemId);\\n\\n      result = systemId;\\n    } else {\\n      xhr = new XMLHttpRequest();\\n      callbackLoad = function callbackLoad(system, url) {\\n        var sysId = $db.importSystem(system),\\n          sys = $component.get(sysId),\\n          channel = $component.get('channel');\\n\\n        if (typeof url === 'string') {\\n          sys.location(url);\\n        }\\n        sys.state('installed');\\n        channel.$systemInstalled(sysId);\\n        sys.state('resolved');\\n        channel.$systemResolved(sysId);\\n\\n        result = sysId;\\n      };\\n\\n      if (async) {\\n        xhr.open('GET', url, true);\\n        xhr.onreadystatechange = function () {\\n          if (xhr.readyState === 4) {\\n            if (xhr.status === 200 || xhr.status === 0) {\\n              callbackLoad(JSON.parse(xhr.response), url);\\n            }\\n          }\\n        };\\n        xhr.send(null);\\n      } else {\\n        xhr.open('GET', url, false);\\n        xhr.send(null);\\n        if (xhr.status === 200 || xhr.status === 0) {\\n          callbackLoad(JSON.parse(xhr.response), url);\\n        }\\n      }\\n    }\\n  }\\n  return result;\\n}\",useCoreAPI:!0,core:!0},\"14c1517b711cb78\":{_id:\"14c1517b711cb78\",component:\"_OSGi\",state:\"uninstall\",action:\"function uninstall(id) {\\n  var search = {},\\n    system = null,\\n    behaviorId = '',\\n    collection = '',\\n    componentId = '',\\n    length = 0,\\n    i = 0,\\n    coreComponents = ['admin', 'channel', 'db', 'logger', 'metamodel', 'runtime'];\\n\\n  search = $db._System.find({\\n    '_id': id\\n  });\\n\\n  if (search.length) {\\n    system = search[0];\\n    // remove behaviors\\n    if (system.behaviors) {\\n      for (behaviorId in system.behaviors) {\\n        $db._Behavior.remove({\\n          '_id': system.behaviors[behaviorId]._id\\n        });\\n      }\\n    }\\n    // remove components\\n    if (system.components) {\\n      for (collection in system.components) {\\n        for (componentId in system.components[collection]) {\\n          if (coreComponents.indexOf(componentId) === -1) {\\n            $db[collection].remove({\\n              '_id': componentId\\n            });\\n          }\\n        }\\n      }\\n    }\\n  }\\n  if (this.require(id) && this.require(id).state) {\\n    this.require(id).state('uninstalled');\\n    channel.$systemUninstalled(id);\\n  }\\n}\",useCoreAPI:!0,core:!0},\"105f219c6813643\":{_id:\"105f219c6813643\",component:\"_OSGi\",state:\"start\",action:\"function start(id) {\\n  var system = this.require(id),\\n    channel = this.require('channel');\\n\\n  if (system.state() === 'resolved' || system.state() === 'installed') {\\n    system.state('starting');\\n    if (system.start) {\\n      system.start();\\n    }\\n    channel.$systemStarted(id);\\n    system.state('active');\\n  }\\n}\",useCoreAPI:!1,core:!0},\"1a81a1f00d17269\":{_id:\"1a81a1f00d17269\",component:\"_OSGi\",state:\"stop\",action:\"function stop(id) {\\n  var system = this.require(id),\\n    channel = this.require('channel');\\n\\n  if (system.state() === 'active') {\\n    system.state('stopping');\\n    if (system.stop) {\\n      system.stop();\\n    }\\n    channel.$systemStopped(id);\\n    system.state('resolved');\\n    channel.$systemResolved(id);\\n  }\\n}\",useCoreAPI:!1,core:!0},\"116851b602128d1\":{_id:\"116851b602128d1\",component:\"_OSGi\",state:\"status\",action:\"function status() {\\n  var result = {},\\n    system = null,\\n    length = 0,\\n    i = 0;\\n\\n  systems = $db._System.find({});\\n\\n  length = systems.length;\\n  for (i = 0; i < length; i++) {\\n    system = systems[i];\\n    result[system.name] = {\\n      'id': system._id,\\n      'state': system.state,\\n      'name': system.name,\\n      'version': system.version,\\n      'location': system.location,\\n      'master': system.master\\n    };\\n  }\\n\\n  return result;\\n}\",useCoreAPI:!0,core:!0},\"19cf317d7217331\":{_id:\"19cf317d7217331\",component:\"_OSGi\",state:\"bundle\",action:\"function bundle() { \\n\\tvar result = $db.exportSystem();\\n\\treturn result;\\n}\",useCoreAPI:!0,core:!0},\"13010167f313f87\":{_id:\"13010167f313f87\",component:\"_Runtime\",state:\"system\",action:\"function system(params) {\\n  var RuntimeSystem = null,\\n    system = {},\\n    systemId = '',\\n    result = [],\\n    conf = {};\\n\\n  if (params) {\\n    if (typeof params === 'string') {\\n      conf.master = true;\\n      conf.name = params;\\n    } else {\\n      conf = params;\\n      conf.master = true;\\n    }\\n    RuntimeSystem = this.require('_System');\\n    system = new RuntimeSystem(conf);\\n    system.state('active');\\n  } else {\\n    result = $db._System.find({\\n      'master': true\\n    });\\n    if (result.length) {\\n      systemId = result[0]._id;\\n      system = $component.get(systemId);\\n    }\\n  }\\n  return system;\\n}\",core:!0,useCoreAPI:!0},\"1cfa4145f614da8\":{_id:\"1cfa4145f614da8\",component:\"_Runtime\",state:\"message\",action:\"function message(msg) { \\n  $db._Message.insert(msg);\\n}\",useCoreAPI:!0,core:!0},\"1cb9d103d41dd97\":{_id:\"1cb9d103d41dd97\",component:\"e89c617b6b15d24\",state:\"start\",action:\"function start() {\\n  if (typeof document !== 'undefined') {\\n    document.addEventListener('DOMContentLoaded', function DOMContentLoaded(e) {\\n      var systems = [],\\n        system = null,\\n        scripts = [],\\n        script = null,\\n        logLevel = 'warn',\\n        i = 0,\\n        length = 0;\\n    \\n      systems = document.querySelectorAll('link[rel=system]');\\n      length = systems.length;\\n  \\n      // logger\\n      scripts = document.querySelectorAll('script[log]');\\n      if (scripts.length) {\\n        logLevel = scripts[0].getAttribute('log');\\n        this.require('logger').level(logLevel);\\n      }\\n  \\n      // systems\\n      for (i = 0; i < length; i++) {\\n        system = systems[i];\\n  \\n        if (system.getAttribute('async') === 'false') {\\n          this.require('runtime').install(system.href, false);\\n        } else {\\n          this.require('runtime').install(system.href, true);\\n        }\\n      }\\n  \\n      // ready event\\n      if (length === 0) {\\n        this.require('runtime').ready();\\n      }\\n  }.bind(this));\\n  }\\n}\",useCoreAPI:!0,core:!0}},types:{css:{_id:\"h1d88311ac019211\",name:\"css\",type:\"string\",core:!0},date:{_id:\"c17cad1bc3d17752\",name:\"date\",type:\"object\",core:!0},json:{_id:\"e1d25a12e67127ed\",name:\"json\",type:\"object\",core:!0},dbInsertEvent:{_id:\"148ef1e19810e6d\",core:!0,name:\"dbInsertEvent\",type:\"object\",schema:{collection:{type:\"string\",mandatory:!0,default:\"\"},document:{type:\"object\",mandatory:!0,default:{}}}},dbRemoveEvent:{_id:\"1952e1ac4213f4a\",name:\"dbRemoveEvent\",type:\"object\",core:!0,schema:{collection:{type:\"string\",mandatory:!0,default:\"\"},id:{type:\"string\",mandatory:!0,default:\"\"}}},dbUpdateEvent:{_id:\"1f5c41309711752\",core:!0,name:\"dbUpdateEvent\",type:\"object\",schema:{collection:{type:\"string\",mandatory:!0,default:\"\"},id:{type:\"string\",mandatory:!0,default:\"\"},field:{type:\"string\",mandatory:!0,default:\"\"},value:{type:\"any\",mandatory:!0,default:null}}},dbAction:{_id:\"e1950e16f2914da9\",core:!0,name:\"dbAction\",type:\"string\",value:[\"insert\",\"update\",\"remove\"]},collection:{_id:\"d1c0d0130c616199\",name:\"collection\",type:\"object\",schema:{type:{type:[\"string\"],mandatory:!0},readOnly:{type:\"boolean\",mandatory:!0},mandatory:{type:\"boolean\",mandatory:!0},default:{type:\"object\",mandatory:!0},description:{type:\"string\",mandatory:!1},label:{type:\"string\",mandatory:!1}},core:!0},errorParam:{_id:\"e198761fc0b1ae8a\",name:\"errorParam\",type:\"object\",schema:{message:{type:\"string\",mandatory:!0},error:{type:\"object\",mandatory:!0}},core:!0},event:{_id:\"g1668d1de2d1ff6f\",name:\"event\",type:\"object\",schema:{params:{type:[\"parameter\"],mandatory:!1},description:{type:\"string\",mandatory:!1}},core:!0},html:{_id:\"y161c21320b11acb\",name:\"html\",type:\"string\",core:!0},javascript:{_id:\"s13d4c1fdf916504\",name:\"javascript\",type:\"string\",core:!0},link:{_id:\"p124601801d1dbfa\",name:\"link\",type:\"object\",schema:{type:{type:\"string\",mandatory:!0},readOnly:{type:\"boolean\",mandatory:!0},mandatory:{type:\"boolean\",mandatory:!0},default:{type:\"{type}\",mandatory:!0},description:{type:\"string\",mandatory:!1},label:{type:\"string\",mandatory:!1}},core:!0},log:{_id:\"d1fd161a4a4149fc\",name:\"log\",type:\"string\",value:[\"debug\",\"info\",\"warn\",\"error\"],core:!0},message:{_id:\"l13b061ac571272d\",name:\"message\",type:\"object\",schema:{event:{type:\"string\",mandatory:!0},from:{type:\"string\",mandatory:!1},data:{type:\"object\",mandatory:!0}},core:!0},method:{_id:\"x1227218eed1f3e9\",name:\"method\",type:\"object\",schema:{result:{type:\"string\",mandatory:!1},params:{type:[\"parameter\"],mandatory:!1},description:{type:\"string\",mandatory:!1}},core:!0},osgiStates:{_id:\"q1f0ca120fc13fb3\",name:\"osgiStates\",type:\"string\",value:[\"none\",\"installed\",\"resolved\",\"starting\",\"active\",\"stopping\",\"uninstalled\"],core:!0},parameter:{_id:\"e1b18e16c6c195ad\",name:\"parameter\",type:\"object\",schema:{name:{type:\"string\",mandatory:!0},type:{type:\"string\",mandatory:!0},mandatory:{type:\"boolean\",mandatory:!1},default:{type:\"{type}\",mandatory:!1}},core:!0},property:{_id:\"a16a3a1ae051a55d\",name:\"property\",type:\"object\",schema:{type:{type:\"string\",mandatory:!0},readOnly:{type:\"boolean\",mandatory:!0},mandatory:{type:\"boolean\",mandatory:!0},default:{type:\"{type}\",mandatory:!0},description:{type:\"string\",mandatory:!1},label:{type:\"string\",mandatory:!1}},core:!0},text:{_id:\"c136fc129a912f54\",name:\"text\",type:\"string\",core:!0}},components:{_Channel:{channel:{_id:\"channel\"}},_Database:{db:{_id:\"db\"}},_Logger:{logger:{_id:\"logger\",level:\"warn\"}},_Metamodel:{metamodel:{_id:\"metamodel\"}},_Runtime:{runtime:{_id:\"runtime\",version:\"2.1.3\"}}},_id:\"e89c617b6b15d24\"}},{}],2:[function(e,n,t){\"use strict\";function r(e,n,t,r){var a=-1,o=[],i=[],s=\"\",d=\"\",c=!0,l=!1;return 0===n.trim().indexOf(\"function\")&&(c=!1),c?(a=n.indexOf(\"=>\"),(o=(-1!==(d=(d=n.substring(0,a)).replace(\"=>\",\"\")).indexOf(\"(\")?d.split(\"(\")[1].replace(\")\",\"\").trim():d.trim()).split(\",\")).forEach(function(e){i.push(e.trim())}),0===(s=n.substring(a+2,n.length).trim()).indexOf(\"{\")&&(s=s.substring(1,s.lastIndexOf(\"}\")).trim()),-1===s.indexOf(\"\\n\")&&(l=!0),c&&l&&-1===s.indexOf(\"return \")&&(s=\"return \"+s)):(a=n.indexOf(\"{\"),(o=(d=n.substring(0,a)).split(\"(\")[1].replace(\")\",\"\").trim().split(\",\")).forEach(function(e){i.push(e.trim())}),s=(s=n.substring(a+1)).substring(0,s.lastIndexOf(\"}\")).trim()),\"\"===o[0]&&(o=[]),r&&(o.push(\"$component\"),o.push(\"$db\"),o.push(\"$metamodel\"),o.push(\"$workflow\"),o.push(\"$behavior\"),o.push(\"$state\"),o.push(\"$log\")),\"\"!==o[0]?new Function(\"__body\",\"return function \"+e+\" (\"+o.join(\",\")+\") { return new Function('\"+o.join(\"','\")+\"', __body).apply(this, arguments) };\")(s):new Function(\"__body\",\"return function \"+e+\" () { return new Function(__body).apply(this, arguments) };\")(s)}var a=e(\"./db.js\"),o=e(\"./helper.js\"),i={};t.add=function(e,n,t,s,d){var c=o.generateId(),l=t.toString();return void 0===d&&(d=!1),void 0===s&&(s=!1),t=r(n,l,0,s),i[c]=t,a._Behavior.insert({_id:c,component:e,state:n,action:l,useCoreAPI:s,core:d}),c},t.remove=function(e){(e=e||{}).behaviorId=e.behaviorId||\"\",e.componentId=e.componentId||\"\",e.state=e.state||\"\",e.componentId&&(e.behaviorId?(a._Behavior.remove({_id:e.behaviorId,component:e.componentId,state:e.state}),delete i[e.behaviorId]):(e.state?a._Behavior.remove({component:e.componentId,state:e.state}):a._Behavior.remove({component:e.componentId})).forEach(function(e){delete i[e]}))},t.removeFromMemory=function(e){delete i[e]},t.getActions=function(e,n){var t=[],o=null;return a._Behavior.find({component:e,state:n}).forEach(function(e){void 0===(o=i[e._id])&&(o=r(e.state,e.action,e.core,e.useCoreAPI),i[e._id]=o),t.push({useCoreAPI:e.useCoreAPI,action:o})}),t},t.clear=function(){i={}},t.get=function(e){return i[e]}},{\"./db.js\":4,\"./helper.js\":5}],3:[function(e,n,t){\"use strict\";function r(e){function n(){var e=0,n=0,t=o.length;for(i.forEach(function(n){p.isClassName(s)?o[e]=h.getRuntime().require(n):o[e]=n,e+=1}),n=e;n<t;n++)delete o[n];o.length=i.length}function t(e,n,t,r){var a=0,o=0,f=[];if(m)g.readOnlyProperty(d,c,l);else if(p.isClassName(s))if(e&&p.inheritFrom(e.constructor.name,s.replace(\"@\",\"\"))){switch(!0){case\"push\"===n:i.push(e.id());break;case\"unshift\"===n:i.unshift(e.id());break;case\"splice\"===n:for(o=(f=i.splice(t,r,e)).length,a=0;a<o;a++)u.state({component:d,state:l,data:[C[f[a]],\"remove\"]})}h.isRuntime()&&h.getRuntime().require(\"db\").update({collection:c,id:d,field:l,value:i}),u.state({component:d,state:l,data:[e,\"add\"]})}else void 0!==e.id?g.invalidPropertyName(d,c,l,e.id(),s):g.invalidPropertyName(d,c,l,e,s);else if(e&&p.isValidType(e,s)){switch(!0){case\"push\"===n:i.push(e);break;case\"unshift\"===n:i.unshift(e);break;case\"splice\"===n:i.splice(t,r,e)}h.isRuntime()&&h.getRuntime().require(\"db\").update({collection:c,id:d,field:l,value:i}),u.state({component:d,state:l,data:[e,\"add\"]})}else g.invalidPropertyName(d,c,l,e,s);return i.length}function a(e){var n,t=null;if(m)g.readOnlyProperty(d,c,l);else if(0!==i.length){switch(!0){case\"pop\"===e:t=i.pop();break;case\"shift\"===e:t=i.shift()}h.isRuntime()&&h.getRuntime().require(\"db\").update({collection:c,id:d,field:l,value:i}),n=p.isClassName(s)?C[t]:t,u.state({component:d,state:l,data:[n,\"remove\"]})}return n}var o=[],i=[],s=\"\",d=\"\",c=\"\",l=\"\",m=!1;return e=e||{},s=e.type||\"\",d=e.id||\"\",l=e.propertyName||\"\",i=e.arr||[],c=e.classId||\"\",void 0!==e.readOnly&&(m=e.readOnly),i.forEach(function(e){p.isClassName(s)?o.push(h.getRuntime().require(e)):o.push(e)}),o.push=function(e){var r=t(e,\"push\");return n(),r},o.unshift=function(e){var r=t(e,\"unshift\");return n(),r},o.concat=function(a){var o=0,s=0,d=null;if(Array.isArray(a))for(s=a.length,o=0;o<s;o++)t(a[o],\"push\");return e.arr=i,d=new r(e),n(),d},o.pop=function(){var e=a(\"pop\");return n(),e},o.shift=function(){var e=a(\"shift\");return n(),e},o.sort=function(e){var t=null;return i.sort(e),h.isRuntime()&&h.getRuntime().require(\"db\").update({collection:c,id:d,field:l,value:i}),t=o,n(),t},o.reverse=function(){return i.reverse(),h.isRuntime()&&h.getRuntime().require(\"db\").update({collection:c,id:d,field:l,value:i}),n(),o},o.splice=function(e,r,a){var o=[],m=0,f=0,y=null;if(void 0!==a)t(a,\"splice\",e,r);else for(o=i.splice(e,r),h.isRuntime()&&h.getRuntime().require(\"db\").update({collection:c,id:d,field:l,value:i}),f=o.length,m=0;m<f;m++)y=p.isClassName(s)?C[o[m]]:o[m],u.state({component:d,state:l,data:[y,\"remove\"]});return n(),o},o.slice=function(e,t){var r=i.slice(e,t);return n(),r},o}function a(e,n){var t=[],r=[],a=0,o=0;if(t=p.getModel(e)[n].params)for(a=t.length,o=0;o<a;o++)r.push(t[o].name);return r}function o(e,n,t){var r=null,a=f.store[e][n],o=t.split(\".\"),i=o.length,s=0;for(r=a,s=0;s<i;s++)r=r[o[s]];return r}function i(e,n,t,r){var a=null,o=f.store[e][n],i=t.split(\".\"),s=i.length,d=0;for(a=o,d=0;d<s-1;d++)a=a[i[d]];a[i[d]]=r}function s(e,n,a){(function(e){var n=null,t=null,r=[],a=0,o=0,i=[];for(n=p.getModel(e),t=p.getSchema(n[j]),a=(r=Object.keys(t)).length,o=0;o<a;o++)t[r[o]]!==w&&t[r[o]]!==b&&t[r[o]]!==O||i.push({name:r[o],type:n[r[o]].type,readOnly:n[r[o]].readOnly});return i})(e).forEach(function(o){var i={},s=\"\",c=\"\",l=\"\";s=o.name,c=o.type,l=o.readOnly,Array.isArray(c)||\"array\"===c?(i=function(e,n){var t=[],o=null,i=null,d=null;if(void 0===n){if(void 0===e)return new r({id:this.id(),propertyName:s,readOnly:l,classId:a,type:\"array\"===c?\"any\":c[0],arr:f.store[a][this.id()][s]});if(Array.isArray(e))!function(e,n){var t=!0;return e.forEach(function(e){p.isValidType(e,n)&&p.inheritFrom(e.constructor.name,n.replace(\"@\",\"\"))&&p.isClassName(n)||(t=t&&!1)}),!0}(e,\"array\"===c?\"any\":c[0])?g.invalidPropertyName(this.id(),this.constructor.name,s,e,c):(t=f[a].find({_id:this.id()})).length&&(o=t[0],d=function(e,n){var t=[];return e.forEach(function(e){if(p.isClassName(n))switch(!0){case\"string\"==typeof e:t.push(e);break;case void 0!==e.id:t.push(e.id());break;default:t.push(null)}else t.push(e)}),t}(e,\"array\"===c?\"any\":c[0]),u.state({component:this.id(),state:s,data:[e,\"reset\"]}),o[s]=d,h.isRuntime()&&h.getRuntime().require(\"db\").update({collection:a,id:this.id(),field:s,value:o[s]}));else if(\"number\"==typeof e){if(i=f.store[a][this.id()][s][e])return d=p.isClassName(\"array\"===c?\"array\":c[0])?h.getRuntime().require(i):i}else g.invalidPropertyName(this.id(),this.constructor.name,s,e,\"number\")}else if(l)g.readOnlyProperty(this.id(),this.constructor.name,s);else if(p.isValidType(n,\"array\"===c?\"any\":c[0])||p.inheritFrom(n.constructor.name,\"array\"===c?\"array\":c[0].replace(\"@\",\"\"))&&p.isClassName(\"array\"===c?\"array\":c[0])){if((t=f[a].find({_id:this.id()})).length){if(p.isClassName(\"array\"===c?\"array\":c[0]))switch(!0){case\"string\"==typeof n:d=n;break;case void 0!==n.id:d=n.id();break;default:d=\"\"}else d=n;(o=t[0])[s][e]=d,h.isRuntime()&&h.getRuntime().require(\"db\").update({collection:a,id:this.id(),field:s,value:o[s]}),u.state({component:this.id(),state:s,data:[n,\"add\"]})}}else g.invalidPropertyName(this.id(),this.constructor.name,s,n,c)},n.prototype[s]=new Function(\"__body\",\"return function \"+s+\" (position, value) { return __body.call(this, position, value) };\")(i)):(i=function(n){var o=[],i=null,m=null;if(void 0===n){if(i=f.store[a][this.id()]){switch(!0){case p.isClassName(c):m=t.get(i[s]);break;case\"date\"===c:m=new Date(i[s]);break;case\"json\"===c:m=JSON.parse(JSON.stringify(i[s]));break;case\"array\"===c:m=new r({id:this.id(),propertyName:s,readOnly:l,classId:a,type:\"any\",arr:f.store[a][this.id()][s]});break;case p.isStructure(s,a):m=d(\"\",s,e,this.id());break;default:m=i[s]}return m}g.destroyedComponentCall(s,this.id())}else if(l)g.readOnlyProperty(this.id(),this.constructor.name,s);else if(p.isValidType(n,c)){if((o=f[a].find({_id:this.id()})).length){switch(i=o[0],!0){case p.isClassName(c):i[s]=null===n?n:n.id();break;case\"date\"===c:i[s]=\"string\"==typeof n?n:n.toISOString();break;default:i[s]=n}h.isRuntime()&&h.getRuntime().require(\"db\")&&h.getRuntime().require(\"db\").update({collection:a,id:this.id(),field:s,value:n}),\"_Behavior\"===a&&y.removeFromMemory(this.id()),u.state({component:this.id(),state:s,data:[n]})}}else g.invalidPropertyName(this.id(),this.constructor.name,s,n,c)},n.prototype[s]=new Function(\"__body\",\"return function \"+s+\" (value) { return __body.call(this,value) };\")(i))})}function d(e,n,a,s){var c={};return function(e,n){var t=null,r=null,a=null,o=[];return t=p.getModel(n),r=t[e].type,(a=p.getType(r)).schema&&Object.keys(a.schema).forEach(function(e){a.schema[e].name=e,o.push(a.schema[e])}),o}(n,a).forEach(function(l){var m={},v=\"\",_=\"\",b=\"\";v=l.name,_=l.type,b=l.readOnly,\"array\"===_?(m=function(t,d){var c=\"\",l=\"\";if(c=e?c+\".\"+n:n,l=c+\".\"+v,void 0===d){if(void 0===t)return new r({id:s,propertyName:l,readOnly:b,classId:a,type:\"any\",arr:o(a,s,l)});if(Array.isArray(t))!function(e,n){var t=!0;return e.forEach(function(e){p.isValidType(e,n)||(t=t&&!1)}),!0}(t,\"any\")?g.invalidPropertyName(s,this.constructor.name,v,t,_):f[a].find({_id:s}).length&&(i(a,s,l,t),u.state({component:s,state:l,data:[t,\"reset\"]}),h.isRuntime()&&h.getRuntime().require(\"db\").update({collection:a,id:s,field:l,value:t}));else{if(\"number\"==typeof t)return o(a,s,l)[t];g.invalidPropertyName(s,this.constructor.name,v,t,\"number\")}}else if(b)g.readOnlyProperty(s,this.constructor.name,v);else if(p.isValidType(d,\"any\")){if(f[a].find({_id:s}).length){var m=o(a,s,l);void 0===m&&(m=[]),m[t]=d,i(a,s,l,m),h.isRuntime()&&h.getRuntime().require(\"db\").update({collection:a,id:s,field:l,value:m}),u.state({component:s,state:l,data:[m,\"add\"]})}}else g.invalidPropertyName(s,this.constructor.name,v,d,_)},c[v]=new Function(\"__body\",\"return function \"+v+\" (position, value) { return __body.call(this, position, value) };\")(m)):(m=function(r){var c=[],m=null,w=\"\",O=\"\";if(w=e?w+\".\"+n:n,O=w+\".\"+v,void 0===r){if(f.store[a][s]){switch(!0){case p.isClassName(_):m=t.get(o(a,s,O));break;case\"date\"===_:m=new Date(o(a,s,O));break;case\"json\"===_:m=JSON.parse(JSON.stringify(o(a,s,O)));break;case p.isStructure(v,a):m=d(w,v,a,s);break;default:m=o(a,s,O)}return void 0===m&&void 0!==l.default&&(m=l.default),m}g.destroyedComponentCall(O,s)}else if(b)g.readOnlyProperty(s,a,O);else if(p.isValidType(r,_)){if((c=f[a].find({_id:s})).length){switch(c[0],!0){case p.isClassName(_):i(a,s,O,r.id());break;case\"date\"===_:i(a,s,O,r.toISOString());break;default:i(a,s,O,r)}h.isRuntime()&&h.getRuntime().require(\"db\")&&h.getRuntime().require(\"db\").update({collection:a,id:s,field:O,value:r}),\"_Behavior\"===a&&y.removeFromMemory(s),u.state({component:s,state:O,data:[r]})}}else g.invalidPropertyName(s,a,O,r,_)},c[v]=new Function(\"__body\",\"return function \"+v+\" (value) { return __body.call(this,value) };\")(m))}),c}function c(e,n,t){(function(e){var n=null,t=null,r=[],a=0,o=0,i=[];for(n=p.getModel(e),t=p.getSchema(n[j]),a=(r=Object.keys(t)).length,o=0;o<a;o++)t[r[o]]===k&&i.push(r[o]);return i})(e).forEach(function(e){var r=a(t,e),o=r.join(\",\"),i=\"\",s=function(){return u.state({component:this.id(),state:e,data:arguments})},d=function(){var n=null,r=Array.prototype.slice.call(arguments);return r.shift(),arguments[0]?n=u.state({component:this.id(),state:e,data:r,context:arguments[0]}):g.unknownContext(t,e),n};o?(r.unshift(\"context\"),i=r.join(\"\"),n.prototype[e]=new Function(\"__body\",\"return function \"+e+\" (\"+o+\") { return __body.call(this,\"+o+\") };\")(s),\"name\"!==e&&(n[e]=new Function(\"__body\",\"return function \"+e+\" (\"+i+\") { return __body.call(this,\"+i+\") };\")(d))):(n.prototype[e]=new Function(\"__body\",\"return function \"+e+\" () { return __body.call(this) };\")(s),\"name\"!==e&&(n[e]=new Function(\"__body\",\"return function \"+e+\" (context) { return __body.call(this, context) };\")(d)))})}function l(e,n,t){(function(e){var n=null,t=null,r=[],a=0,o=0,i=[];for(n=p.getModel(e),t=p.getSchema(n[j]),a=(r=Object.keys(t)).length,o=0;o<a;o++)t[r[o]]===S&&i.push(r[o]);return i})(e).forEach(function(e){var r=a(t,e).join(\",\"),o=function(){var n=[],r=\"e89c617b6b15d24\",a=[],o=0,i=-1,s={};if(\"_Channel\"===t){for((n=f._System.find({master:!0})).length&&(r=n[0]._id),s.from=r,i=arguments.length,o=0;o<i;o++)a.push(arguments[o]);s.data=a,s.event=e,f._Message.insert(s),u.state({component:this.id(),state:\"send\",data:[{event:s.event,from:s.from,data:s.data}]})}else u.state({component:this.id(),state:e,data:arguments})};n.prototype[e]=r?new Function(\"__body\",\"return function \"+e+\" (\"+r+\") { return __body.call(this,\"+r+\") };\")(o):new Function(\"__body\",\"return function \"+e+\" () { return __body.call(this) };\")(o)})}function m(e){var n={},r=\"\";return r=void 0===(e=e||{}).model?h.generateId():e.model,n=function(e){return new Function(\"__body\",\"return function \"+e+\" (config) { __body.call(this,config) };\")(function(n){var t={};\"Object\"!==(n=n||{}).constructor.name&&(g.invalidConctructorParameters(n,e),n={}),p.isValidObject(n,p.getModel(e),!0,!0)||g.invalidParameters(e),p.prepareObject(n,p.getModel(e)),void 0===n._id&&(n._id=h.generateId()),C[n._id]=this,t=function(){return n._id},this.id=new Function(\"__body\",\"return function id () { return __body.call(this) };\")(t),p.inheritFrom(e,\"_Component\")&&(n.classInfo=e+\"Info\"),f.store[e][n._id]=n,f.createLog(\"insert\",e,n._id,\"\",n),h.isRuntime()&&h.getRuntime().require(\"db\")&&h.getRuntime().require(\"db\").insert({collection:e,document:n}),Object.freeze(this),this.init&&this.init(n)})}(r),C[r]=n,function(e,n){e.id=new Function(\"__body\",\"return function id (prop, val) { return __body.call(this, prop, val) };\")(function(){return n})}(n,r),s(e.model,n,r),c(e.model,n,r),l(e.model,n,r),p.inheritFrom(r,\"_Component\")&&(function(e,n){e.prototype.on=new Function(\"__body\",\"return function on (state, handler, useCoreAPI, isCore) { return __body.call(this,state,handler,useCoreAPI,isCore) };\")(function(e,t,r,a){var o=\"\",i=\"\";return u.checkParams({component:this,methodName:\"on\",args:arguments})&&(p.isValidState(e,n)?p.isEvent(e,n)||p.isProperty(e,n)||p.isLink(e,n)||p.isCollection(e,n)||!(f._Behavior.find({component:this.id(),state:e}).length>=1)?v.validParamNumbers(n,e,t)?(o=y.add(this.id(),e,t,r,a),(i=_.get(this.id()))&&i.state===e&&u.action(o,i.value)):g.invalidParamNumberMethodOn(this.id(),this.constructor.name,e):g.behaviorNotUnique(n,e):g.invalidStateOn(n,e)),o})}(n,r),function(e,n){e.on=new Function(\"__body\",\"return function on (state, handler, useCoreAPI, isCore) { return __body.call(this, state, handler, useCoreAPI,isCore) };\")(function(e,t,r,a){var o=\"\",i=\"\";return u.checkParams({component:this,methodName:\"on\",args:arguments})&&(p.isValidState(e,n)?p.isEvent(e,n)||p.isProperty(e,n)||p.isLink(e,n)||p.isCollection(e,n)||!(f._Behavior.find({component:this.id(),state:e}).length>=1)?v.validParamNumbers(n,e,t)?(o=y.add(this.id(),e,t,r,a),(i=_.get(this.id()))&&i.state===e&&u.action(o,i.value)):g.invalidParamNumberMethodOn(this.id(),this.constructor.name,e):g.behaviorNotUnique(n,e):g.invalidStateOn(n,e)),o})}(n,r),function(e,n){e.off=new Function(\"__body\",\"return function off (state, behaviorId) { return __body.call(this, state, behaviorId) };\")(function(e,t){u.checkParams({component:this,methodName:\"off\",args:arguments})&&(p.isValidState(e,n)?y.remove({behaviorId:t,componentId:n,state:e}):g.invalidStateOff(n,e))})}(n,r),function(e){e.destroy=new Function(\"__body\",\"return function destroy () { return __body.call(this) };\")(function(){var e=this.id(),n=[],t=0,r=0;for(f[e]&&(n=f[e].remove()),delete C[e],y.remove({componentId:e}),r=n.length,t=0;t<r;t++)y.remove({componentId:n[t]});u.state({component:e,state:\"destroy\"})})}(n),function(e){e.classInfo=new Function(\"__body\",\"return function classInfo () { return __body.call(this) };\")(function(){return t.get(this.id()+\"Info\")})}(n)),Object.freeze(n),n}var u=e(\"./workflow.js\"),f=e(\"./db.js\"),p=e(\"./metamodel.js\"),y=e(\"./behavior.js\"),h=e(\"./helper.js\"),g=e(\"./log.js\"),v=e(\"./workflow.js\"),_=e(\"./state.js\"),b=\"property\",w=\"link\",O=\"collection\",k=\"method\",S=\"event\",j=\"_name\",C={};r.prototype=[],t.get=function(e){return C[e]},t.create=function(e){return m(e)},t.destroy=function(e){var n=C[e],t=\"\";n&&(delete C[e],t=n.constructor.name,f[t].remove({_id:e}),y.remove({componentId:e}),\"_Behavior\"===t&&y.removeFromMemory(e))},t.removeFromMemory=function(e){delete C[e]},t.clear=function(){C={}}},{\"./behavior.js\":2,\"./db.js\":4,\"./helper.js\":5,\"./log.js\":6,\"./metamodel.js\":7,\"./state.js\":9,\"./workflow.js\":10}],4:[function(e,n,t){\"use strict\";function r(e,n){var t=!0,r=!1,a=\"\",o=0,i=0;for(a in e){if(void 0===n[a]){t=!1;break}if(e[a]instanceof RegExp){if(Array.isArray(n[a])&&!Array.isArray(e[a])){for(i=n[a].length,o=0;o<i;o++)if(null!==n[a][o].toString().match(e[a])){r=!0;break}t=r}else if(null===n[a].toString().match(e[a])){t=!1;break}}else if(Array.isArray(n[a])&&!Array.isArray(e[a])){if(-1===n[a].indexOf(e[a])){t=!1;break}}else if(n[a]!==e[a]){t=!1;break}}return t}function a(){var e=\"\",n=\"\",r=[],a=null,o=null,i=null,s={};if((r=t._System.find({master:!0})).length){a=(i=r[0])._id,s._id=a,s.name=i.name,s.description=i.description,s.version=i.version,s.master=!0,o=function(){var e={},n=\"\",r=\"\",a=\"\",o=null,i=null,s=null,d=null,c=null,l=\"\",m=\"\",f=0,p=0,y=\"\";if(e.schemas={},t._Schema.count())for(l in t.store._Schema)(s=JSON.parse(JSON.stringify(t.store._Schema[l])))._core||(e.schemas[l]=s);if(e.models={},t._Model.count())for(m in t.store._Model)(d=JSON.parse(JSON.stringify(t.store._Model[m])))._core||(e.models[m]=d);if(e.types={},t._Type.count())for(a in t.store._Type)(o=JSON.parse(JSON.stringify(t.store._Type[a]))).core||(e.types[o.name]=o);e.behaviors={};for(r in t.store._Behavior)delete(i=JSON.parse(JSON.stringify(t.store._Behavior[r]))).classInfo,i.core||(e.behaviors[r]=i);for(e.components={},f=u.length,p=0;p<f;p++)if(n=u[p],t[n].count()){c=JSON.parse(JSON.stringify(t.store[n]));for(y in c)delete c[y].classInfo,c[y]._core&&delete c[y];Object.keys(c).length&&(e.components[n]=c)}return e}();for(n in o)o.hasOwnProperty(n)&&(s[n]=o[n]);e=JSON.stringify(s)}else e=\"{}\",d.masterSystemNotFound();return e}var o=e(\"./component.js\"),i=e(\"./metamodel.js\"),s=e(\"./helper.js\"),d=e(\"./log.js\"),c=e(\"./behavior.js\"),l=e(\"./state.js\"),m=e(\"./workflow.js\"),u=[],f=[\"_Runtime\",\"_Schema\",\"_Model\",\"_GeneratedModel\",\"_Behavior\",\"_State\",\"_Type\",\"_Metamodel\",\"_Database\",\"_System\",\"_ClassInfo\",\"_Message\",\"_Channel\",\"_Logger\",\"_Log\"],p=[\"_Log\",\"_Schema\",\"_Logger\",\"_Model\",\"_GeneratedModel\",\"_State\",\"_Type\"],y=0;t.store={};var h=function(e){i.getSchema(e)||-1!==f.indexOf(e)?(t.store[e]={},this.name=e,-1===f.indexOf(e)&&u.push(e)):d.invalidCollectionName(e)};h.prototype.find=function(e){var n=[],a={},o=\"\",i={};if((e=e||null)&&Object.keys(e).length)if(Array.isArray(e))e.forEach(function(e){for(o in t.store[this.name])r(e,i=t.store[this.name][o])&&void 0===a[o]&&(n.push(i),a[o]=!0)}.bind(this));else for(o in t.store[this.name])r(e,i=t.store[this.name][o])&&n.push(i);else for(o in t.store[this.name])i=t.store[this.name][o],n.push(i);return n},h.prototype.insert=function(e){var n=[],r=null,a=[];return Array.isArray(e)?n=e:n.push(e),n.forEach(function(e){var n=null,c=[];switch(!0){case\"_Schema\"===this.name:case\"_Logger\"===this.name:case\"_Model\"===this.name:case\"_Type\"===this.name:case\"_GeneratedModel\"===this.name:case i.isValidObject(e,i.getModel(this.name)):if(void 0===e._id&&(e._id=s.generateId()),i.prepareObject(e,i.getModel(this.name)),t.store[this.name][e._id]=e,(r=o.get(this.name))?(n=new r(e),a.push(n.id())):(t.createLog(\"insert\",this.name,e._id,\"\",e),s.isRuntime()&&s.getRuntime().require(\"db\")&&s.getRuntime().require(\"db\").insert({collection:this.name,document:e})),\"_Message\"===this.name&&s.isRuntime())for(var l=(c=t._Channel.find({})).length,u=0;u<l;u++)s.getRuntime().require(c[u]._id),m.state({component:c[u]._id,state:e.event,data:e.data});break;default:d.invalidDocumentOnDbInsert(e,this.name)}}.bind(this)),a},h.prototype.update=function(e,n,r){var a=this.find(e),c=0,l=0,u=a.length,f=\"\",p=i.getModel(this.name),y=\"\";if(void 0===(r=r||{}).upsert&&(r.upsert=r.upsert||!1),n)for(0===u&&r.upsert&&(e._id&&(n._id=e._id),this.insert(n),c+=1),l=0;l<u;l++){void 0!==n._id&&n._id!==a[l]._id&&d.updateUuid(a[l]._id,n._id,void 0!==o.get(n._id));for(f in n)void 0!==a[l][f.split(\".\")[0]]&&(\"_Schema\"!==this.name&&\"_Model\"!==this.name&&\"_GeneratedModel\"!==this.name?(y=\"\",0!==f.indexOf(\"_\")?y=-1!==f.indexOf(\".\")?i.getModelPathType(this.name,f):p[f].type:i.getMetaDef()[f]&&(y=i.getMetaDef()[f].type),y?i.isValidType(n[f],y)?(a[l][f]=n[f],c+=1,t.createLog(\"update\",this.name,a[l]._id,f,n[f]),s.isRuntime()&&s.getRuntime().require(\"db\")&&s.getRuntime().require(\"db\").update({collection:this.name,id:a[l]._id,field:f,value:n[f]}),\"array\"===y?m.state({component:a[l]._id,state:f,data:[n[f],\"reset\"]}):m.state({component:a[l]._id,state:f,data:[n[f]]})):d.invalidPropertyTypeOnDbUpdate(this.name,a[l]._id,f,n[f],y):d.unknownPropertyOnDbUpdate(this.name,f,a[l]._id)):(a[l][f]=n[f],t.createLog(\"update\",this.name,a[l]._id,f,n[f]),c+=1,s.isRuntime()&&s.getRuntime().require(\"db\")&&s.getRuntime().require(\"db\").update({collection:this.name,id:a[l]._id,field:f,value:n[f]})))}return c},h.prototype.remove=function(e){var n=[],a=\"\",i=null;if((e=e||null)&&Object.keys(e).length)if(Array.isArray(e))e.forEach(function(e){for(a in t.store[this.name])r(e,t.store[this.name][a])&&(delete t.store[this.name][a],t.createLog(\"remove\",this.name,a,\"\",\"\"),(i=o.get(a))&&i.destroy(),s.isRuntime()&&s.getRuntime().require(\"db\")&&s.getRuntime().require(\"db\").remove({collection:this.name,id:a}),n.push(a))}.bind(this));else for(a in t.store[this.name])r(e,t.store[this.name][a])&&(delete t.store[this.name][a],t.createLog(\"remove\",this.name,a,\"\",\"\"),(i=o.get(a))&&i.destroy(),s.isRuntime()&&s.getRuntime().require(\"db\")&&s.getRuntime().require(\"db\").remove({collection:this.name,id:a}),n.push(a));else for(a in t.store[this.name])delete t.store[this.name][a],t.createLog(\"remove\",this.name,a,\"\",\"\"),-1===p.indexOf(this.name)&&(i=o.get(a))&&i.destroy(),s.isRuntime()&&s.getRuntime().require(\"db\")&&s.getRuntime().require(\"db\").remove({collection:this.name,id:a}),n.push(a);return n},h.prototype.count=function(){var e=0,n=\"\";for(n in t.store[this.name])e++;return e},t.createLog=function(e,n,r,a,o){var i=s.generateId();n=n||\"\",r=r||\"\",a=a||\"\",o=o||\"\",Object.keys(t.store._Log).length>1e3&&(t.store._Log={}),t.store._Log[i]={_id:i,action:e,collection:n,id:r,field:a,value:o,order:y++}},t.collection=function(e){t[e]=new h(e)},t.importSystem=function(e){return function(e){var n=\"\",r=\"\",a=\"\",o=\"\",s=\"\",d=\"\",c=\"\",l=[];if(e){delete e.subsystem;for(o in e.types)i.type(e.types[o]);for(s in e.schemas)i.schema(e.schemas[s]);for(d in e.models)i.model(e.models[d]);i.create();for(c in e.behaviors)t._Behavior.insert(e.behaviors[c]);for(r in e.components)for(a in e.components[r])t[r].insert(e.components[r][a]);(l=t._System.find({master:!0})).length&&(l[0]._id===e._id?e.master=!0:e.master&&(l[0].master=!1)),t._System.insert(e),n=e._id}return n}(e)},t.exportSystem=function(e){return e?function(e){var n={},r=[],a=\"\",o=0,i=0,s=null,d=null,c=null,l=null,m=null,u=\"\";if((r=t._System.find({master:!0})).length&&(a=r[0].name),n.name=e.name||\"sub_\"+a,n.version=e.version||\"0.0.1\",n.description=e.description||\"\",n.schemas={},e.schemas)for(i=(r=t._Schema.find(e.schema)).length,o=0;o<i;o++)(s=r[o])._core||(n.schemas[s._id]=s);if(n.models={},e.models)for(i=(r=t._Model.find(e.models)).length,o=0;o<i;o++)(c=r[o])._core||(n.models[c._id]=c);if(n.types={},e.types)for(i=(r=t._Type.find(e.types)).length,o=0;o<i;o++)(d=r[o])._core||(n.types[d._id]=d);if(n.behaviors={},e.behaviors)for(l=t._Behavior.find(e.behaviors),i=r.length,o=0;o<i;o++)(l=r[o]).core||(n.behaviors[l._id]=l);if(n.components={},e.components)for(u in e.components)if(t[u])for(n.components[u]={},i=(r=t[u].find(e.components[u])).length,o=0;o<i;o++)m=r[o],n.components[u][m._id]=m;return JSON.stringify(n)}(e):a()},t.clear=function(){var e=0,n=0,r=\"\";for(e=u.length,n=0;n<e;n++)r=u[n],t[r].remove();for(e=f.length,n=0;n<e;n++)r=f[n],t[r].remove()},t.init=function(){var e=\"\",n=null;n=t._System.find({_id:\"e89c617b6b15d24\"})[0],t.clear(),o.clear(),i.clear(),l.clear(),c.clear(),i.init(),e=t.importSystem(n),o.get(e).start()}},{\"./behavior.js\":2,\"./component.js\":3,\"./helper.js\":5,\"./log.js\":6,\"./metamodel.js\":7,\"./state.js\":9,\"./workflow.js\":10}],5:[function(e,n,t){\"use strict\";var r=e(\"./db.js\"),a=e(\"./component.js\"),o=null;t.isRuntime=function(){var e=!1;return r._Runtime&&r._Runtime.find().length&&(e=!0),e},t.getRuntime=function(){var e=\"\";return o||(e=r._Runtime.find()[0]._id,o=a.get(e)),o},t.generateId=function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16)}return function(){var e=\"abcdefghijklmnopqrstuvwxyz\";return e.charAt(Math.floor(Math.random()*e.length))}()+e()+e()+e()},t.polyfill=function(){void 0===Function.prototype.name&&void 0!==Object.defineProperty&&Object.defineProperty(Function.prototype,\"name\",{get:function(){var e=/function\\s([^(]{1,})\\(/.exec(this.toString());return e&&e.length>1?e[1].trim():\"\"},set:function(e){}})}},{\"./component.js\":3,\"./db.js\":4}],6:[function(e,n,t){\"use strict\";function r(){var e=\"\",n=[],t=null;return a.getModel(\"_Logger\")&&(n=o._Logger.find()).length?(e=n[0][s],t=i.get(e)?i.get(e):d):t=d,t}e(\"./helper.js\"),e(\"./workflow.js\");var a=e(\"./metamodel.js\"),o=e(\"./db.js\"),i=e(\"./component.js\"),s=\"_id\",d={currentLevel:\"warn\",level:function(e){return e&&(this.currentLevel=e),this.currentLevel},debug:function(e){\"debug\"===this.currentLevel&&console.log(\"runtime: \"+e)},info:function(e){\"info\"!==this.currentLevel&&\"debug\"!==this.currentLevel||console.info(\"runtime: \"+e)},warn:function(e){\"info\"!==this.currentLevel&&\"warn\"!==this.currentLevel&&\"debug\"!==this.currentLevel||console.warn(\"runtime: \"+e)},error:function(e){console.error(\"runtime: \"+e)}};t.level=function(e){e},t.unknownProperty=function(e,n){var t=\"\";t=n._name?\"unknown property '\"+e+\"' for the definition of '\"+n._name+\"'\":\"unknown property '\"+e+\"' for a model\",r().warn(t)},t.invalidPropertyType=function(e,n,t){r().warn(\"invalid type for property '\"+e+\"': expected type '\"+n+\"' instead of type '\"+typeof t+\"'\")},t.invalidEnumValue=function(e,n){r().warn(\"'\"+e+\"' is an invalid value for the type enum '\"+n+\"'\")},t.invalidClassName=function(e,n,t){r().warn(\"invalid class name for component '\"+e+\"': expected '\"+n+\"' instead of '\"+t+\"'\")},t.missingProperty=function(e){r().warn(\"missing property '\"+e+\"'\")},t.missingImplementation=function(e){r().warn(\"schema '\"+e+\"' is missing.\")},t.invalidTypeImp=function(e,n){r().error(\"the property '\"+e+\"' of the model '\"+n+\"' is invalid\")},t.missingPropertyImp=function(e,n){r().warn(\"missing property '\"+e+\"' for the definition of '\"+n+\"'\")},t.unknownPropertyImp=function(e,n){r().error(\"the model '\"+n+\"' has an unknown property '\"+e+\"'\")},t.invalidTypeDefinition=function(e){r().warn(\"the type '\"+e+\"' is not valid\")},t.invalidPropertyName=function(e,n,t,a,o){var i=\"\";\"Function\"!==n&&(i=\" (class '\"+n+\"')\"),\"string\"==typeof o?r().warn(\"invalid type for property '\"+t+\"' on component '\"+e+\"'\"+i+\": expected '\"+o.replace(\"@\",\"\")+\"' instead of '\"+typeof a+\"'\"):r().warn(\"invalid type for property type '\"+t+\"' on component '\"+i+\": expected 'string' instead of '\"+typeof o+\"'\")},t.readOnlyProperty=function(e,n,t){var a=\"\";\"Function\"!==n&&(a=\" (class '\"+n+\"')\"),r().warn(\"can not set read-only property '\"+t+\"' on component '\"+e+\"'\"+a)},t.invalidDocumentOnDbInsert=function(e,n){r().warn(\"invalid document '\"+JSON.stringify(e).replace(/,/g,\", \")+\"' on an insert operation on collection '\"+n+\"'\")},t.invalidPropertyTypeOnDbUpdate=function(e,n,t,a,o){r().warn(\"invalid type when trying to update the property '\"+t+\"' of document '\"+n+\"' (collection '\"+e+\"') with the value '\"+JSON.stringify(a)+\"': expected type '\"+o+\"'\")},t.unknownPropertyOnDbUpdate=function(e,n,t){r().warn(\"unknown property '\"+e+\"' on an update operation on collection '\"+n+\"' with component '\"+t+\"'\")},t.unknownMethod=function(e,n){r().warn(\"try to call an unknown method '\"+n+\"' for the class '\"+e+\"'\")},t.invalidCollectionName=function(e){r().warn(\"invalid name for creating the collection '\"+e+\"': there is no schema '\"+e+\"' in the metamodel\")},t.invalidResultType=function(e,n,t,a,o){var i=\"\";\"Function\"!==n&&(i=\" (class '\"+n+\"')\"),o?r().warn(\"invalid type for the result of method '\"+t+\"' on component '\"+e+\"'\"+i+\": expected type '\"+a.replace(\"@\",\"\")+\"' instead of type '\"+o+\"'\"):r().warn(\"invalid type for the result of method '\"+t+\"' on component '\"+e+\"'\"+i+\": expected type '\"+a.replace(\"@\",\"\")+\"'\")},t.unknownComponent=function(e,n){r().warn(\"unkown class component '\"+e+\"' for component '\"+n+\"'\")},t.workflowRestarted=function(){r().warn(\"runtime has been restarted\")},t.invalidParamNumber=function(e,n,t){var a=\"\";\"Function\"!==n&&(a=\" (class '\"+n+\"')\"),r().warn(\"invalid number of parameters when calling the method '\"+t+\"' on component '\"+e+\"'\"+a)},t.invalidParamType=function(e,n,t,a){var o=\"\";\"Function\"!==n&&(o=\" (class '\"+n+\"')\"),void 0!==a?r().warn(\"invalid type for the parameter '\"+a+\"' when calling the method '\"+t+\"' on component '\"+e+\"'\"+o):r().warn(\"invalid type for a parameter when calling the method '\"+t+\"' on component '\"+e+\"'\"+o)},t.behaviorNotUnique=function(e,n){r().warn(\"try to add more than one behavior for the state '\"+n+\"' on class '\"+e+\"'\")},t.invalidStateOn=function(e,n){r().warn(\"try to add a behavior with an unkwown state '\"+n+\"' on class '\"+e+\"'\")},t.invalidStateOff=function(e,n){r().warn(\"try to remove a behavior from an unkwown state '\"+n+\"' on class '\"+e+\"'\")},t.masterSystemNotFound=function(){r().warn(\"can not export the database because no system was defined\")},t.invalidType=function(e,n){r().warn(\"invalid type for value '\"+JSON.stringify(e)+\"': expected '\"+n+\"'\")},t.unknownType=function(e){r().warn(\"unknown type for value '\"+JSON.stringify(e)+\"'\")},t.canNotYetValidate=function(e,n){r().debug(\"can not yet validate if the component '\"+e+\"' is an instance of '\"+n+\"'\")},t.invalidChannelEvent=function(e,n,t){r().warn(\"invalid type for the message '\"+JSON.stringify(e)+\"': expected type '\"+t+\"' for event '\"+n+\"'\")},t.invalidParamNumberMethodOn=function(e,n,t){var a=\"\";\"Function\"!==n&&(a=\" (class '\"+n+\"')\"),r().warn(\"invalid number of parameters when adding an action on method '\"+t+\"' on component '\"+e+\"'\"+a)},t.updateUuid=function(e,n,t){t?r().warn(\"try to update a component of id '\"+e+\"' with the new id '\"+n+\"' that is already used\"):r().warn(\"try to update a component of id '\"+e+\"' with the new id '\"+n+\"'\")},t.invalidUseOfComponent=function(e){r().warn(\"try to change the state of the destroyed component '\"+e+\"'\")},t.invalidSchema=function(e){r().warn(\"the schema '\"+e+\"' is not valid\")},t.invalidModel=function(e){r().warn(\"the model '\"+e+\"' is not valid\")},t.invalidParameters=function(e){r().warn(\"the parameters for creating a component of class '\"+e+\"' are not compliant with the model\")},t.destroyedComponentCall=function(e,n){r().warn(\"trying to get the property '\"+e+\"' on the destroyed component '\"+n+\"'\")},t.invalidConctructorParameters=function(e,n){r().warn(\"the constructor parameter '\"+JSON.stringify(e).replace(/,/g,\", \")+\"' for creating a component of class '\"+n+\"' is not an object\")},t.unknownModel=function(e){r().warn(\"try get the information of an unknown model '\"+e+\"'\")},t.missingSchema=function(e){r().warn(\"the schema '\"+e+\"' is missing\")},t.cyclicDependency=function(e){e?r().error(\"a cyclic inheritance dependency with \"+e+\" schema has been found, please check the '_inherit' properties of your schemas\"):r().error(\"a cyclic inheritance dependency has been found, please check the '_inherit' properties of your schemas\")},t.invalidEnumType=function(e,n,t){void 0!==t&&t!==typeof e?r().warn(\"invalid type for enumerated type '\"+n+\"': expected type '\"+t+\"' instead of type '\"+typeof e+\"'\"):r().warn(\"invalid type for enumerated type '\"+n+\"'\")},t.loadSchema=function(e){r().debug(\"load schema '\"+e+\"'\")},t.loadModel=function(e){r().debug(\"load model '\"+e+\"'\")},t.loadType=function(e){r().debug(\"load type '\"+e+\"'\")},t.compileSchema=function(e){r().debug(\"compile schema '\"+e+\"'...\")},t.generateModel=function(e){r().debug(\"generate model '\"+e+\"'...\")},t.checkModel=function(e){r().debug(\"analyze model '\"+e+\"'...\")},t.createCollection=function(e){r().debug(\"create collection '\"+e+\"'\")},t.createClass=function(e){r().debug(\"create class '\"+e+\"'\")},t.modelCreationBegin=function(){r().debug(\"starting model creation...\")},t.modelCreationEnd=function(){r().debug(\"model creation ended\")},t.actionInvokeError=function(e,n,t,a){\"Function\"!==t?r().error(\"error when trying to call the method '\"+e+\"' on component '\"+n+\"' (class '\"+t+\"'): \"+a):r().error(\"error when trying to call the method '\"+e+\"' on component '\"+n+\"': \"+a)},t.invalidSchemaProperty=function(e,n){r().warn(\"invalid property '\"+n+\"' for schema '\"+e+\"': only 'property', 'link', 'collection', 'method' and 'event' are allowed.\")},t.invalidPropertyFormat=function(e){r().warn(\"invalid format for a definition of a property': '\"+e+\"' is not an object\")},t.invalidState=function(e,n){r().warn(\"invalid state '\"+n+\"' for the model '\"+e+\"'\")},t.unknownContext=function(e,n){r().warn(\"invoke the behavior '\"+n+\"' on the class '\"+e+\"' without a valid context\")}},{\"./component.js\":3,\"./db.js\":4,\"./helper.js\":5,\"./metamodel.js\":7,\"./workflow.js\":10}],7:[function(e,n,t){\"use strict\";function r(){var e=\"\",n=\"\",r=\"\",a={},o=\"\",i=null,s=null,d=null,c={},l={},m=[],u=0,f=0,p=0,y=0,_=[];for(r in P.compiledSchemas){c={_name:(a=P.compiledSchemas[r])._name},void 0!==a._core&&(c._core=a._core),Array.isArray(a._inherit)&&(c._inherit=a._inherit),void 0!==a._class&&(c._class=a._class),void 0!==a._description&&(c._description=a._description);for(e in a)switch(!0){case\"property\"===a[e]:c[e]={type:\"any\",readOnly:!1,mandatory:!1,default:\"\",description:e,label:e};break;case\"link\"===a[e]:c[e]={type:\"_Component\",readOnly:!1,mandatory:!1,default:\"\",description:e,label:e};break;case\"method\"===a[e]:c[e]={params:[{name:\"param\",type:\"any\",mandatory:!1}],result:\"any\",description:e};break;case\"event\"===a[e]:c[e]={params:[{name:\"param\",type:\"any\",mandatory:!1}],description:e};break;case\"collection\"===a[e]:c[e]={type:[\"_Component\"],readOnly:!1,mandatory:!1,default:[],description:e,label:e};break;default:0!==e.indexOf(\"_\")&&v.invalidSchemaProperty(a._name,e)}P.generatedModels[c._name]=c}for(o in P.generatedModels)n=(c=P.generatedModels[o])[O],(s=P.models[n])&&(l=h(s,c),P.generatedModels[n]=l);for(y=(_=function(){var e=[],n={},t=\"\",r=0;for(t in P.inheritanceTree)r=P.inheritanceTree[t].length,void 0===n[r]&&(n[r]=[]),n[r].push(t);return Object.keys(n).sort().forEach(function(t){n[t].forEach(function(n){e.push(n)})}),e}()).length,f=0;f<y;f++)if(o=_[f],c=P.generatedModels[o]){(m=t.getParents(o)).reverse();JSON.parse(JSON.stringify(c));for(u=m.length,p=0;p<u;p++)n=m[p],(i=P.generatedModels[n])&&(l=h(i,c),P.generatedModels[o]=l);(s=P.models[o])&&(l=h(s,P.generatedModels[o]),P.generatedModels[o]=l)}for(o in P.generatedModels)d=P.generatedModels[o],g._GeneratedModel.insert(d),d._core||v.generateModel(o)}function a(){function e(e,n){var t=0,r=0,a=[];for(r=n.length,t=0;t<r;t++)0===n[t].indexOf(e)&&((a=n[t]).reverse(),a.pop(),a.reverse(),n[t]=a)}function n(e,n){var t=!0,r=0,a=0;for(a=n.length,r=0;r<a;r++)n[r].indexOf(e)>0&&(t=!1);return t}function t(t){var r=0,a=0,o=[];for(a=t.length,r=0;r<a;r++)if(n(t[r][0],t)){o.push(t[r][0]),e(t[r][0],t);break}return o}function r(e){function n(e,n){var t=!1;return Array.isArray(P.inheritance[n])&&-1!==P.inheritance[n].indexOf(e)&&(v.cyclicDependency(e),t=!0),t}var a=[],o=0,i=0;for(Array.isArray(P.inheritance[e])?a=P.inheritance[e].slice():v.missingSchema(e),i=a.length,o=0;o<i;o++)if(n(e,a[o])){a=[];break}return a.length?[e].concat(function(e){var n=[],r=[];for(r=t(e);void 0!==r[0];)n=n.concat(r),r=t(e);return function(e){var n=0,t=0,r=!0;for(t=e.length,n=0;n<t;n++)e[n].length&&(r=!1);return r}(e)||v.cyclicDependency(),n}(a.map(r).concat([a]))):[e]}var a=\"\",o=[];for(a in P.inheritance)(o=r(a).reverse()).pop(),o.length&&(P.inheritanceTree[a]=o)}function o(e){var n={},t=P.schemas[e],r=P.inheritanceTree[e],a=0,o=0,i=null,s=\"\";for(r&&(a=r.length,r.reverse()),o=0;o<a;o++){i=P.schemas[r[o]];for(s in i)0!==s.indexOf(\"_\")&&(n[s]=i[s])}for(s in t)n[s]=t[s];return n}function i(){var e=\"\",n=null,t=\"\";for(e in P.generatedModels)(n=P.generatedModels[e])&&((t=P.compiledSchemas[e])?(n._core||v.checkModel(e),function(e,n){var t=\"\";for(t in n)t!==w&&t!==O&&t!==k&&t!==S&&t!==j&&t!==C&&(void 0!==e[t]?function(e,n){var t=!0;t=p(n,\"string\")&&-1!==M.indexOf(n)?p(e,n):s(e,n);return t}(e[t],n[t])||v.invalidTypeImp(t,e[O]):v.missingPropertyImp(t,e[O]));for(t in e)t!==w&&t!==O&&t!==k&&t!==S&&t!==j&&t!==C&&void 0===n[t]&&v.unknownPropertyImp(t,e[O])}(n,t)):v.missingImplementation(e))}function s(e,n){var r=!0,a=P.type[n],o=0,i=0;if(p(a,\"undefined\"))r=!1;else if(p(e,\"undefined\"))r=!1;else if(\"array\"===a.type)for(o=e.length,i=0;i<o&&!1!==(r=p(a.schema,\"undefined\")?t.isValidType(e[i],a.type):t.isValidSchema(e[i],a.schema));i++);else r=p(a.schema,\"undefined\")?t.isValidType(e,a.type):t.isValidSchema(e,a.schema);return r}function d(e){return e.replace(\"@\",\"\").trim()}function c(e){return p(e,\"string\")&&-1===M.indexOf(e)&&!t.isClassName(e)}function l(e){return-1!==e.indexOf(\"{\")}function m(e){var n=\"\";return n=Array.isArray(e)?\"array\":typeof e,\"any\"===e&&(n=\"any\"),n}function u(e){var n=\"\";return e&&e.constructor&&(n=e.constructor.name),n}function f(e,n){return-1!==n.indexOf(e)}function p(e,n){var t=!0,r=null;switch(n){case\"array\":t=Array.isArray(e);break;case\"date\":\"string\"==typeof e?(r=new Date(e),t=!isNaN(r.getDate())):t=e instanceof Date;break;case\"any\":t=!0;break;default:t=n===typeof e}return t}function y(e,n,t){var r=!1,a=P.generatedModels[n];return a&&a[O]&&(a=P.compiledSchemas[a[O]]),a&&a[e.split(\".\")[0]]===t&&(r=!0),r}function h(e,n,t){var r=\"\",a=n;for(r in e)e.hasOwnProperty(r)&&0!==r.indexOf(\"_\")&&(a[r]=e[r]);return a}var g=e(\"./db.js\"),v=e(\"./log.js\"),_=e(\"./component.js\"),b=(e(\"./workflow.js\"),e(\"./helper.js\")),w=\"_id\",O=\"_name\",k=\"_description\",S=\"_inherit\",j=\"_class\",C=\"_core\",I=[\"property\",\"collection\",\"link\",\"method\",\"event\"],M=[\"boolean\",\"string\",\"number\",\"object\",\"function\",\"array\",\"date\",\"any\"],P={metadef:{},inheritance:{},inheritanceTree:{},schemas:{},compiledSchemas:{},models:{},generatedModels:{},states:{},type:{}};t.schema=function(e){var n=null,r=null,a=\"\",o={},i=[];return r=JSON.parse(JSON.stringify(e)),a=r[O],void 0===r[w]&&(r[w]=b.generateId()),void 0===r[S]&&(r[S]=[\"_Component\"]),r[S]=function(e){var n=[],t={};return e.forEach(function(e){var r=e.trim();void 0===t[r]&&(t[r]=r,n.push(r))}),n}(r[S]),t.isValidObject(r,P.metadef.schema,!1)?(i=g._Schema.find({_name:a})).length?(o=h(r,i[0]),g._Schema.update({_name:a},o),n=i[0]._id):n=g._Schema.insert(r)[0]:v.invalidSchema(r[O]),n},t.model=function(e){var n=null,r=null,a=\"\",o={},i=[];return n=JSON.parse(JSON.stringify(e)),a=n[O],void 0===n[w]&&(n[w]=b.generateId()),t.isValidObject(n,P.metadef.model,!1)?(i=g._Model.find({_name:a})).length?(o=h(n,i[0]),g._Model.update({_name:a},o),r=i[0]._id):r=g._Model.insert(n)[0]:v.invalidModel(n[O]),r},t.type=function(e){var n=null,r=e.name;return t.isValidObject(e,P.metadef.type)?n=g._Type.insert(e)[0]:v.invalidTypeDefinition(r),n},t.init=function(){t.clear(),P.metadef={schema:{_id:{type:\"string\",mandatory:!0},_name:{type:\"string\",mandatory:!0},_inherit:{type:[\"string\"],mandatory:!1,default:[\"_Component\"]},_class:{type:\"boolean\",mandatory:!1},_core:{type:\"boolean\",mandatory:!1},_description:{type:\"string\",mandatory:!1}},model:{_id:{type:\"string\",mandatory:!0},_name:{type:\"string\",mandatory:!0},_inherit:{type:[\"string\"],mandatory:!1},_class:{type:\"boolean\",mandatory:!1},_core:{type:\"boolean\",mandatory:!1},_description:{type:\"string\",mandatory:!1}},type:{_id:{type:\"string\",mandatory:!1},name:{type:\"string\",mandatory:!0},type:{type:\"string\",mandatory:!0},schema:{type:\"object\",mandatory:!1},value:{type:[\"any\"],mandatory:!1},core:{type:\"boolean\",mandatory:!1},_description:{type:\"string\",mandatory:!1}}},g.collection(\"_Logger\"),g.collection(\"_Schema\"),g.collection(\"_Model\"),g.collection(\"_GeneratedModel\"),g.collection(\"_ClassInfo\"),g.collection(\"_Behavior\"),g.collection(\"_State\"),g.collection(\"_Type\"),g.collection(\"_Message\"),g.collection(\"_Channel\"),g.collection(\"_Log\")},t.clear=function(){P={metadef:{},inheritance:{},inheritanceTree:{},schemas:{},compiledSchemas:{},models:{},generatedModels:{},states:{},type:{}}},t.create=function(){v.modelCreationBegin(),function(){var e=[],n=[],t=null,r={},a=[],o=null,i=\"\",s=\"\",d=0,c=0;for(P.inheritance={},P.inheritanceTree={},P.schemas={},P.compiledSchemas={},P.models={},P.generatedModels={},P.states={},P.type={},c=(e=g._Schema.find({})).length,d=0;d<c;d++)i=(t=e[d])[O],s=t[S],P.schemas[i]=t,s&&(P.inheritance[i]=s),t._core||v.loadSchema(i);for(c=(a=g._Model.find({})).length,d=0;d<c;d++)i=(r=a[d])[O],P.models[i]=r,r._core||v.loadModel(i);for(c=(n=g._Type.find({})).length,d=0;d<c;d++)o=n[d],P.type[o.name]=o,o.core||v.loadType(o.name)}(),a(),function(){var e=\"\";for(e in P.schemas)P.schemas[e]._core||v.compileSchema(e),P.compiledSchemas[e]=o(e)}(),r(),i(),function(){var e=\"\",n=null,t=\"\",r=[],a=\"\";for(e in P.compiledSchemas){if(r=[],n=P.compiledSchemas[e])for(a in n)t=n[a],0!==a.indexOf(\"_\")&&-1!==I.indexOf(t)&&r.push(a);P.states[e]=r}}(),function(){var e=\"\",n={};for(e in P.generatedModels)n=P.generatedModels[e],void 0===g[n[O]]&&!1!==n[j]&&(g.collection(n[O]),n._core||v.createCollection(n[O]))}(),function(){var e=\"\",n={};for(e in P.generatedModels)!1!==(n=P.generatedModels[e])[j]&&(_.create({model:e}),n._core||v.createClass(e))}(),function(){var e=\"\",n={},r=\"\";for(e in P.generatedModels)r=(n=P.generatedModels[e])[O]+\"Info\",!1!==n[j]&&t.inheritFrom(n[O],\"_Component\")&&(_.get(r)?g._ClassInfo.update({_id:r},{_id:r,schema:P.compiledSchemas[e],model:n}):g._ClassInfo.insert({_id:r,schema:P.compiledSchemas[e],model:n}))}(),v.modelCreationEnd()},t.isEvent=function(e,n){return y(e,n,\"event\")},t.isProperty=function(e,n){return y(e,n,\"property\")},t.isLink=function(e,n){return y(e,n,\"link\")},t.isCollection=function(e,n){return y(e,n,\"collection\")},t.isMethod=function(e,n){return y(e,n,\"method\")},t.isStructure=function(e,n){var t=!1,r=P.generatedModels[n],a=\"\";return r[e]&&(a=P.type[r[e].type]),a&&a.schema&&(t=!0),t},t.isValidState=function(e,n){var r=!1,a=P.generatedModels[n],o={};return!function(e){return-1!==e.indexOf(\".\")}(e)?(a&&a[O]&&(a=P.generatedModels[a[O]]),o=P.states[a[O]],Array.isArray(o)&&(r=-1!==o.indexOf(e))):r=t.isValidModelPath(n,e),r},t.isValidType=function(e,n){function r(e,n){var t=!0,r=d(n),a=e;return\"\"!==e&&null!==e&&(p(e,\"string\")&&(a=_.get(e)),u(a)!==r&&\"{}\"!==JSON.stringify(a)&&(t=!1,v.invalidType(e,n.replace(\"@\",\"\")))),t}var a=!0;switch(!0){case c(n):(a=s(e,n))||(P.type[n]?v.invalidEnumType(e,n,P.type[n].type):v.invalidEnumType(e,n)),a&&(a=function(e,n){var t=P.type[n],r=!0;return Array.isArray(t.value)&&-1===t.value.indexOf(e)&&(r=!1),!1===r&&v.invalidEnumValue(e,n),r}(e,n));break;case t.isClassName(n):a=r(e,n);break;default:a=function(e,n){var a=!0,o=0,i=0;switch(m(n)){case\"string\":a=p(e,n);break;case\"array\":for(i=e.length,o=0;o<i;o++)switch(!0){case c(n[0]):a=s(e[o],n[0]);break;case t.isClassName(n[0]):a=r(e[o],n[0]);break;default:a=p(e[o],n[0])}}return a}(e,n)}return a},t.isValidEnum=function(e,n){var r=!0;return t.isClassName(n.type)?(r=function(e,n){var t=\"\";return\"Function\"===(t=e.constructor.name)&&(t=e.name),t===n}(_.get(e),d(n.type))&&-1!==n.value.indexOf(e))||v.invalidEnumValue(e,n.type):(r=p(e,n.type)&&-1!==n.value.indexOf(e))||v.invalidEnumValue(e,n.name),r},t.isValidSchema=function e(n,r){function a(){var r=!0,a=[];return g=u(h),g=n[g],g=g.replace(\"@\",\"\"),c(g)?P.type[g]?P.type[g].schema?r=e(d,P.type[g].schema):(r=p(d,P.type[g].type),(a=P.type[g].value)&&(r=f(d,a))):r=!1:r=\"array\"===g?Array.isArray(d):t.isClassName(g)?p(d,\"object\")||p(d,\"string\"):p(d,g),r||v.invalidPropertyType(s,g,d),r}function o(){var r=!0,a=[];return g=function(e){return e.replace(\"{\",\"\").replace(\"}\",\"\").trim()}(h),g=n[g],g=g.replace(\"@\",\"\"),c(g)?P.type[g]?P.type[g].schema?r=e(d,P.type[g].schema):(r=p(d,P.type[g].type),(a=P.type[g].value)&&(r=f(d,a))):r=!1:r=\"array\"===g?Array.isArray(d):t.isClassName(g)?p(d,\"object\")||p(d,\"string\"):p(d,g),r||v.invalidPropertyType(s,g,d),r}function i(){var n=!0;switch(_=m(h)){case\"string\":if(c(_))n=e(d,h);else if(!p(d,h)){v.invalidPropertyType(s,h,d),n=!1;break}break;case\"array\":for(b=d.length,w=0;w<b;w++)if(c(h[0]))n=e(d[w],P.type[h[0]].schema);else if(!p(d[w],h[0])){v.invalidPropertyType(d[w],h[0],d[w]),n=!1;break}}return n}var s=\"\",d=null,y=!0,h=\"\",g=\"\",_=\"\",b=0,w=0;if(p(n,\"object\")){for(s in n){if(d=n[s],p(r[s],\"undefined\"))return v.unknownProperty(s,r),!1;switch(h=r[s].type,!0){case t.isClassName(h):y=a();break;case l(h):y=o();break;default:y=i()}if(!y)break}for(s in r)if(d=r[s],!0===d.mandatory&&p(n[s],\"undefined\")&&void 0!==n[s]){v.missingProperty(s),y=!1;break}}else y=!1,v.invalidPropertyFormat(n);return y},t.isValidObject=function e(n,r,a,o){function i(n,r){var i=!0,s=\"\";if(s=P.type[r])switch(!0){case!p(s.schema,\"undefined\"):i=e(n,s.schema,a,o);break;case!p(s.value,\"undefined\"):i=t.isValidEnum(n,s);break;default:i=t.isValidType(n,s.type)}else i=!1;return i}function s(e,r){var a=!0,i=null,s=!1;if(w=d(r),e&&e.id?(i=e,s=!0):i=_.get(e),p(i,\"undefined\"))switch(!0){case p(e,\"object\")&&null!==e&&Object.keys(e).length>0:case p(e,\"string\")&&\"\"!==e:v.canNotYetValidate(e,w)}else t.inheritFrom(i.constructor.name,w)?s&&o&&(n[f]=i.id()):(a=!1,v.invalidType(e,w));return a}function l(n,r){var s=!0,l=null,p=\"\";switch(O=m(r)){case\"any\":break;case\"string\":if(c(O))s=e(n,r,a,o);else if(\"array\"===r){if(\"array\"!==m(n)){v.invalidPropertyType(f,r,n),s=!1;break}}else if(\"date\"===r){if(l=new Date(n),!(s=!isNaN(l.getDate()))){v.invalidPropertyType(f,r,n);break}}else if(m(n)!==r&&\"any\"!==m(n)){v.invalidPropertyType(f,r,n),s=!1;break}break;case\"array\":if(Array.isArray(n)){for(k=n.length,p=r[0],S=0;S<k;S++)if(c(p))s=i(n[S],p);else if(t.isClassName(p))if(\"string\"===m(n[S]))if(_.get(n[S])){if(!t.inheritFrom(u(_.get(n[S])),d(p))){v.invalidClassName(JSON.stringify(n[S]),d(p),u(_.get(n[S]))),s=!1;break}}else\"\"!==n[S]&&v.canNotYetValidate(n[S],d(p));else{if(!t.inheritFrom(u(n[S]),d(p))){v.invalidClassName(JSON.stringify(n[S]),d(p),u(n[S])),s=!1;break}o&&(n[S]=n[S].id())}else if(m(n[S])!==p&&\"any\"!==p){v.invalidPropertyType(n[S],p,n[S]),s=!1;break}}else s=!1,v.invalidType(n,\"array\");break;default:s=!1,v.unknownType(n)}return s}var f=\"\",y=null,h=!0,g=!0,b=\"\",w=\"\",O=\"\",k=0,S=0;p(a,\"undefined\")&&(a=!0),p(o,\"undefined\")&&(o=!1),p(n,\"object\")||(h=!1,v.invalidType(n,\"object\"));for(f in n)if(y=n[f],p(r[f],\"undefined\")&&\"_core\"!==f){if(a)return v.unknownProperty(f,r),!1}else switch(b=\"_core\"!==f?r[f].type:\"boolean\",\"_id\"===f&&(b=\"string\"),!0){case c(b):h=i(y,b);break;case t.isClassName(b):h=s(y,b);break;default:h=l(y,b)}for(f in r)g=(y=r[f]).mandatory,n&&p(n[f],\"undefined\")&&!0===g&&(v.missingProperty(f),h=!1);return h},t.prepareObject=function(e,n){var t=\"\",r=null,a=!0,o=\"\";for(t in n)a=(r=n[t]).mandatory,o=r.default,p(e[t],\"undefined\")&&(!1!==a||p(o,\"undefined\")||(e[t]=o))},t.getSchema=function(e){var n=null;return P.compiledSchemas[e]&&(n=P.compiledSchemas[e]),n},t.getModel=function(e){var n=null;return P.generatedModels[e]&&(n=P.generatedModels[e]),n},t.getType=function(e){var n=null;return P.type[e]&&P.type[e]&&(n=JSON.parse(JSON.stringify(P.type[e]))),n},t.getModelPathType=function(e,n){var r=null,a=[],o=\"\",i=0,s=0,d=\"\";for(s=(a=n.split(\".\")).length,i=0;i<s;i++)o=a[i],0===i?r=t.getModel(e)[o].type:c(r)&&(d=t.getType(r)).schema?r=d.schema[o].type:v.invalidState(e,n);return r},t.isValidModelPath=function(e,n){var r=!0,a=null,o=[],i=\"\",s=0,d=0,l=\"\";for(d=(o=n.split(\".\")).length,s=0;s<d;s++)i=o[s],0===s?a=t.getModel(e)[i].type:c(a)&&(l=t.getType(a)).schema&&l.schema[i]?a=l.schema[i].type:r=!1;return r},t.getMetaDef=function(){return P.metadef.schema},t.getParents=function(e){return P.inheritanceTree[e]?P.inheritanceTree[e].slice():[]},t.inheritFrom=function(e,n){function r(e,n){var a=!1,o=[],i=0;if(0!==(o=t.getParents(e)).length)if(-1!==o.indexOf(n))a=!0;else for(i=0;i<0&&!(a=r(o[i],n));i++);return a}var a=!1,o=[],i=0,s=0;if(e!==n){if(o=t.getParents(e),s=o.length,0!==o.length)if(-1!==o.indexOf(n))a=!0;else for(i=0;i<s&&!(a=r(o[i],n));i++);}else a=!0;return a},t.isClassName=function(e){var n=\"\",t=p(e,\"string\");return t&&(Object.keys(P.generatedModels).length>0?(n=e.replace(\"@\",\"\"),t=void 0!==P.generatedModels[n]):t=!1),t}},{\"./component.js\":3,\"./db.js\":4,\"./helper.js\":5,\"./log.js\":6,\"./workflow.js\":10}],8:[function(e,n,t){(function(t){\"use strict\";\"undefined\"==typeof window&&void 0!==t&&(t.require=e);var r=e(\"./db.js\"),a=e(\"./component.js\"),o=e(\"./metamodel.js\"),i=e(\"../build/system/system.js\"),s=\"\",d=\"\",c=null;e(\"./helper.js\").polyfill(),o.init(),s=r.importSystem(i.system),d=a.get(s),c=a.get(\"channel\"),d.state(\"installed\"),c.$systemInstalled(s),d.state(\"resolved\"),c.$systemResolved(s),d.state(\"starting\"),c.$systemStarted(s),d.start(),d.state(\"active\"),n.exports=a.get(\"runtime\")}).call(this,\"undefined\"!=typeof global?global:\"undefined\"!=typeof self?self:\"undefined\"!=typeof window?window:{})},{\"../build/system/system.js\":1,\"./component.js\":3,\"./db.js\":4,\"./helper.js\":5,\"./metamodel.js\":7}],9:[function(e,n,t){\"use strict\";var r=e(\"./db.js\"),a={};t.set=function(e,n,t){a[e]={state:n,value:t},r.store._State[e]={state:n,value:t}},t.get=function(e){return a[e]},t.clear=function(){a={}}},{\"./db.js\":4}],10:[function(e,n,t){\"use strict\";function r(e){this.message=e,this.name=\"RuntimeError\"}function a(e){return-1!==e.indexOf(\".\")}function o(e,n){var t=null,r=[],a=[],o=0,i=0,s=0,d=0;if(c.getModel(e)?t=c.getModel(e)[n]:p.unknownModel(e),t){if(r=t.params)for(o=r.length,i=0;i<o;i++)void 0!==r[i].mandatory&&!0!==r[i].mandatory||(s+=1),d+=1;a.push(s),a.push(d)}else p.unknownMethod(e,n);return a}function i(e){var n=(e=e||{}).component||null,t=e.methodName||\"\",r=null,a=\"\",o=\"\",i=null,s=!0;if(r=void 0!==e.methodResult?e.methodResult:void 0,o=\"Function\"===n.constructor.name?n.name:n.constructor.name,null!==(i=function(e,n){var t=null,r=null;return c.getModel(e)?t=c.getModel(e)[n].result:p.unknownModel(e),t&&(r=t),r}(o,t)))switch(!0){case\"any\"===i:break;case\"array\"===i:Array.isArray(r)||(s=!1,p.invalidResultType(n.id(),n.constructor.name,t,i,null));break;case c.isClassName(i):r.constructor?(a=\"Function\"===r.constructor.name?r.name:r.constructor.name)!==i.replace(\"@\",\"\")&&(s=!1,p.invalidResultType(n.id(),n.constructor.name,t,i,a)):(s=!1,p.invalidResultType(n.id(),n.constructor.name,t,i,typeof r));break;default:typeof r!==i&&(s=!1,p.invalidResultType(n.id(),n.constructor.name,t,i,typeof r))}return s}function s(e,n,t){var r=m.getActions(e.id(),n),a=[],o=0,i=0,d=null;if(!r.length||t)if(\"Function\"!==e.constructor.name)r=r.concat(s(l.get(e.constructor.name),n,t));else for(o=(a=c.getParents(e.name)).length,i=0;i<o&&((d=l.get(a[i]))?r=r.concat(s(d,n,t)):p.unknownComponent(a[i],e.name),!r.length);i++);return r.length&&r.reverse(),r}function d(e,n,a,o,i){var s=null,d=[],h=\"\",g=0,v=0;h=\"Function\"===e.constructor.name?e.name:e.constructor.name,c.isProperty(n,h)||c.isLink(n,h)||c.isCollection(n,h)||(o=function(e,n,t){var r=null,a=[],o=[],i=0,s=0;if(r=c.getModel(e)[n]){if(a=r.params)for(i=a.length,s=0;s<i;s++)!1===a[s].mandatory&&void 0===t[s]?o.push(a[s].default):o.push(t[s])}else p.unknownMethod(e,n);return o}(h,n,o));try{for(v=o.length,g=0;g<v;g++)d.push(o[g]);a.useCoreAPI&&(d.push(l),d.push(y),d.push(c),d.push(t),d.push(m),d.push(u),d.push(p)),i?setTimeout(a.action.bind.apply(a.action,[e].concat(d)),0):s=a.action.apply(e,d)}catch(t){if(t instanceof r)throw t;void 0===new Function?console.error(\"runtime: can not execute new Function() instruction in the current context.\"):(e&&e.error&&e.error({message:\"error when trying to call the method '\"+n+\"' on component '\"+e.id()+\"'\",error:t}),f.getRuntime()&&f.getRuntime().error({message:\"error when trying to call the method '\"+n+\"' on component '\"+e.id()+\"'\",error:t}),p.actionInvokeError(n,e.id(),e.constructor.name,t.message))}return s}var c=e(\"./metamodel.js\"),l=e(\"./component.js\"),m=e(\"./behavior.js\"),u=e(\"./state.js\"),f=e(\"./helper.js\"),p=e(\"./log.js\"),y=e(\"./db.js\");(r.prototype=new Error).constructor=r,t.validParamNumbers=function(e,n,t){var r=\"\",a=-1,i=\"\",s=\"\",d=[],l=0,m=[],u=!1,f=!1,p=!1,y=!1;switch(r=t.toString(),a=r.indexOf(\"{\"),i=r.substring(0,a),i=i.replace(\"=>\",\"\"),s=-1!==i.indexOf(\"(\")?i.split(\"(\")[1].replace(\")\",\"\").trim():i.trim(),\"\"===(d=s.split(\",\"))[0]&&(d=[]),l=d.length,u=c.isProperty(n,e),f=c.isLink(n,e),p=c.isCollection(n,e),!0){case p:m=[2,2];break;case u:m=\"array\"===c.getModelPathType(e,n)?[2,2]:[1,1];break;case f:m=[1,1];break;default:m=o(e,n)}return m[0]<=l&&l<=m[1]&&(y=!0),y},t.checkParams=function(e){var n=(e=e||{}).component||null,t=e.methodName||\"\",r=e.args||\"\",i=[],s=[],d=[],l=\"\",m=r.length,u=0,f=null,y=!0,h=!1,g=!1,v=!1;switch(l=\"Function\"===n.constructor.name?n.name:n.constructor.name,h=c.isProperty(t,l),g=c.isLink(t,l),v=c.isCollection(t,l),i=function(e,n){var t=null,r=[],o=[],i=0,s=0;if(c.getModel(e)?t=c.getModel(e)[n]:p.unknownModel(e),t){if(r=t.params)for(i=r.length,s=0;s<i;s++)o.push(r[s].name)}else a(n)||p.unknownMethod(e,n);return o}(l,t),!0){case v:s=r&&r[1]&&\"reset\"===r[1]?[[c.getModel(l)[t].type[0]],\"string\"]:[c.getModel(l)[t].type[0],\"string\"],d=[2,2];break;case h:s=a(t)?[c.getModelPathType(l,t)]:[c.getModel(l)[t].type],\"array\"===c.getModelPathType(l,t)?(s=r&&r[1]&&\"reset\"===r[1]?[[\"any\"],\"string\"]:[\"any\",\"string\"],d=[2,2]):d=[1,1];break;case g:s=[c.getModel(l)[t].type],d=[1,1];break;default:s=function(e,n){var t=null,r=[],a=[],o=0,i=0;if(c.getModel(e)?t=c.getModel(e)[n]:p.unknownModel(e),t){if(r=t.params)for(o=r.length,i=0;i<o;i++)a.push(r[i].type)}else p.unknownMethod(e,n);return a}(l,t),d=o(l,t)}for(void 0===m&&(m=1),(m<d[0]||d[1]<m)&&(y=!1,p.invalidParamNumber(n.id(),n.constructor.name,t)),u=0;u<m;u++)if(void 0===(f=r[u])){if(!(u<d[0]))continue;y=!1,p.invalidParamNumber(n.id(),n.constructor.name,t)}else c.isValidType(f,s[u])||(y=!1,p.invalidParamType(n.id(),n.constructor.name,t,i[u]));return y},t.action=function(e,n){var t=!1,r=!1,a=!1,o=!1,i=[],s=null,u=null,f=\"\",p=null;i=y._Behavior.find({_id:e}),p=m.get(e),1===i.length&&(s=i[0],(u=l.get(s.component))&&(f=\"Function\"===u.constructor.name?u.name:u.constructor.name,t=c.isEvent(s.state,f),r=c.isProperty(s.state,f),a=c.isLink(s.state,f),o=c.isCollection(s.state,f),(t||r||o||a)&&d(u,s.state,{useCoreAPI:s.useCoreAPI,action:p},n,!0)))},t.state=function(e){(e=e||{}).component=e.component||\"\",e.state=e.state||\"\",e.data=e.data||[],e.context=e.context||null;var n=null,r=\"\",a=[],o=null,m=null,f=0,y=0,h=!1,g=!1,v=!1,_=!1,b=!1;if((r=u.get(e.component))&&\"destroy\"===r.state&&p.invalidUseOfComponent(e.component),(n=l.get(e.component))&&(h=\"Function\"===n.constructor.name?n.name:n.constructor.name,b=c.isEvent(e.state,h),g=c.isProperty(e.state,h),v=c.isLink(e.state,h),_=c.isCollection(e.state,h),a=s(n,e.state,b)),a.length){if(t.checkParams({component:n,methodName:e.state,args:e.data}))if(b||g||v||_){for(y=a.length,f=0;f<y;f++)o=a[f],d(e.context||n,e.state,o,e.data,!0);u.set(n.id(),e.state,e.data)}else o=a[0],m=d(e.context||n,e.state,o,e.data,!1),i({component:n,methodName:e.state,methodResult:m});return m}n&&(b||g||v||_)&&u.set(n.id(),e.state,e.data)},t.stop=function(e){if(void 0===(e=e||{}).error&&(e.error=!1),e.message=e.message||\"\",t.state=function(){},e.error)throw e.message?new r(\"runtime has been stopped because \"+e.message):new r(\"runtime has been stopped because of an unknown error\");e.message?console.error(\"runtime: runtime has been stopped because \"+e.message):console.error(\"runtime: runtime has been stopped\")}},{\"./behavior.js\":2,\"./component.js\":3,\"./db.js\":4,\"./helper.js\":5,\"./log.js\":6,\"./metamodel.js\":7,\"./state.js\":9}]},{},[8])(8)});"
      }
    }
  },
  "_id": "k177271eabf1db74"
}
